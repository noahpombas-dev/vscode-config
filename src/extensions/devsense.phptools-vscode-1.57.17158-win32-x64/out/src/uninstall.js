var pp=Object.create;var bs=Object.defineProperty;var dp=Object.getOwnPropertyDescriptor;var hp=Object.getOwnPropertyNames;var vp=Object.getPrototypeOf,gp=Object.prototype.hasOwnProperty;var p=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var _p=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of hp(t))!gp.call(e,i)&&i!==r&&bs(e,i,{get:()=>t[i],enumerable:!(n=dp(t,i))||n.enumerable});return e};var dt=(e,t,r)=>(r=e!=null?pp(vp(e)):{},_p(t||!e||!e.__esModule?bs(r,"default",{value:e,enumerable:!0}):r,e));var ti=p(Ss=>{var xs=require("url"),mp=require("child_process").spawn,ht=require("fs");Ss.XMLHttpRequest=function(){"use strict";var e=this,t=require("http"),r=require("https"),n,i,a={},s=!1,o={"User-Agent":"node-XMLHttpRequest",Accept:"*/*"},u={},c={},l=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","content-transfer-encoding","cookie","cookie2","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","via"],f=["TRACE","TRACK","CONNECT"],d=!1,g=!1,_={};this.UNSENT=0,this.OPENED=1,this.HEADERS_RECEIVED=2,this.LOADING=3,this.DONE=4,this.readyState=this.UNSENT,this.onreadystatechange=null,this.responseText="",this.responseXML="",this.status=null,this.statusText=null,this.withCredentials=!1;var T=function(v){return s||v&&l.indexOf(v.toLowerCase())===-1},k=function(v){return v&&f.indexOf(v)===-1};this.open=function(v,w,K,G,ne){if(this.abort(),g=!1,!k(v))throw new Error("SecurityError: Request method not allowed");a={method:v,url:w.toString(),async:typeof K!="boolean"?!0:K,user:G||null,password:ne||null},q(this.OPENED)},this.setDisableHeaderCheck=function(v){s=v},this.setRequestHeader=function(v,w){if(this.readyState!==this.OPENED)throw new Error("INVALID_STATE_ERR: setRequestHeader can only be called when state is OPEN");if(!T(v)){console.warn('Refused to set unsafe header "'+v+'"');return}if(d)throw new Error("INVALID_STATE_ERR: send flag is true");v=c[v.toLowerCase()]||v,c[v.toLowerCase()]=v,u[v]=u[v]?u[v]+", "+w:w},this.getResponseHeader=function(v){return typeof v=="string"&&this.readyState>this.OPENED&&i&&i.headers&&i.headers[v.toLowerCase()]&&!g?i.headers[v.toLowerCase()]:null},this.getAllResponseHeaders=function(){if(this.readyState<this.HEADERS_RECEIVED||g)return"";var v="";for(var w in i.headers)w!=="set-cookie"&&w!=="set-cookie2"&&(v+=w+": "+i.headers[w]+`\r
`);return v.substr(0,v.length-2)},this.getRequestHeader=function(v){return typeof v=="string"&&c[v.toLowerCase()]?u[c[v.toLowerCase()]]:""},this.send=function(v){if(this.readyState!==this.OPENED)throw new Error("INVALID_STATE_ERR: connection must be opened before send() is called");if(d)throw new Error("INVALID_STATE_ERR: send has already been called");var w=!1,K=!1,G=xs.parse(a.url),ne;switch(G.protocol){case"https:":w=!0;case"http:":ne=G.hostname;break;case"file:":K=!0;break;case void 0:case null:case"":ne="localhost";break;default:throw new Error("Protocol not supported.")}if(K){if(a.method!=="GET")throw new Error("XMLHttpRequest: Only GET method is supported");if(a.async)ht.readFile(G.pathname,"utf8",function(ze,Jt){ze?e.handleError(ze):(e.status=200,e.responseText=Jt,q(e.DONE))});else try{this.responseText=ht.readFileSync(G.pathname,"utf8"),this.status=200,q(e.DONE)}catch(ze){this.handleError(ze)}return}var Xt=G.port||(w?443:80),ei=G.pathname+(G.search?G.search:"");for(var Ge in o)c[Ge.toLowerCase()]||(u[Ge]=o[Ge]);if(u.Host=ne,w&&Xt===443||Xt===80||(u.Host+=":"+G.port),a.user){typeof a.password>"u"&&(a.password="");var op=new Buffer(a.user+":"+a.password);u.Authorization="Basic "+op.toString("base64")}a.method==="GET"||a.method==="HEAD"?v=null:v?(u["Content-Length"]=Buffer.isBuffer(v)?v.length:Buffer.byteLength(v),u["Content-Type"]||(u["Content-Type"]="text/plain;charset=UTF-8")):a.method==="POST"&&(u["Content-Length"]=0);var Cs={host:ne,port:Xt,path:ei,method:a.method,headers:u,agent:!1,withCredentials:e.withCredentials};if(g=!1,a.async){var Ts=w?r.request:t.request;d=!0,e.dispatchEvent("readystatechange");var up=function ze(Jt){if(i=Jt,i.statusCode===301||i.statusCode===302||i.statusCode===303||i.statusCode===307){a.url=i.headers.location;var Gr=xs.parse(a.url);ne=Gr.hostname;var fp={hostname:Gr.hostname,port:Gr.port,path:Gr.path,method:i.statusCode===303?"GET":a.method,headers:u,withCredentials:e.withCredentials};n=Ts(fp,ze).on("error",Is),n.end();return}i.setEncoding("utf8"),q(e.HEADERS_RECEIVED),e.status=i.statusCode,i.on("data",function(zr){zr&&(e.responseText+=zr),d&&q(e.LOADING)}),i.on("end",function(){d&&(q(e.DONE),d=!1)}),i.on("error",function(zr){e.handleError(zr)})},Is=function(Jt){e.handleError(Jt)};n=Ts(Cs,up).on("error",Is),v&&n.write(v),n.end(),e.dispatchEvent("loadstart")}else{var Kt=".node-xmlhttprequest-content-"+process.pid,Wt=".node-xmlhttprequest-sync-"+process.pid;ht.writeFileSync(Wt,"","utf8");for(var cp="var http = require('http'), https = require('https'), fs = require('fs');var doRequest = http"+(w?"s":"")+".request;var options = "+JSON.stringify(Cs)+";var responseText = '';var req = doRequest(options, function(response) {response.setEncoding('utf8');response.on('data', function(chunk) {  responseText += chunk;});response.on('end', function() {fs.writeFileSync('"+Kt+"', JSON.stringify({err: null, data: {statusCode: response.statusCode, headers: response.headers, text: responseText}}), 'utf8');fs.unlinkSync('"+Wt+"');});response.on('error', function(error) {fs.writeFileSync('"+Kt+"', JSON.stringify({err: error}), 'utf8');fs.unlinkSync('"+Wt+"');});}).on('error', function(error) {fs.writeFileSync('"+Kt+"', JSON.stringify({err: error}), 'utf8');fs.unlinkSync('"+Wt+"');});"+(v?"req.write('"+JSON.stringify(v).slice(1,-1).replace(/'/g,"\\'")+"');":"")+"req.end();",lp=mp(process.argv[0],["-e",cp]);ht.existsSync(Wt););var Yt=JSON.parse(ht.readFileSync(Kt,"utf8"));lp.stdin.end(),ht.unlinkSync(Kt),Yt.err?e.handleError(Yt.err):(i=Yt.data,e.status=Yt.data.statusCode,e.responseText=Yt.data.text,q(e.DONE))}},this.handleError=function(v){this.status=0,this.statusText=v,this.responseText=v.stack,g=!0,q(this.DONE),this.dispatchEvent("error")},this.abort=function(){n&&(n.abort(),n=null),u=o,this.status=0,this.responseText="",this.responseXML="",g=!0,this.readyState!==this.UNSENT&&(this.readyState!==this.OPENED||d)&&this.readyState!==this.DONE&&(d=!1,q(this.DONE)),this.readyState=this.UNSENT,this.dispatchEvent("abort")},this.addEventListener=function(v,w){v in _||(_[v]=[]),_[v].push(w)},this.removeEventListener=function(v,w){v in _&&(_[v]=_[v].filter(function(K){return K!==w}))},this.dispatchEvent=function(v){if(typeof e["on"+v]=="function"&&e["on"+v](),v in _)for(var w=0,K=_[v].length;w<K;w++)_[v][w].call(e)};var q=function(v){(v==e.LOADING||e.readyState!==v)&&(e.readyState=v,(a.async||e.readyState<e.OPENED||e.readyState===e.DONE)&&e.dispatchEvent("readystatechange"),e.readyState===e.DONE&&!g&&(e.dispatchEvent("load"),e.dispatchEvent("loadend")))}}});var B=p((ny,qs)=>{"use strict";var Tp=function(){function e(){}return e.info=function(t){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];e.enableDebug&&console.info(e.TAG+t,r)},e.warn=function(t){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];e.disableWarnings||console.warn(e.TAG+t,r)},e.enableDebug=!1,e.disableWarnings=!1,e.disableErrors=!1,e.TAG="ApplicationInsights:",e}();qs.exports=Tp});var Qr=p(He=>{"use strict";var Os=He&&He.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e};Object.defineProperty(He,"__esModule",{value:!0});var Qe=Xe(),Ip=require("events"),bp;(function(e){e[e.INTERNAL=0]="INTERNAL",e[e.SERVER=1]="SERVER",e[e.CLIENT=2]="CLIENT",e[e.PRODUCER=3]="PRODUCER",e[e.CONSUMER=4]="CONSUMER"})(bp=He.SpanKind||(He.SpanKind={}));var ks=function(){function e(){}return e.prototype.active=function(){var t=this,r=Qe.CorrelationContextManager.getCurrentContext();return Os({},r,{getValue:function(n){return t._activeSymbol?n===t._activeSymbol?r:!1:(t._activeSymbol=n,r)},setValue:function(){}})},e.prototype.with=function(t,r){var n=t.parentSpanId,i=t.name,a=e._spanToContext(t,n,i);return Qe.CorrelationContextManager.runWithContext(a,r)()},e.prototype.bind=function(t){return typeof t=="function"?Qe.CorrelationContextManager.wrapCallback(t):(t instanceof Ip.EventEmitter&&Qe.CorrelationContextManager.wrapEmitter(t),t)},e.prototype.enable=function(){return Qe.CorrelationContextManager.enable(),this},e.prototype.disable=function(){return Qe.CorrelationContextManager.disable(),this},e._spanToContext=function(t,r,n){var i=r?"|"+t.context().traceId+"."+r+".":t.context().traceId,a=Os({},t.context(),{traceFlags:t.context().traceFlags.toString()}),s=Qe.CorrelationContextManager.spanToContextObject(a,i,n);return s},e}();He.OpenTelemetryScopeManagerWrapper=ks;He.AsyncScopeManager=new ks});var nn=p((E,Ws)=>{E=Ws.exports=I;var A;typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?A=function(){var e=Array.prototype.slice.call(arguments,0);e.unshift("SEMVER"),console.log.apply(console,e)}:A=function(){};E.SEMVER_SPEC_VERSION="2.0.0";var Zt=256,Xr=Number.MAX_SAFE_INTEGER||9007199254740991,ii=16,xp=Zt-6,er=E.re=[],R=E.safeRe=[],h=E.src=[],C=0,ci="[a-zA-Z0-9-]",ai=[["\\s",1],["\\d",Zt],[ci,xp]];function en(e){for(var t=0;t<ai.length;t++){var r=ai[t][0],n=ai[t][1];e=e.split(r+"*").join(r+"{0,"+n+"}").split(r+"+").join(r+"{1,"+n+"}")}return e}var vt=C++;h[vt]="0|[1-9]\\d*";var gt=C++;h[gt]="\\d+";var li=C++;h[li]="\\d*[a-zA-Z-]"+ci+"*";var Ls=C++;h[Ls]="("+h[vt]+")\\.("+h[vt]+")\\.("+h[vt]+")";var Ms=C++;h[Ms]="("+h[gt]+")\\.("+h[gt]+")\\.("+h[gt]+")";var si=C++;h[si]="(?:"+h[vt]+"|"+h[li]+")";var oi=C++;h[oi]="(?:"+h[gt]+"|"+h[li]+")";var fi=C++;h[fi]="(?:-("+h[si]+"(?:\\."+h[si]+")*))";var pi=C++;h[pi]="(?:-?("+h[oi]+"(?:\\."+h[oi]+")*))";var ui=C++;h[ui]=ci+"+";var rr=C++;h[rr]="(?:\\+("+h[ui]+"(?:\\."+h[ui]+")*))";var di=C++,Hs="v?"+h[Ls]+h[fi]+"?"+h[rr]+"?";h[di]="^"+Hs+"$";var hi="[v=\\s]*"+h[Ms]+h[pi]+"?"+h[rr]+"?",vi=C++;h[vi]="^"+hi+"$";var Ct=C++;h[Ct]="((?:<|>)?=?)";var Kr=C++;h[Kr]=h[gt]+"|x|X|\\*";var Wr=C++;h[Wr]=h[vt]+"|x|X|\\*";var Ke=C++;h[Ke]="[v=\\s]*("+h[Wr]+")(?:\\.("+h[Wr]+")(?:\\.("+h[Wr]+")(?:"+h[fi]+")?"+h[rr]+"?)?)?";var mt=C++;h[mt]="[v=\\s]*("+h[Kr]+")(?:\\.("+h[Kr]+")(?:\\.("+h[Kr]+")(?:"+h[pi]+")?"+h[rr]+"?)?)?";var js=C++;h[js]="^"+h[Ct]+"\\s*"+h[Ke]+"$";var Fs=C++;h[Fs]="^"+h[Ct]+"\\s*"+h[mt]+"$";var Us=C++;h[Us]="(?:^|[^\\d])(\\d{1,"+ii+"})(?:\\.(\\d{1,"+ii+"}))?(?:\\.(\\d{1,"+ii+"}))?(?:$|[^\\d])";var tn=C++;h[tn]="(?:~>?)";var yt=C++;h[yt]="(\\s*)"+h[tn]+"\\s+";er[yt]=new RegExp(h[yt],"g");R[yt]=new RegExp(en(h[yt]),"g");var Sp="$1~",$s=C++;h[$s]="^"+h[tn]+h[Ke]+"$";var Vs=C++;h[Vs]="^"+h[tn]+h[mt]+"$";var rn=C++;h[rn]="(?:\\^)";var Et=C++;h[Et]="(\\s*)"+h[rn]+"\\s+";er[Et]=new RegExp(h[Et],"g");R[Et]=new RegExp(en(h[Et]),"g");var wp="$1^",Bs=C++;h[Bs]="^"+h[rn]+h[Ke]+"$";var Gs=C++;h[Gs]="^"+h[rn]+h[mt]+"$";var gi=C++;h[gi]="^"+h[Ct]+"\\s*("+hi+")$|^$";var _i=C++;h[_i]="^"+h[Ct]+"\\s*("+Hs+")$|^$";var We=C++;h[We]="(\\s*)"+h[Ct]+"\\s*("+hi+"|"+h[Ke]+")";er[We]=new RegExp(h[We],"g");R[We]=new RegExp(en(h[We]),"g");var Ap="$1$2$3",zs=C++;h[zs]="^\\s*("+h[Ke]+")\\s+-\\s+("+h[Ke]+")\\s*$";var Qs=C++;h[Qs]="^\\s*("+h[mt]+")\\s+-\\s+("+h[mt]+")\\s*$";var Xs=C++;h[Xs]="(<|>)?=?\\s*\\*";for(Ce=0;Ce<C;Ce++)A(Ce,h[Ce]),er[Ce]||(er[Ce]=new RegExp(h[Ce]),R[Ce]=new RegExp(en(h[Ce])));var Ce;E.parse=Ye;function Ye(e,t){if((!t||typeof t!="object")&&(t={loose:!!t,includePrerelease:!1}),e instanceof I)return e;if(typeof e!="string"||e.length>Zt)return null;var r=t.loose?R[vi]:R[di];if(!r.test(e))return null;try{return new I(e,t)}catch{return null}}E.valid=Dp;function Dp(e,t){var r=Ye(e,t);return r?r.version:null}E.clean=Rp;function Rp(e,t){var r=Ye(e.trim().replace(/^[=v]+/,""),t);return r?r.version:null}E.SemVer=I;function I(e,t){if((!t||typeof t!="object")&&(t={loose:!!t,includePrerelease:!1}),e instanceof I){if(e.loose===t.loose)return e;e=e.version}else if(typeof e!="string")throw new TypeError("Invalid Version: "+e);if(e.length>Zt)throw new TypeError("version is longer than "+Zt+" characters");if(!(this instanceof I))return new I(e,t);A("SemVer",e,t),this.options=t,this.loose=!!t.loose;var r=e.trim().match(t.loose?R[vi]:R[di]);if(!r)throw new TypeError("Invalid Version: "+e);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>Xr||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Xr||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Xr||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(function(n){if(/^[0-9]+$/.test(n)){var i=+n;if(i>=0&&i<Xr)return i}return n}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}I.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version};I.prototype.toString=function(){return this.version};I.prototype.compare=function(e){return A("SemVer.compare",this.version,this.options,e),e instanceof I||(e=new I(e,this.options)),this.compareMain(e)||this.comparePre(e)};I.prototype.compareMain=function(e){return e instanceof I||(e=new I(e,this.options)),_t(this.major,e.major)||_t(this.minor,e.minor)||_t(this.patch,e.patch)};I.prototype.comparePre=function(e){if(e instanceof I||(e=new I(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;var t=0;do{var r=this.prerelease[t],n=e.prerelease[t];if(A("prerelease compare",t,r,n),r===void 0&&n===void 0)return 0;if(n===void 0)return 1;if(r===void 0)return-1;if(r===n)continue;return _t(r,n)}while(++t)};I.prototype.inc=function(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",t),this.inc("pre",t);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{for(var r=this.prerelease.length;--r>=0;)typeof this.prerelease[r]=="number"&&(this.prerelease[r]++,r=-2);r===-1&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error("invalid increment argument: "+e)}return this.format(),this.raw=this.version,this};E.inc=Pp;function Pp(e,t,r,n){typeof r=="string"&&(n=r,r=void 0);try{return new I(e,r).inc(t,n).version}catch{return null}}E.diff=qp;function qp(e,t){if(mi(e,t))return null;var r=Ye(e),n=Ye(t),i="";if(r.prerelease.length||n.prerelease.length){i="pre";var a="prerelease"}for(var s in r)if((s==="major"||s==="minor"||s==="patch")&&r[s]!==n[s])return i+s;return a}E.compareIdentifiers=_t;var Ns=/^[0-9]+$/;function _t(e,t){var r=Ns.test(e),n=Ns.test(t);return r&&n&&(e=+e,t=+t),e===t?0:r&&!n?-1:n&&!r?1:e<t?-1:1}E.rcompareIdentifiers=Op;function Op(e,t){return _t(t,e)}E.major=kp;function kp(e,t){return new I(e,t).major}E.minor=Np;function Np(e,t){return new I(e,t).minor}E.patch=Lp;function Lp(e,t){return new I(e,t).patch}E.compare=Se;function Se(e,t,r){return new I(e,r).compare(new I(t,r))}E.compareLoose=Mp;function Mp(e,t){return Se(e,t,!0)}E.rcompare=Hp;function Hp(e,t,r){return Se(t,e,r)}E.sort=jp;function jp(e,t){return e.sort(function(r,n){return E.compare(r,n,t)})}E.rsort=Fp;function Fp(e,t){return e.sort(function(r,n){return E.rcompare(r,n,t)})}E.gt=tr;function tr(e,t,r){return Se(e,t,r)>0}E.lt=Yr;function Yr(e,t,r){return Se(e,t,r)<0}E.eq=mi;function mi(e,t,r){return Se(e,t,r)===0}E.neq=Ks;function Ks(e,t,r){return Se(e,t,r)!==0}E.gte=yi;function yi(e,t,r){return Se(e,t,r)>=0}E.lte=Ei;function Ei(e,t,r){return Se(e,t,r)<=0}E.cmp=Jr;function Jr(e,t,r,n){switch(t){case"===":return typeof e=="object"&&(e=e.version),typeof r=="object"&&(r=r.version),e===r;case"!==":return typeof e=="object"&&(e=e.version),typeof r=="object"&&(r=r.version),e!==r;case"":case"=":case"==":return mi(e,r,n);case"!=":return Ks(e,r,n);case">":return tr(e,r,n);case">=":return yi(e,r,n);case"<":return Yr(e,r,n);case"<=":return Ei(e,r,n);default:throw new TypeError("Invalid operator: "+t)}}E.Comparator=le;function le(e,t){if((!t||typeof t!="object")&&(t={loose:!!t,includePrerelease:!1}),e instanceof le){if(e.loose===!!t.loose)return e;e=e.value}if(!(this instanceof le))return new le(e,t);e=e.trim().split(/\s+/).join(" "),A("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===nr?this.value="":this.value=this.operator+this.semver.version,A("comp",this)}var nr={};le.prototype.parse=function(e){var t=this.options.loose?R[gi]:R[_i],r=e.match(t);if(!r)throw new TypeError("Invalid comparator: "+e);this.operator=r[1],this.operator==="="&&(this.operator=""),r[2]?this.semver=new I(r[2],this.options.loose):this.semver=nr};le.prototype.toString=function(){return this.value};le.prototype.test=function(e){return A("Comparator.test",e,this.options.loose),this.semver===nr?!0:(typeof e=="string"&&(e=new I(e,this.options)),Jr(e,this.operator,this.semver,this.options))};le.prototype.intersects=function(e,t){if(!(e instanceof le))throw new TypeError("a Comparator is required");(!t||typeof t!="object")&&(t={loose:!!t,includePrerelease:!1});var r;if(this.operator==="")return r=new N(e.value,t),Zr(this.value,r,t);if(e.operator==="")return r=new N(this.value,t),Zr(e.semver,r,t);var n=(this.operator===">="||this.operator===">")&&(e.operator===">="||e.operator===">"),i=(this.operator==="<="||this.operator==="<")&&(e.operator==="<="||e.operator==="<"),a=this.semver.version===e.semver.version,s=(this.operator===">="||this.operator==="<=")&&(e.operator===">="||e.operator==="<="),o=Jr(this.semver,"<",e.semver,t)&&(this.operator===">="||this.operator===">")&&(e.operator==="<="||e.operator==="<"),u=Jr(this.semver,">",e.semver,t)&&(this.operator==="<="||this.operator==="<")&&(e.operator===">="||e.operator===">");return n||i||a&&s||o||u};E.Range=N;function N(e,t){if((!t||typeof t!="object")&&(t={loose:!!t,includePrerelease:!1}),e instanceof N)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new N(e.raw,t);if(e instanceof le)return new N(e.value,t);if(!(this instanceof N))return new N(e,t);if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().split(/\s+/).join(" "),this.set=this.raw.split("||").map(function(r){return this.parseRange(r.trim())},this).filter(function(r){return r.length}),!this.set.length)throw new TypeError("Invalid SemVer Range: "+this.raw);this.format()}N.prototype.format=function(){return this.range=this.set.map(function(e){return e.join(" ").trim()}).join("||").trim(),this.range};N.prototype.toString=function(){return this.range};N.prototype.parseRange=function(e){var t=this.options.loose,r=t?R[Qs]:R[zs];e=e.replace(r,Wp),A("hyphen replace",e),e=e.replace(R[We],Ap),A("comparator trim",e,R[We]),e=e.replace(R[yt],Sp),e=e.replace(R[Et],wp);var n=t?R[gi]:R[_i],i=e.split(" ").map(function(a){return $p(a,this.options)},this).join(" ").split(/\s+/);return this.options.loose&&(i=i.filter(function(a){return!!a.match(n)})),i=i.map(function(a){return new le(a,this.options)},this),i};N.prototype.intersects=function(e,t){if(!(e instanceof N))throw new TypeError("a Range is required");return this.set.some(function(r){return r.every(function(n){return e.set.some(function(i){return i.every(function(a){return n.intersects(a,t)})})})})};E.toComparators=Up;function Up(e,t){return new N(e,t).set.map(function(r){return r.map(function(n){return n.value}).join(" ").trim().split(" ")})}function $p(e,t){return A("comp",e,t),e=Gp(e,t),A("caret",e),e=Vp(e,t),A("tildes",e),e=Qp(e,t),A("xrange",e),e=Kp(e,t),A("stars",e),e}function ee(e){return!e||e.toLowerCase()==="x"||e==="*"}function Vp(e,t){return e.trim().split(/\s+/).map(function(r){return Bp(r,t)}).join(" ")}function Bp(e,t){var r=t.loose?R[Vs]:R[$s];return e.replace(r,function(n,i,a,s,o){A("tilde",e,n,i,a,s,o);var u;return ee(i)?u="":ee(a)?u=">="+i+".0.0 <"+(+i+1)+".0.0":ee(s)?u=">="+i+"."+a+".0 <"+i+"."+(+a+1)+".0":o?(A("replaceTilde pr",o),u=">="+i+"."+a+"."+s+"-"+o+" <"+i+"."+(+a+1)+".0"):u=">="+i+"."+a+"."+s+" <"+i+"."+(+a+1)+".0",A("tilde return",u),u})}function Gp(e,t){return e.trim().split(/\s+/).map(function(r){return zp(r,t)}).join(" ")}function zp(e,t){A("caret",e,t);var r=t.loose?R[Gs]:R[Bs];return e.replace(r,function(n,i,a,s,o){A("caret",e,n,i,a,s,o);var u;return ee(i)?u="":ee(a)?u=">="+i+".0.0 <"+(+i+1)+".0.0":ee(s)?i==="0"?u=">="+i+"."+a+".0 <"+i+"."+(+a+1)+".0":u=">="+i+"."+a+".0 <"+(+i+1)+".0.0":o?(A("replaceCaret pr",o),i==="0"?a==="0"?u=">="+i+"."+a+"."+s+"-"+o+" <"+i+"."+a+"."+(+s+1):u=">="+i+"."+a+"."+s+"-"+o+" <"+i+"."+(+a+1)+".0":u=">="+i+"."+a+"."+s+"-"+o+" <"+(+i+1)+".0.0"):(A("no pr"),i==="0"?a==="0"?u=">="+i+"."+a+"."+s+" <"+i+"."+a+"."+(+s+1):u=">="+i+"."+a+"."+s+" <"+i+"."+(+a+1)+".0":u=">="+i+"."+a+"."+s+" <"+(+i+1)+".0.0"),A("caret return",u),u})}function Qp(e,t){return A("replaceXRanges",e,t),e.split(/\s+/).map(function(r){return Xp(r,t)}).join(" ")}function Xp(e,t){e=e.trim();var r=t.loose?R[Fs]:R[js];return e.replace(r,function(n,i,a,s,o,u){A("xRange",e,n,i,a,s,o,u);var c=ee(a),l=c||ee(s),f=l||ee(o),d=f;return i==="="&&d&&(i=""),c?i===">"||i==="<"?n="<0.0.0":n="*":i&&d?(l&&(s=0),o=0,i===">"?(i=">=",l?(a=+a+1,s=0,o=0):(s=+s+1,o=0)):i==="<="&&(i="<",l?a=+a+1:s=+s+1),n=i+a+"."+s+"."+o):l?n=">="+a+".0.0 <"+(+a+1)+".0.0":f&&(n=">="+a+"."+s+".0 <"+a+"."+(+s+1)+".0"),A("xRange return",n),n})}function Kp(e,t){return A("replaceStars",e,t),e.trim().replace(R[Xs],"")}function Wp(e,t,r,n,i,a,s,o,u,c,l,f,d){return ee(r)?t="":ee(n)?t=">="+r+".0.0":ee(i)?t=">="+r+"."+n+".0":t=">="+t,ee(u)?o="":ee(c)?o="<"+(+u+1)+".0.0":ee(l)?o="<"+u+"."+(+c+1)+".0":f?o="<="+u+"."+c+"."+l+"-"+f:o="<="+o,(t+" "+o).trim()}N.prototype.test=function(e){if(!e)return!1;typeof e=="string"&&(e=new I(e,this.options));for(var t=0;t<this.set.length;t++)if(Yp(this.set[t],e,this.options))return!0;return!1};function Yp(e,t,r){for(var n=0;n<e.length;n++)if(!e[n].test(t))return!1;if(t.prerelease.length&&!r.includePrerelease){for(n=0;n<e.length;n++)if(A(e[n].semver),e[n].semver!==nr&&e[n].semver.prerelease.length>0){var i=e[n].semver;if(i.major===t.major&&i.minor===t.minor&&i.patch===t.patch)return!0}return!1}return!0}E.satisfies=Zr;function Zr(e,t,r){try{t=new N(t,r)}catch{return!1}return t.test(e)}E.maxSatisfying=Jp;function Jp(e,t,r){var n=null,i=null;try{var a=new N(t,r)}catch{return null}return e.forEach(function(s){a.test(s)&&(!n||i.compare(s)===-1)&&(n=s,i=new I(n,r))}),n}E.minSatisfying=Zp;function Zp(e,t,r){var n=null,i=null;try{var a=new N(t,r)}catch{return null}return e.forEach(function(s){a.test(s)&&(!n||i.compare(s)===1)&&(n=s,i=new I(n,r))}),n}E.minVersion=ed;function ed(e,t){e=new N(e,t);var r=new I("0.0.0");if(e.test(r)||(r=new I("0.0.0-0"),e.test(r)))return r;r=null;for(var n=0;n<e.set.length;++n){var i=e.set[n];i.forEach(function(a){var s=new I(a.semver.version);switch(a.operator){case">":s.prerelease.length===0?s.patch++:s.prerelease.push(0),s.raw=s.format();case"":case">=":(!r||tr(r,s))&&(r=s);break;case"<":case"<=":break;default:throw new Error("Unexpected operation: "+a.operator)}})}return r&&e.test(r)?r:null}E.validRange=td;function td(e,t){try{return new N(e,t).range||"*"}catch{return null}}E.ltr=rd;function rd(e,t,r){return Ci(e,t,"<",r)}E.gtr=nd;function nd(e,t,r){return Ci(e,t,">",r)}E.outside=Ci;function Ci(e,t,r,n){e=new I(e,n),t=new N(t,n);var i,a,s,o,u;switch(r){case">":i=tr,a=Ei,s=Yr,o=">",u=">=";break;case"<":i=Yr,a=yi,s=tr,o="<",u="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(Zr(e,t,n))return!1;for(var c=0;c<t.set.length;++c){var l=t.set[c],f=null,d=null;if(l.forEach(function(g){g.semver===nr&&(g=new le(">=0.0.0")),f=f||g,d=d||g,i(g.semver,f.semver,n)?f=g:s(g.semver,d.semver,n)&&(d=g)}),f.operator===o||f.operator===u||(!d.operator||d.operator===o)&&a(e,d.semver))return!1;if(d.operator===u&&s(e,d.semver))return!1}return!0}E.prerelease=id;function id(e,t){var r=Ye(e,t);return r&&r.prerelease.length?r.prerelease:null}E.intersects=ad;function ad(e,t,r){return e=new N(e,r),t=new N(t,r),e.intersects(t)}E.coerce=sd;function sd(e){if(e instanceof I)return e;if(typeof e!="string")return null;var t=e.match(R[Us]);return t==null?null:Ye(t[1]+"."+(t[2]||"0")+"."+(t[3]||"0"))}});var Ii=p(Ti=>{"use strict";Object.defineProperty(Ti,"__esModule",{value:!0});var od=require("path"),ud=nn(),Js=require("module"),cd=Object.keys(process.binding("natives")),Ys=Js.prototype.require;function ld(e){var t={};return function(n){var i=Ys.apply(this,arguments);if(e[n]){var a=Js._resolveFilename(n,this);if(t.hasOwnProperty(a))return t[a];var s=void 0;if(cd.indexOf(n)<0)try{s=Ys.call(this,od.join(n,"package.json")).version}catch{return i}else s=process.version.substring(1);var o=s.indexOf("-");o>=0&&(s=s.substring(0,o));for(var u=i,c=0,l=e[n];c<l.length;c++){var f=l[c];ud.satisfies(s,f.versionSpecifier)&&(u=f.patch(u,a))}return t[a]=u}return i}}Ti.makePatchingRequire=ld});var Zs=p((sy,fd)=>{fd.exports={name:"diagnostic-channel",version:"0.3.1",main:"./dist/src/channel.js",types:"./dist/src/channel.d.ts",scripts:{build:"tsc",lint:"tslint -c tslint.json -p tsconfig.json",clean:"rimraf ./dist",test:"mocha ./dist/tests/**/*.js"},homepage:"https://github.com/Microsoft/node-diagnostic-channel",bugs:{url:"https://github.com/Microsoft/node-diagnostic-channel/issues"},repository:{type:"git",url:"https://github.com/Microsoft/node-diagnostic-channel.git"},description:"Provides a context-saving pub/sub channel to connect diagnostic event publishers and subscribers",dependencies:{semver:"^5.3.0"},devDependencies:{"@types/mocha":"^2.2.40","@types/node":"^7.0.12",mocha:"^3.2.0",rimraf:"^2.6.1",tslint:"^5.0.0",typescript:"^2.2.1"},files:["dist/src/**/*.d.ts","dist/src/**/*.js","LICENSE","README.md","package.json"],license:"MIT"}});var j=p(an=>{"use strict";Object.defineProperty(an,"__esModule",{value:!0});var pd=Ii(),dd=Ii();an.makePatchingRequire=dd.makePatchingRequire;var eo=function(e){return!0},hd=function(){function e(){this.version=Zs().version,this.subscribers={},this.contextPreservationFunction=function(t){return t},this.knownPatches={},this.currentlyPublishing=!1}return e.prototype.shouldPublish=function(t){var r=this.subscribers[t];return r?r.some(function(n){var i=n.filter;return!i||i(!1)}):!1},e.prototype.publish=function(t,r){if(!this.currentlyPublishing){var n=this.subscribers[t];if(n){var i={timestamp:Date.now(),data:r};this.currentlyPublishing=!0,n.forEach(function(a){var s=a.listener,o=a.filter;try{o&&o(!0)&&s(i)}catch{}}),this.currentlyPublishing=!1}}},e.prototype.subscribe=function(t,r,n){n===void 0&&(n=eo),this.subscribers[t]||(this.subscribers[t]=[]),this.subscribers[t].push({listener:r,filter:n})},e.prototype.unsubscribe=function(t,r,n){n===void 0&&(n=eo);var i=this.subscribers[t];if(i){for(var a=0;a<i.length;++a)if(i[a].listener===r&&i[a].filter===n)return i.splice(a,1),!0}return!1},e.prototype.reset=function(){var t=this;this.subscribers={},this.contextPreservationFunction=function(r){return r},Object.getOwnPropertyNames(this.knownPatches).forEach(function(r){return delete t.knownPatches[r]})},e.prototype.bindToContext=function(t){return this.contextPreservationFunction(t)},e.prototype.addContextPreservation=function(t){var r=this.contextPreservationFunction;this.contextPreservationFunction=function(n){return t(r(n))}},e.prototype.registerMonkeyPatch=function(t,r){this.knownPatches[t]||(this.knownPatches[t]=[]),this.knownPatches[t].push(r)},e.prototype.getPatchesObject=function(){return this.knownPatches},e}();global.diagnosticsSource||(global.diagnosticsSource=new hd,to=require("module"),to.prototype.require=pd.makePatchingRequire(global.diagnosticsSource.getPatchesObject()));var to;an.channel=global.diagnosticsSource});var no=p(we=>{"use strict";var vd=we&&we.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e};Object.defineProperty(we,"__esModule",{value:!0});var sn=j();we.AzureMonitorSymbol="Azure_Monitor_Tracer";var ro=!1,gd=function(e){if(ro)return e;try{var t=require("@opentelemetry/tracing"),r=require("@opentelemetry/api"),n=sn.channel.spanContextPropagator?{contextManager:sn.channel.spanContextPropagator}:void 0;new t.BasicTracerProvider().register(n);var i=r.trace.getTracer("applicationinsights tracer"),a=i.startSpan;i.startSpan=function(s,o){if(!o||!o.parent){var u=r.getSpan(r.context.active());u&&u.operation&&u.operation.traceparent&&(o=vd({},o,{parent:{traceId:u.operation.traceparent.traceId,spanId:u.operation.traceparent.spanId,traceFlags:1}}))}var c=a.call(this,s,o),l=c.end;return c.end=function(){var f=l.apply(this,arguments);return sn.channel.publish("azure-coretracing",c),f},c},r.getSpan(r.context.active()),i[we.AzureMonitorSymbol]=!0,e.setTracer(i),ro=!0}catch{}return e};we.azureCoreTracing={versionSpecifier:">= 1.0.0 < 2.0.0",patch:gd};function _d(){sn.channel.registerMonkeyPatch("@azure/core-tracing",we.azureCoreTracing)}we.enable=_d});var ao=p(ir=>{"use strict";Object.defineProperty(ir,"__esModule",{value:!0});var io=j(),md=function(e){var t=e.prototype._emit;return e.prototype._emit=function(r,n){var i=t.apply(this,arguments);if(!n){var a=i;a||(a=t.call(this,r,!0)),io.channel.publish("bunyan",{level:r.level,result:a})}return i},e};ir.bunyan={versionSpecifier:">= 1.0.0 < 2.0.0",patch:md};function yd(){io.channel.registerMonkeyPatch("bunyan",ir.bunyan)}ir.enable=yd});var oo=p(ar=>{"use strict";Object.defineProperty(ar,"__esModule",{value:!0});var bi=j(),so=require("stream"),Ed=function(e){var t=new so.Writable,r=new so.Writable;t.write=function(c){if(!c)return!0;var l=c.toString();return bi.channel.publish("console",{message:l}),!0},r.write=function(c){if(!c)return!0;var l=c.toString();return bi.channel.publish("console",{message:l,stderr:!0}),!0};for(var n=new e.Console(t,r),i=["log","info","warn","error","dir","time","timeEnd","trace","assert"],a=function(c){var l=e[c];l&&(e[c]=function(){if(n[c])try{n[c].apply(n,arguments)}catch{}return l.apply(e,arguments)})},s=0,o=i;s<o.length;s++){var u=o[s];a(u)}return e};ar.console={versionSpecifier:">= 4.0.0",patch:Ed};function Cd(){bi.channel.registerMonkeyPatch("console",ar.console),require("console")}ar.enable=Cd});var uo=p(sr=>{"use strict";Object.defineProperty(sr,"__esModule",{value:!0});var xi=j(),Td=function(e){var t=e.Server.prototype.connect;return e.Server.prototype.connect=function(){var n=t.apply(this,arguments),i=this.s.pool.write;this.s.pool.write=function(){var o=typeof arguments[1]=="function"?1:2;return typeof arguments[o]=="function"&&(arguments[o]=xi.channel.bindToContext(arguments[o])),i.apply(this,arguments)};var a=this.s.pool.logout;return this.s.pool.logout=function(){return typeof arguments[1]=="function"&&(arguments[1]=xi.channel.bindToContext(arguments[1])),a.apply(this,arguments)},n},e};sr.mongoCore={versionSpecifier:">= 2.0.0 < 4.0.0",patch:Td};function Id(){xi.channel.registerMonkeyPatch("mongodb-core",sr.mongoCore)}sr.enable=Id});var lo=p(ve=>{"use strict";var co=ve&&ve.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e};Object.defineProperty(ve,"__esModule",{value:!0});var W=j(),bd=function(e){var t=e.instrument({operationIdGenerator:{next:function(){return W.channel.bindToContext(function(n){return n()})}}}),r={};return t.on("started",function(n){r[n.requestId]||(r[n.requestId]=co({},n,{time:new Date}))}),t.on("succeeded",function(n){var i=r[n.requestId];i&&delete r[n.requestId],typeof n.operationId=="function"?n.operationId(function(){return W.channel.publish("mongodb",{startedData:i,event:n,succeeded:!0})}):W.channel.publish("mongodb",{startedData:i,event:n,succeeded:!0})}),t.on("failed",function(n){var i=r[n.requestId];i&&delete r[n.requestId],typeof n.operationId=="function"?n.operationId(function(){return W.channel.publish("mongodb",{startedData:i,event:n,succeeded:!1})}):W.channel.publish("mongodb",{startedData:i,event:n,succeeded:!1})}),e},xd=function(e){var t=e.instrument(),r={},n={};return t.on("started",function(i){r[i.requestId]||(n[i.requestId]=W.channel.bindToContext(function(a){return a()}),r[i.requestId]=co({},i,{time:new Date}))}),t.on("succeeded",function(i){var a=r[i.requestId];a&&delete r[i.requestId],typeof i=="object"&&typeof n[i.requestId]=="function"&&(n[i.requestId](function(){return W.channel.publish("mongodb",{startedData:a,event:i,succeeded:!0})}),delete n[i.requestId])}),t.on("failed",function(i){var a=r[i.requestId];a&&delete r[i.requestId],typeof i=="object"&&typeof n[i.requestId]=="function"&&(n[i.requestId](function(){return W.channel.publish("mongodb",{startedData:a,event:i,succeeded:!1})}),delete n[i.requestId])}),e},Sd=function(e){var t=e.Server.prototype.connect;return e.Server.prototype.connect=function(){var n=t.apply(this,arguments),i=this.s.coreTopology.s.pool.write;this.s.coreTopology.s.pool.write=function(){var o=typeof arguments[1]=="function"?1:2;return typeof arguments[o]=="function"&&(arguments[o]=W.channel.bindToContext(arguments[o])),i.apply(this,arguments)};var a=this.s.coreTopology.s.pool.logout;return this.s.coreTopology.s.pool.logout=function(){return typeof arguments[1]=="function"&&(arguments[1]=W.channel.bindToContext(arguments[1])),a.apply(this,arguments)},n},e},wd=function(e){Sd(e);var t=e.instrument(),r={},n={};return t.on("started",function(i){r[i.requestId]||(n[i.requestId]=W.channel.bindToContext(function(a){return a()}),r[i.requestId]=i)}),t.on("succeeded",function(i){var a=r[i.requestId];a&&delete r[i.requestId],typeof i=="object"&&typeof n[i.requestId]=="function"&&(n[i.requestId](function(){return W.channel.publish("mongodb",{startedData:a,event:i,succeeded:!0})}),delete n[i.requestId])}),t.on("failed",function(i){var a=r[i.requestId];a&&delete r[i.requestId],typeof i=="object"&&typeof n[i.requestId]=="function"&&(n[i.requestId](function(){return W.channel.publish("mongodb",{startedData:a,event:i,succeeded:!1})}),delete n[i.requestId])}),e};ve.mongo2={versionSpecifier:">= 2.0.0 <= 3.0.5",patch:bd};ve.mongo3={versionSpecifier:"> 3.0.5 < 3.3.0",patch:xd};ve.mongo330={versionSpecifier:">= 3.3.0 < 4.0.0",patch:wd};function Ad(){W.channel.registerMonkeyPatch("mongodb",ve.mongo2),W.channel.registerMonkeyPatch("mongodb",ve.mongo3),W.channel.registerMonkeyPatch("mongodb",ve.mongo330)}ve.enable=Ad});var po=p(or=>{"use strict";Object.defineProperty(or,"__esModule",{value:!0});var on=j(),fo=require("path"),Dd=function(e,t){var r=function(u,c){return function(l,f){var d=u[l];d&&(u[l]=function(){for(var _=arguments.length-1,T=arguments.length-1;T>=0;--T)if(typeof arguments[T]=="function"){_=T;break}else if(typeof arguments[T]<"u")break;var k=arguments[_],q={result:null,startTime:null,startDate:null};typeof k=="function"&&(f?(q.startTime=process.hrtime(),q.startDate=new Date,arguments[_]=on.channel.bindToContext(f(q,k))):arguments[_]=on.channel.bindToContext(k));var v=d.apply(this,arguments);return q.result=v,v})}},n=function(u,c){return r(u.prototype,c+".prototype")},i=["connect","changeUser","ping","statistics","end"],a=require(fo.dirname(t)+"/lib/Connection");i.forEach(function(u){return n(a,"Connection")(u)}),r(a,"Connection")("createQuery",function(u,c){return function(l){var f=process.hrtime(u.startTime),d=f[0]*1e3+f[1]/1e6|0;on.channel.publish("mysql",{query:u.result,callbackArgs:arguments,err:l,duration:d,time:u.startDate}),c.apply(this,arguments)}});var s=["_enqueueCallback"],o=require(fo.dirname(t)+"/lib/Pool");return s.forEach(function(u){return n(o,"Pool")(u)}),e};or.mysql={versionSpecifier:">= 2.0.0 < 3.0.0",patch:Dd};function Rd(){on.channel.registerMonkeyPatch("mysql",or.mysql)}or.enable=Rd});var vo=p(ur=>{"use strict";Object.defineProperty(ur,"__esModule",{value:!0});var ho=j();function Pd(e){var t=e.prototype.connect;return e.prototype.connect=function(n){return n&&(arguments[0]=ho.channel.bindToContext(n)),t.apply(this,arguments)},e}ur.postgresPool1={versionSpecifier:">= 1.0.0 < 3.0.0",patch:Pd};function qd(){ho.channel.registerMonkeyPatch("pg-pool",ur.postgresPool1)}ur.enable=qd});var _o=p(Je=>{"use strict";Object.defineProperty(Je,"__esModule",{value:!0});var Tt=j(),go=require("events");function Od(e,t){var r=e.Client.prototype.query,n="__diagnosticOriginalFunc";return e.Client.prototype.query=function(a,s,o){var u={query:{},database:{host:this.connectionParameters.host,port:this.connectionParameters.port},result:null,error:null,duration:0,time:new Date},c=process.hrtime(),l;function f(d){d&&d[n]&&(d=d[n]);var g=Tt.channel.bindToContext(function(_,T){var k=process.hrtime(c);if(u.result=T&&{rowCount:T.rowCount,command:T.command},u.error=_,u.duration=Math.ceil(k[0]*1e3+k[1]/1e6),Tt.channel.publish("postgres",u),_){if(d)return d.apply(this,arguments);l&&l instanceof go.EventEmitter&&l.emit("error",_)}else d&&d.apply(this,arguments)});try{return Object.defineProperty(g,n,{value:d}),g}catch{return d}}try{typeof a=="string"?s instanceof Array?(u.query.preparable={text:a,args:s},o=f(o)):(u.query.text=a,o?o=f(o):s=f(s)):(typeof a.name=="string"?u.query.plan=a.name:a.values instanceof Array?u.query.preparable={text:a.text,args:a.values}:u.query.text=a.text,o?o=f(o):s?s=f(s):a.callback=f(a.callback))}catch{return r.apply(this,arguments)}return arguments[0]=a,arguments[1]=s,arguments[2]=o,arguments.length=arguments.length>3?arguments.length:3,l=r.apply(this,arguments),l},e}function kd(e,t){var r=e.Client.prototype.query,n="__diagnosticOriginalFunc";return e.Client.prototype.query=function(a,s,o){var u=this,c=!!o,l={query:{},database:{host:this.connectionParameters.host,port:this.connectionParameters.port},result:null,error:null,duration:0,time:new Date},f=process.hrtime(),d;function g(_){_&&_[n]&&(_=_[n]);var T=Tt.channel.bindToContext(function(k,q){var v=process.hrtime(f);if(l.result=q&&{rowCount:q.rowCount,command:q.command},l.error=k,l.duration=Math.ceil(v[0]*1e3+v[1]/1e6),Tt.channel.publish("postgres",l),k){if(_)return _.apply(this,arguments);d&&d instanceof go.EventEmitter&&d.emit("error",k)}else _&&_.apply(this,arguments)});try{return Object.defineProperty(T,n,{value:_}),T}catch{return _}}try{typeof a=="string"?s instanceof Array?(l.query.preparable={text:a,args:s},c=typeof o=="function",o=c?g(o):o):(l.query.text=a,o?(c=typeof o=="function",o=c?g(o):o):(c=typeof s=="function",s=c?g(s):s)):(typeof a.name=="string"?l.query.plan=a.name:a.values instanceof Array?l.query.preparable={text:a.text,args:a.values}:l.query.text=a.text,o?(c=typeof o=="function",o=g(o)):s?(c=typeof s=="function",s=c?g(s):s):(c=typeof a.callback=="function",a.callback=c?g(a.callback):a.callback))}catch{return r.apply(this,arguments)}return arguments[0]=a,arguments[1]=s,arguments[2]=o,arguments.length=arguments.length>3?arguments.length:3,d=r.apply(this,arguments),c?d:d.then(function(_){return g()(void 0,_),new u._Promise(function(T,k){T(_)})}).catch(function(_){return g()(_,void 0),new u._Promise(function(T,k){k(_)})})},e}Je.postgres6={versionSpecifier:"6.*",patch:Od};Je.postgres7={versionSpecifier:">=7.* <=8.*",patch:kd};function Nd(){Tt.channel.registerMonkeyPatch("pg",Je.postgres6),Tt.channel.registerMonkeyPatch("pg",Je.postgres7)}Je.enable=Nd});var mo=p(cr=>{"use strict";Object.defineProperty(cr,"__esModule",{value:!0});var Si=j(),Ld=function(e){var t=e.RedisClient.prototype.internal_send_command;return e.RedisClient.prototype.internal_send_command=function(r){if(r){var n=r.callback;if(!n||!n.pubsubBound){var i=this.address,a=process.hrtime(),s=new Date;r.callback=Si.channel.bindToContext(function(o,u){var c=process.hrtime(a),l=c[0]*1e3+c[1]/1e6|0;Si.channel.publish("redis",{duration:l,address:i,commandObj:r,err:o,result:u,time:s}),typeof n=="function"&&n.apply(this,arguments)}),r.callback.pubsubBound=!0}}return t.call(this,r)},e};cr.redis={versionSpecifier:">= 2.0.0 < 4.0.0",patch:Ld};function Md(){Si.channel.registerMonkeyPatch("redis",cr.redis)}cr.enable=Md});var yo=p(Ze=>{"use strict";var Hd=Ze&&Ze.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e};Object.defineProperty(Ze,"__esModule",{value:!0});var wi=j(),jd=function(e){var t=e.Connection.prototype.makeRequest;return e.Connection.prototype.makeRequest=function(){function n(a){var s=process.hrtime(),o={query:{},database:{host:null,port:null},result:null,error:null,duration:0};return wi.channel.bindToContext(function(u,c,l){var f=process.hrtime(s);o=Hd({},o,{database:{host:this.connection.config.server,port:this.connection.config.options.port},result:!u&&{rowCount:c,rows:l},query:{text:this.parametersByName.statement.value},error:u,duration:Math.ceil(f[0]*1e3+f[1]/1e6)}),wi.channel.publish("tedious",o),a.call(this,u,c,l)})}var i=arguments[0];arguments[0].callback=n(i.callback),t.apply(this,arguments)},e};Ze.tedious={versionSpecifier:">= 6.0.0 < 9.0.0",patch:jd};function Fd(){wi.channel.registerMonkeyPatch("tedious",Ze.tedious)}Ze.enable=Fd});var Eo=p(ge=>{"use strict";var Ud=ge&&ge.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])};return function(t,r){e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),$d=ge&&ge.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&(r[n[i]]=e[n[i]]);return r};Object.defineProperty(ge,"__esModule",{value:!0});var un=j(),Vd=function(e){var t=e.Logger.prototype.log,r,n=function(i,a,s){var o;return r===e.config.npm.levels?o="npm":r===e.config.syslog.levels?o="syslog":o="unknown",un.channel.publish("winston",{level:i,message:a,meta:s,levelKind:o}),a};return e.Logger.prototype.log=function(){return r=this.levels,!this.filters||this.filters.length===0?this.filters=[n]:this.filters[this.filters.length-1]!==n&&(this.filters=this.filters.filter(function(a){return a!==n}),this.filters.push(n)),t.apply(this,arguments)},e},Bd=function(e){var t=function(s,o){var u;return s.config.npm.levels[o]!=null?u="npm":s.config.syslog.levels[o]!=null?u="syslog":u="unknown",u},r=function(s){Ud(o,s);function o(u,c){var l=s.call(this,c)||this;return l.winston=u,l}return o.prototype.log=function(u,c){var l=u.message,f=u.level,d=u.meta,g=$d(u,["message","level","meta"]);f=typeof Symbol.for=="function"?u[Symbol.for("level")]:f,l=u instanceof Error?u:l;var _=t(this.winston,f);d=d||{};for(var T in g)g.hasOwnProperty(T)&&(d[T]=g[T]);un.channel.publish("winston",{message:l,level:f,levelKind:_,meta:d}),c()},o}(e.Transport);function n(){var s=arguments[0].levels||e.config.npm.levels,o;for(var u in s)s.hasOwnProperty(u)&&(o=o===void 0||s[u]>s[o]?u:o);this.add(new r(e,{level:o}))}var i=e.createLogger;e.createLogger=function(){var o=arguments[0].levels||e.config.npm.levels,u;for(var c in o)o.hasOwnProperty(c)&&(u=u===void 0||o[c]>o[u]?c:u);var l=i.apply(this,arguments);l.add(new r(e,{level:u}));var f=l.configure;return l.configure=function(){f.apply(this,arguments),n.apply(this,arguments)},l};var a=e.configure;return e.configure=function(){a.apply(this,arguments),n.apply(this,arguments)},e.add(new r(e)),e};ge.winston3={versionSpecifier:"3.x",patch:Bd};ge.winston2={versionSpecifier:"2.x",patch:Vd};function Gd(){un.channel.registerMonkeyPatch("winston",ge.winston2),un.channel.registerMonkeyPatch("winston",ge.winston3)}ge.enable=Gd});var qo=p(ie=>{"use strict";Object.defineProperty(ie,"__esModule",{value:!0});var Co=no();ie.azuresdk=Co;var To=ao();ie.bunyan=To;var Io=oo();ie.console=Io;var bo=uo();ie.mongodbCore=bo;var xo=lo();ie.mongodb=xo;var So=po();ie.mysql=So;var wo=vo();ie.pgPool=wo;var Ao=_o();ie.pg=Ao;var Do=mo();ie.redis=Do;var Ro=yo();ie.tedious=Ro;var Po=Eo();ie.winston=Po;function zd(){To.enable(),Io.enable(),bo.enable(),xo.enable(),So.enable(),Ao.enable(),wo.enable(),Do.enable(),Po.enable(),Co.enable(),Ro.enable()}ie.enable=zd});var fn=p(It=>{"use strict";Object.defineProperty(It,"__esModule",{value:!0});var Qd=Qr(),Ai=B();It.IsInitialized=!process.env.APPLICATION_INSIGHTS_NO_DIAGNOSTIC_CHANNEL;var Di="DiagnosticChannel";if(It.IsInitialized){_e=qo(),Oo=process.env.APPLICATION_INSIGHTS_NO_PATCH_MODULES||"",cn=Oo.split(","),Ri={bunyan:_e.bunyan,console:_e.console,mongodb:_e.mongodb,mongodbCore:_e.mongodbCore,mysql:_e.mysql,redis:_e.redis,pg:_e.pg,pgPool:_e.pgPool,winston:_e.winston,azuresdk:_e.azuresdk};for(ln in Ri)cn.indexOf(ln)===-1&&(Ri[ln].enable(),Ai.info(Di,"Subscribed to "+ln+" events"));cn.length>0&&Ai.info(Di,"Some modules will not be patched",cn)}else Ai.info(Di,"Not subscribing to dependency autocollection because APPLICATION_INSIGHTS_NO_DIAGNOSTIC_CHANNEL was set");var _e,Oo,cn,Ri,ln;function Xd(e){if(!!It.IsInitialized){var t=j();t.channel.addContextPreservation(e),t.channel.spanContextPropagator=Qd.AsyncScopeManager}}It.registerContextPreservation=Xd});var bt=p((Cy,ko)=>{"use strict";ko.exports={requestContextHeader:"request-context",requestContextSourceKey:"appId",requestContextTargetKey:"appId",requestIdHeader:"request-id",parentIdHeader:"x-ms-request-id",rootIdHeader:"x-ms-request-root-id",correlationContextHeader:"correlation-context",traceparentHeader:"traceparent",traceStateHeader:"tracestate"}});var ue=p((Oi,Lo)=>{"use strict";var Pi=Oi&&Oi.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},Kd=require("http"),No=require("https"),qi=require("url"),pn=require("constants"),lr=B(),xt=bt(),Wd=function(){function e(){}return e.getCookie=function(t,r){var n="";if(t&&t.length&&typeof r=="string")for(var i=t+"=",a=r.split(";"),s=0;s<a.length;s++){var r=a[s];if(r=e.trim(r),r&&r.indexOf(i)===0){n=r.substring(i.length,a[s].length);break}}return n},e.trim=function(t){return typeof t=="string"?t.replace(/^\s+|\s+$/g,""):""},e.int32ArrayToBase64=function(t){var r=function(o,u){return String.fromCharCode(o>>u&255)},n=function(o){return r(o,24)+r(o,16)+r(o,8)+r(o,0)},i=t.map(n).join(""),a=Buffer.from?Buffer.from(i,"binary"):new Buffer(i,"binary"),s=a.toString("base64");return s.substr(0,s.indexOf("="))},e.random32=function(){return 4294967296*Math.random()|0},e.randomu32=function(){return e.random32()+2147483648},e.w3cTraceId=function(){for(var t=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],r="",n,i=0;i<4;i++)n=e.random32(),r+=t[n&15]+t[n>>4&15]+t[n>>8&15]+t[n>>12&15]+t[n>>16&15]+t[n>>20&15]+t[n>>24&15]+t[n>>28&15];var a=t[8+Math.random()*4|0];return r.substr(0,8)+r.substr(9,4)+"4"+r.substr(13,3)+a+r.substr(16,3)+r.substr(19,12)},e.w3cSpanId=function(){return e.w3cTraceId().substring(16)},e.isValidW3CId=function(t){return t.length===32&&t!=="00000000000000000000000000000000"},e.isArray=function(t){return Object.prototype.toString.call(t)==="[object Array]"},e.isError=function(t){return t instanceof Error},e.isPrimitive=function(t){var r=typeof t;return r==="string"||r==="number"||r==="boolean"},e.isDate=function(t){return Object.prototype.toString.call(t)==="[object Date]"},e.msToTimeSpan=function(t){(isNaN(t)||t<0)&&(t=0);var r=(t/1e3%60).toFixed(7).replace(/0{0,4}$/,""),n=""+Math.floor(t/(1e3*60))%60,i=""+Math.floor(t/(1e3*60*60))%24,a=Math.floor(t/(1e3*60*60*24));r=r.indexOf(".")<2?"0"+r:r,n=n.length<2?"0"+n:n,i=i.length<2?"0"+i:i;var s=a>0?a+".":"";return s+i+":"+n+":"+r},e.extractError=function(t){var r=t;return{message:t.message,code:r.code||r.id||""}},e.extractObject=function(t){return t instanceof Error?e.extractError(t):typeof t.toJSON=="function"?t.toJSON():t},e.validateStringMap=function(t){if(typeof t!="object"){lr.info("Invalid properties dropped from payload");return}var r={};for(var n in t){var i="",a=t[n],s=typeof a;if(e.isPrimitive(a))i=a.toString();else if(a===null||s==="undefined")i="";else if(s==="function"){lr.info("key: "+n+" was function; will not serialize");continue}else{var o=e.isArray(a)?a:e.extractObject(a);try{e.isPrimitive(o)?i=o:i=JSON.stringify(o)}catch(u){i=a.constructor.name.toString()+" (Error: "+u.message+")",lr.info("key: "+n+", could not be serialized")}}r[n]=i.substring(0,e.MAX_PROPERTY_LENGTH)}return r},e.canIncludeCorrelationHeader=function(t,r){var n=t&&t.config&&t.config.correlationHeaderExcludedDomains;if(!n||n.length==0||!r)return!0;for(var i=0;i<n.length;i++){var a=new RegExp(n[i].replace(/\./g,".").replace(/\*/g,".*"));if(a.test(qi.parse(r).hostname))return!1}return!0},e.getCorrelationContextTarget=function(t,r){var n=t.headers&&t.headers[xt.requestContextHeader];if(n)for(var i=n.split(","),a=0;a<i.length;++a){var s=i[a].split("=");if(s.length==2&&s[0]==r)return s[1]}},e.makeRequest=function(t,r,n,i){r&&r.indexOf("//")===0&&(r="https:"+r);var a=qi.parse(r),s=Pi({},n,{host:a.hostname,port:a.port,path:a.pathname}),o=void 0;if(a.protocol==="https:"&&(o=t.proxyHttpsUrl||void 0),a.protocol==="http:"&&(o=t.proxyHttpUrl||void 0),o){o.indexOf("//")===0&&(o="http:"+o);var u=qi.parse(o);u.protocol==="https:"?(lr.info("Proxies that use HTTPS are not supported"),o=void 0):s=Pi({},s,{host:u.hostname,port:u.port||"80",path:r,headers:Pi({},s.headers,{Host:a.hostname})})}var c=a.protocol==="https:"&&!o;return c&&t.httpsAgent!==void 0?s.agent=t.httpsAgent:!c&&t.httpAgent!==void 0?s.agent=t.httpAgent:c&&(s.agent=e.tlsRestrictedAgent),c?No.request(s,i):Kd.request(s,i)},e.safeIncludeCorrelationHeader=function(t,r,n){var i;if(typeof n=="string")i=n;else if(n instanceof Array)i=n.join(",");else if(n&&typeof n.toString=="function")try{i=n.toString()}catch(a){lr.warn("Outgoing request-context header could not be read. Correlation of requests may be lost.",a,n)}i?e.addCorrelationIdHeaderFromString(t,r,i):r.setHeader(xt.requestContextHeader,xt.requestContextSourceKey+"="+t.config.correlationId)},e.addCorrelationIdHeaderFromString=function(t,r,n){var i=n.split(","),a=xt.requestContextSourceKey+"=",s=i.some(function(o){return o.substring(0,a.length)===a});s||r.setHeader(xt.requestContextHeader,n+","+xt.requestContextSourceKey+"="+t.config.correlationId)},e.MAX_PROPERTY_LENGTH=8192,e.tlsRestrictedAgent=new No.Agent({secureOptions:pn.SSL_OP_NO_SSLv2|pn.SSL_OP_NO_SSLv3|pn.SSL_OP_NO_TLSv1|pn.SSL_OP_NO_TLSv1_1}),e}();Lo.exports=Wd});var et=p((Ty,Mo)=>{"use strict";var dn=ue(),ki=B(),Yd=function(){function e(){}return e.queryCorrelationId=function(t,r){var n=t.profileQueryEndpoint+"/api/profiles/"+t.instrumentationKey+"/appId";if(e.completedLookups.hasOwnProperty(n)){r(e.completedLookups[n]);return}else if(e.pendingLookups[n]){e.pendingLookups[n].push(r);return}e.pendingLookups[n]=[r];var i=function(){if(!!e.pendingLookups[n]){var a={method:"GET",disableAppInsightsAutoCollection:!0};ki.info(e.TAG,a);var s=dn.makeRequest(t,n,a,function(o){if(o.statusCode===200){var u="";o.setEncoding("utf-8"),o.on("data",function(c){u+=c}),o.on("end",function(){ki.info(e.TAG,u);var c=e.correlationIdPrefix+u;e.completedLookups[n]=c,e.pendingLookups[n]&&e.pendingLookups[n].forEach(function(l){return l(c)}),delete e.pendingLookups[n]})}else o.statusCode>=400&&o.statusCode<500?(e.completedLookups[n]=void 0,delete e.pendingLookups[n]):setTimeout(i,t.correlationIdRetryIntervalMs)});s&&(s.on("error",function(o){ki.warn(e.TAG,o)}),s.end())}};setTimeout(i,0)},e.cancelCorrelationIdQuery=function(t,r){var n=t.profileQueryEndpoint+"/api/profiles/"+t.instrumentationKey+"/appId",i=e.pendingLookups[n];i&&(e.pendingLookups[n]=i.filter(function(a){return a!=r}),e.pendingLookups[n].length==0&&delete e.pendingLookups[n])},e.generateRequestId=function(t){if(t){t=t[0]=="|"?t:"|"+t,t[t.length-1]!=="."&&(t+=".");var r=(e.currentRootId++).toString(16);return e.appendSuffix(t,r,"_")}else return e.generateRootId()},e.getRootId=function(t){var r=t.indexOf(".");r<0&&(r=t.length);var n=t[0]==="|"?1:0;return t.substring(n,r)},e.generateRootId=function(){return"|"+dn.w3cTraceId()+"."},e.appendSuffix=function(t,r,n){if(t.length+r.length<e.requestIdMaxLength)return t+r+n;var i=e.requestIdMaxLength-9;if(t.length>i)for(;i>1;--i){var a=t[i-1];if(a==="."||a==="_")break}if(i<=1)return e.generateRootId();for(r=dn.randomu32().toString(16);r.length<8;)r="0"+r;return t.substring(0,i)+r+"#"},e.TAG="CorrelationIdManager",e.correlationIdPrefix="cid-v1:",e.w3cEnabled=!0,e.pendingLookups={},e.completedLookups={},e.requestIdMaxLength=1024,e.currentRootId=dn.randomu32(),e}();Mo.exports=Yd});var fr=p((Iy,Ho)=>{"use strict";var z=ue(),Jd=et(),Zd=function(){function e(t,r){if(this.traceFlag=e.DEFAULT_TRACE_FLAG,this.version=e.DEFAULT_VERSION,t&&typeof t=="string")if(t.split(",").length>1)this.traceId=z.w3cTraceId(),this.spanId=z.w3cTraceId().substr(0,16);else{var n=t.trim().split("-"),i=n.length;i>=4?(this.version=n[0],this.traceId=n[1],this.spanId=n[2],this.traceFlag=n[3]):(this.traceId=z.w3cTraceId(),this.spanId=z.w3cTraceId().substr(0,16)),this.version.match(/^[0-9a-f]{2}$/g)||(this.version=e.DEFAULT_VERSION,this.traceId=z.w3cTraceId()),this.version==="00"&&i!==4&&(this.traceId=z.w3cTraceId(),this.spanId=z.w3cTraceId().substr(0,16)),this.version==="ff"&&(this.version=e.DEFAULT_VERSION,this.traceId=z.w3cTraceId(),this.spanId=z.w3cTraceId().substr(0,16)),this.version.match(/^0[0-9a-f]$/g)||(this.version=e.DEFAULT_VERSION),this.traceFlag.match(/^[0-9a-f]{2}$/g)||(this.traceFlag=e.DEFAULT_TRACE_FLAG,this.traceId=z.w3cTraceId()),e.isValidTraceId(this.traceId)||(this.traceId=z.w3cTraceId()),e.isValidSpanId(this.spanId)||(this.spanId=z.w3cTraceId().substr(0,16),this.traceId=z.w3cTraceId()),this.parentId=this.getBackCompatRequestId()}else if(r){this.parentId=r.slice();var a=Jd.getRootId(r);e.isValidTraceId(a)||(this.legacyRootId=a,a=z.w3cTraceId()),r.indexOf("|")!==-1&&(r=r.substring(1+r.substring(0,r.length-1).lastIndexOf("."),r.length-1)),this.traceId=a,this.spanId=r}else this.traceId=z.w3cTraceId(),this.spanId=z.w3cTraceId().substr(0,16)}return e.isValidTraceId=function(t){return t.match(/^[0-9a-f]{32}$/)&&t!=="00000000000000000000000000000000"},e.isValidSpanId=function(t){return t.match(/^[0-9a-f]{16}$/)&&t!=="0000000000000000"},e.prototype.getBackCompatRequestId=function(){return"|"+this.traceId+"."+this.spanId+"."},e.prototype.toString=function(){return this.version+"-"+this.traceId+"-"+this.spanId+"-"+this.traceFlag},e.prototype.updateSpanId=function(){this.spanId=z.w3cTraceId().substr(0,16)},e.DEFAULT_TRACE_FLAG="01",e.DEFAULT_VERSION="00",e}();Ho.exports=Zd});var Ni=p((by,jo)=>{"use strict";var eh=function(){function e(t){this.fieldmap=[],t&&(this.fieldmap=this.parseHeader(t))}return e.prototype.toString=function(){var t=this.fieldmap;return!t||t.length==0?null:t.join(", ")},e.validateKeyChars=function(t){var r=t.split("@");if(r.length==2){var n=r[0].trim(),i=r[1].trim(),a=Boolean(n.match(/^[\ ]?[a-z0-9\*\-\_/]{1,241}$/)),s=Boolean(i.match(/^[\ ]?[a-z0-9\*\-\_/]{1,14}$/));return a&&s}else if(r.length==1)return Boolean(t.match(/^[\ ]?[a-z0-9\*\-\_/]{1,256}$/));return!1},e.prototype.parseHeader=function(t){var r=[],n={},i=t.split(",");if(i.length>32)return null;for(var a=0,s=i;a<s.length;a++){var o=s[a],u=o.trim();if(u.length!==0){var c=u.split("=");if(c.length!==2||!e.validateKeyChars(c[0])||n[c[0]])return null;n[c[0]]=!0,r.push(u)}}return r},e.strict=!0,e}();jo.exports=eh});var Ae=p((xy,Fo)=>{"use strict";var th=function(){function e(){}return e}();Fo.exports=th});var $o=p((Li,Uo)=>{"use strict";var rh=Li&&Li.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])};return function(t,r){e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),nh=Ae(),ih=function(e){rh(t,e);function t(){var r=e.call(this)||this;return r.ver=2,r.properties={},r.measurements={},r}return t}(nh);Uo.exports=ih});var Mi=p((Sy,Vo)=>{"use strict";var ah=function(){function e(){}return e}();Vo.exports=ah});var Go=p((wy,Bo)=>{"use strict";var sh=function(){function e(){this.applicationVersion="ai.application.ver",this.deviceId="ai.device.id",this.deviceLocale="ai.device.locale",this.deviceModel="ai.device.model",this.deviceOEMName="ai.device.oemName",this.deviceOSVersion="ai.device.osVersion",this.deviceType="ai.device.type",this.locationIp="ai.location.ip",this.operationId="ai.operation.id",this.operationName="ai.operation.name",this.operationParentId="ai.operation.parentId",this.operationSyntheticSource="ai.operation.syntheticSource",this.operationCorrelationVector="ai.operation.correlationVector",this.sessionId="ai.session.id",this.sessionIsFirst="ai.session.isFirst",this.userAccountId="ai.user.accountId",this.userId="ai.user.id",this.userAuthUserId="ai.user.authUserId",this.cloudRole="ai.cloud.role",this.cloudRoleInstance="ai.cloud.roleInstance",this.internalSdkVersion="ai.internal.sdkVersion",this.internalAgentVersion="ai.internal.agentVersion",this.internalNodeName="ai.internal.nodeName"}return e}();Bo.exports=sh});var Qo=p((Hi,zo)=>{"use strict";var oh=Hi&&Hi.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])};return function(t,r){e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),uh=Mi(),ch=function(e){oh(t,e);function t(){return e.call(this)||this}return t}(uh);zo.exports=ch});var Fi=p((Ay,Xo)=>{"use strict";var ji;(function(e){e[e.Measurement=0]="Measurement",e[e.Aggregation=1]="Aggregation"})(ji||(ji={}));Xo.exports=ji});var Wo=p((Dy,Ko)=>{"use strict";var lh=Fi(),fh=function(){function e(){this.kind=lh.Measurement}return e}();Ko.exports=fh});var Jo=p((Ry,Yo)=>{"use strict";var ph=function(){function e(){this.ver=1,this.sampleRate=100,this.tags={}}return e}();Yo.exports=ph});var $i=p((Ui,Zo)=>{"use strict";var dh=Ui&&Ui.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])};return function(t,r){e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),hh=Ae(),vh=function(e){dh(t,e);function t(){var r=e.call(this)||this;return r.ver=2,r.properties={},r.measurements={},r}return t}(hh);Zo.exports=vh});var tu=p((Vi,eu)=>{"use strict";var gh=Vi&&Vi.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])};return function(t,r){e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),_h=Ae(),mh=function(e){gh(t,e);function t(){var r=e.call(this)||this;return r.ver=2,r.exceptions=[],r.properties={},r.measurements={},r}return t}(_h);eu.exports=mh});var nu=p((Py,ru)=>{"use strict";var yh=function(){function e(){this.hasFullStack=!0,this.parsedStack=[]}return e}();ru.exports=yh});var au=p((Bi,iu)=>{"use strict";var Eh=Bi&&Bi.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])};return function(t,r){e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ch=Ae(),Th=function(e){Eh(t,e);function t(){var r=e.call(this)||this;return r.ver=2,r.properties={},r}return t}(Ch);iu.exports=Th});var ou=p((Gi,su)=>{"use strict";var Ih=Gi&&Gi.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])};return function(t,r){e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),bh=Ae(),xh=function(e){Ih(t,e);function t(){var r=e.call(this)||this;return r.ver=2,r.metrics=[],r.properties={},r}return t}(bh);su.exports=xh});var cu=p((zi,uu)=>{"use strict";var Sh=zi&&zi.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])};return function(t,r){e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),wh=$i(),Ah=function(e){Sh(t,e);function t(){var r=e.call(this)||this;return r.ver=2,r.properties={},r.measurements={},r}return t}(wh);uu.exports=Ah});var fu=p((Qi,lu)=>{"use strict";var Dh=Qi&&Qi.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])};return function(t,r){e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),Rh=Ae(),Ph=function(e){Dh(t,e);function t(){var r=e.call(this)||this;return r.ver=2,r.success=!0,r.properties={},r.measurements={},r}return t}(Rh);lu.exports=Ph});var du=p((Xi,pu)=>{"use strict";var qh=Xi&&Xi.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])};return function(t,r){e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),Oh=Ae(),kh=function(e){qh(t,e);function t(){var r=e.call(this)||this;return r.ver=2,r.properties={},r.measurements={},r}return t}(Oh);pu.exports=kh});var vu=p((qy,hu)=>{"use strict";var Ki;(function(e){e[e.Verbose=0]="Verbose",e[e.Information=1]="Information",e[e.Warning=2]="Warning",e[e.Error=3]="Error",e[e.Critical=4]="Critical"})(Ki||(Ki={}));hu.exports=Ki});var _u=p((Oy,gu)=>{"use strict";var Nh=function(){function e(){}return e}();gu.exports=Nh});var Wi=p($=>{"use strict";Object.defineProperty($,"__esModule",{value:!0});$.AvailabilityData=$o();$.Base=Mi();$.ContextTagKeys=Go();$.Data=Qo();$.DataPoint=Wo();$.DataPointType=Fi();$.Domain=Ae();$.Envelope=Jo();$.EventData=$i();$.ExceptionData=tu();$.ExceptionDetails=nu();$.MessageData=au();$.MetricData=ou();$.PageViewData=cu();$.RemoteDependencyData=fu();$.RequestData=du();$.SeverityLevel=vu();$.StackFrame=_u()});var mu=p(hn=>{"use strict";Object.defineProperty(hn,"__esModule",{value:!0});var tt=Wi(),Lh=function(){function e(){}return e.TYPE_HTTP="Http",e.TYPE_AI="Http (tracked component)",e}();hn.RemoteDependencyDataConstants=Lh;function Mh(e){return"properties"in e||e instanceof tt.EventData||e instanceof tt.ExceptionData||e instanceof tt.MessageData||e instanceof tt.MetricData||e instanceof tt.PageViewData||e instanceof tt.RemoteDependencyData||e instanceof tt.RequestData}hn.domainSupportsProperties=Mh});var yu=p(rt=>{"use strict";Object.defineProperty(rt,"__esModule",{value:!0});function Hh(e){switch(e){case Q.Event:return"EventData";case Q.Exception:return"ExceptionData";case Q.Trace:return"MessageData";case Q.Metric:return"MetricData";case Q.Request:return"RequestData";case Q.Dependency:return"RemoteDependencyData";case Q.Availability:return"AvailabilityData";case Q.PageView:return"PageViewData"}}rt.telemetryTypeToBaseType=Hh;function jh(e){switch(e){case"EventData":return Q.Event;case"ExceptionData":return Q.Exception;case"MessageData":return Q.Trace;case"MetricData":return Q.Metric;case"RequestData":return Q.Request;case"RemoteDependencyData":return Q.Dependency;case"AvailabilityData":return Q.Availability;case"PageViewData":return Q.PageView}}rt.baseTypeToTelemetryType=jh;rt.TelemetryTypeString={Event:"EventData",Exception:"ExceptionData",Trace:"MessageData",Metric:"MetricData",Request:"RequestData",Dependency:"RemoteDependencyData",Availability:"AvailabilityData",PageView:"PageViewData"};var Q;(function(e){e[e.Event=0]="Event",e[e.Exception=1]="Exception",e[e.Trace=2]="Trace",e[e.Metric=3]="Metric",e[e.Request=4]="Request",e[e.Dependency=5]="Dependency",e[e.Availability=6]="Availability",e[e.PageView=7]="PageView"})(Q=rt.TelemetryType||(rt.TelemetryType={}))});var Eu=p(vn=>{"use strict";function Fh(e){for(var t in e)vn.hasOwnProperty(t)||(vn[t]=e[t])}Object.defineProperty(vn,"__esModule",{value:!0});Fh(yu())});var ae=p(gn=>{"use strict";function Yi(e){for(var t in e)gn.hasOwnProperty(t)||(gn[t]=e[t])}Object.defineProperty(gn,"__esModule",{value:!0});Yi(mu());Yi(Wi());Yi(Eu())});var Ji=p((jy,Cu)=>{"use strict";var Uh=function(){function e(){}return e.prototype.getUrl=function(){return this.url},e.prototype.RequestParser=function(){this.startTime=+new Date},e.prototype._setStatus=function(t,r){var n=+new Date;this.duration=n-this.startTime,this.statusCode=t;var i=this.properties||{};if(r){if(typeof r=="string")i.error=r;else if(r instanceof Error)i.error=r.message;else if(typeof r=="object")for(var a in r)i[a]=r[a]&&r[a].toString&&r[a].toString()}this.properties=i},e.prototype._isSuccess=function(){return 0<this.statusCode&&this.statusCode<400},e}();Cu.exports=Uh});var ta=p((ea,Iu)=>{"use strict";var $h=ea&&ea.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])};return function(t,r){e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),_n=require("url"),Vh=ae(),Tu=ue(),nt=bt(),Bh=Ji(),je=et(),Gh=Ni(),Zi=fr(),zh=function(e){$h(t,e);function t(r,n){var i=e.call(this)||this;return r&&(i.method=r.method,i.url=i._getAbsoluteUrl(r),i.startTime=+new Date,i.socketRemoteAddress=r.socket&&r.socket.remoteAddress,i.parseHeaders(r,n),r.connection&&(i.connectionRemoteAddress=r.connection.remoteAddress,i.legacySocketRemoteAddress=r.connection.socket&&r.connection.socket.remoteAddress)),i}return t.prototype.onError=function(r,n){this._setStatus(void 0,r),n&&(this.duration=n)},t.prototype.onResponse=function(r,n){this._setStatus(r.statusCode,void 0),n&&(this.duration=n)},t.prototype.getRequestTelemetry=function(r){var n={id:this.requestId,name:this.method+" "+_n.parse(this.url).pathname,url:this.url,source:this.sourceCorrelationId,duration:this.duration,resultCode:this.statusCode?this.statusCode.toString():null,success:this._isSuccess(),properties:this.properties};if(r&&r.time?n.time=r.time:this.startTime&&(n.time=new Date(this.startTime)),r){for(var i in r)n[i]||(n[i]=r[i]);if(r.properties)for(var i in r.properties)n.properties[i]=r.properties[i]}return n},t.prototype.getRequestTags=function(r){var n={};for(var i in r)n[i]=r[i];return n[t.keys.locationIp]=r[t.keys.locationIp]||this._getIp(),n[t.keys.sessionId]=r[t.keys.sessionId]||this._getId("ai_session"),n[t.keys.userId]=r[t.keys.userId]||this._getId("ai_user"),n[t.keys.userAuthUserId]=r[t.keys.userAuthUserId]||this._getId("ai_authUser"),n[t.keys.operationName]=this.getOperationName(r),n[t.keys.operationParentId]=this.getOperationParentId(r),n[t.keys.operationId]=this.getOperationId(r),n},t.prototype.getOperationId=function(r){return r[t.keys.operationId]||this.operationId},t.prototype.getOperationParentId=function(r){return r[t.keys.operationParentId]||this.parentId||this.getOperationId(r)},t.prototype.getOperationName=function(r){return r[t.keys.operationName]||this.method+" "+_n.parse(this.url).pathname},t.prototype.getRequestId=function(){return this.requestId},t.prototype.getCorrelationContextHeader=function(){return this.correlationContextHeader},t.prototype.getTraceparent=function(){return this.traceparent},t.prototype.getTracestate=function(){return this.tracestate},t.prototype.getLegacyRootId=function(){return this.legacyRootId},t.prototype._getAbsoluteUrl=function(r){if(!r.headers)return r.url;var n=r.connection?r.connection.encrypted:null,i=_n.parse(r.url),a=i.pathname,s=i.search,o=_n.format({protocol:n?"https":"http",host:r.headers.host,pathname:a,search:s});return o},t.prototype._getIp=function(){var r=/[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}/,n=function(a){var s=r.exec(a);if(s)return s[0]},i=n(this.rawHeaders["x-forwarded-for"])||n(this.rawHeaders["x-client-ip"])||n(this.rawHeaders["x-real-ip"])||n(this.connectionRemoteAddress)||n(this.socketRemoteAddress)||n(this.legacySocketRemoteAddress);return!i&&this.connectionRemoteAddress&&this.connectionRemoteAddress.substr&&this.connectionRemoteAddress.substr(0,2)==="::"&&(i="127.0.0.1"),i},t.prototype._getId=function(r){var n=this.rawHeaders&&this.rawHeaders.cookie&&typeof this.rawHeaders.cookie=="string"&&this.rawHeaders.cookie||"",i=t.parseId(Tu.getCookie(r,n));return i},t.prototype.setBackCompatFromThisTraceContext=function(){this.operationId=this.traceparent.traceId,this.traceparent.legacyRootId&&(this.legacyRootId=this.traceparent.legacyRootId),this.parentId=this.traceparent.parentId,this.traceparent.updateSpanId(),this.requestId=this.traceparent.getBackCompatRequestId()},t.prototype.parseHeaders=function(r,n){if(this.rawHeaders=r.headers||r.rawHeaders,this.userAgent=r.headers&&r.headers["user-agent"],this.sourceCorrelationId=Tu.getCorrelationContextTarget(r,nt.requestContextSourceKey),r.headers){var i=r.headers[nt.traceStateHeader],a=r.headers[nt.traceparentHeader],s=r.headers[nt.requestIdHeader],o=r.headers[nt.parentIdHeader],u=r.headers[nt.rootIdHeader];this.correlationContextHeader=r.headers[nt.correlationContextHeader],je.w3cEnabled&&(a||i)?(this.traceparent=new Zi(a),this.tracestate=a&&i&&new Gh(i),this.setBackCompatFromThisTraceContext()):s?je.w3cEnabled?(this.traceparent=new Zi(null,s),this.setBackCompatFromThisTraceContext()):(this.parentId=s,this.requestId=je.generateRequestId(this.parentId),this.operationId=je.getRootId(this.requestId)):je.w3cEnabled?(this.traceparent=new Zi,this.traceparent.parentId=o,this.traceparent.legacyRootId=u||o,this.setBackCompatFromThisTraceContext()):(this.parentId=o,this.requestId=je.generateRequestId(u||this.parentId),this.correlationContextHeader=null,this.operationId=je.getRootId(this.requestId)),n&&(this.requestId=n,this.operationId=je.getRootId(this.requestId))}},t.parseId=function(r){var n=r.split("|");return n.length>0?n[0]:""},t.keys=new Vh.ContextTagKeys,t}(Bh);Iu.exports=zh});var mn=p((Fy,Su)=>{"use strict";function ra(e){return typeof e=="function"}var te=console.error.bind(console);function pr(e,t,r){var n=!!e[t]&&e.propertyIsEnumerable(t);Object.defineProperty(e,t,{configurable:!0,enumerable:n,writable:!0,value:r})}function dr(e){e&&e.logger&&(ra(e.logger)?te=e.logger:te("new logger isn't a function, not replacing"))}function bu(e,t,r){if(!e||!e[t]){te("no original function "+t+" to wrap");return}if(!r){te("no wrapper function"),te(new Error().stack);return}if(!ra(e[t])||!ra(r)){te("original object and wrapper must be functions");return}var n=e[t],i=r(n,t);return pr(i,"__original",n),pr(i,"__unwrap",function(){e[t]===i&&pr(e,t,n)}),pr(i,"__wrapped",!0),pr(e,t,i),i}function Qh(e,t,r){if(e)Array.isArray(e)||(e=[e]);else{te("must provide one or more modules to patch"),te(new Error().stack);return}if(!(t&&Array.isArray(t))){te("must provide one or more functions to wrap on modules");return}e.forEach(function(n){t.forEach(function(i){bu(n,i,r)})})}function xu(e,t){if(!e||!e[t]){te("no function to unwrap."),te(new Error().stack);return}if(!e[t].__unwrap)te("no original to unwrap to -- has "+t+" already been unwrapped?");else return e[t].__unwrap()}function Xh(e,t){if(e)Array.isArray(e)||(e=[e]);else{te("must provide one or more modules to patch"),te(new Error().stack);return}if(!(t&&Array.isArray(t))){te("must provide one or more functions to unwrap on modules");return}e.forEach(function(r){t.forEach(function(n){xu(r,n)})})}dr.wrap=bu;dr.massWrap=Qh;dr.unwrap=xu;dr.massUnwrap=Xh;Su.exports=dr});var Cn=p((Uy,Ru)=>{"use strict";var Au=mn(),St=Au.wrap,yn=Au.unwrap,De="wrap@before";function En(e,t,r){var n=!!e[t]&&e.propertyIsEnumerable(t);Object.defineProperty(e,t,{configurable:!0,enumerable:n,writable:!0,value:r})}function Kh(e,t){for(var r=t.length,n=0;n<r;n++){var i=t[n],a=e[De];if(typeof a=="function")a(i);else if(Array.isArray(a))for(var s=a.length,o=0;o<s;o++)a[o](i)}}function Du(e,t){var r;return r=e._events&&e._events[t],Array.isArray(r)||(r?r=[r]:r=[]),r}function Wh(e,t,r){var n=Du(e,t),i=n.filter(function(a){return r.indexOf(a)===-1});i.length>0&&Kh(e,i)}function wu(e,t){if(!!e){var r=e;if(typeof e=="function")r=t(e);else if(Array.isArray(e)){r=[];for(var n=0;n<e.length;n++)r[n]=t(e[n])}return r}}Ru.exports=function(t,r,n){if(!t||!t.on||!t.addListener||!t.removeListener||!t.emit)throw new Error("can only wrap real EEs");if(!r)throw new Error("must have function to run on listener addition");if(!n)throw new Error("must have function to wrap listeners when emitting");function i(s){return function(u,c){var l=Du(this,u).slice();try{var f=s.call(this,u,c);return Wh(this,u,l),f}finally{this.on.__wrapped||St(this,"on",i),this.addListener.__wrapped||St(this,"addListener",i)}}}function a(s){return function(u){if(!this._events||!this._events[u])return s.apply(this,arguments);var c=this._events[u];function l(f){return function(){this._events[u]=c;try{return f.apply(this,arguments)}finally{c=this._events[u],this._events[u]=wu(c,n)}}}St(this,"removeListener",l);try{return this._events[u]=wu(c,n),s.apply(this,arguments)}finally{yn(this,"removeListener"),this._events[u]=c}}}t[De]?typeof t[De]=="function"?En(t,De,[t[De],r]):Array.isArray(t[De])&&t[De].push(r):En(t,De,r),t.__wrapped||(St(t,"addListener",i),St(t,"on",i),St(t,"emit",a),En(t,"__unwrap",function(){yn(t,"addListener"),yn(t,"on"),yn(t,"emit"),delete t[De],delete t.__wrapped}),En(t,"__wrapped",!0))}});var ku=p(($y,Ou)=>{"use strict";var S=require("util"),Re=require("assert"),Yh=Cn(),P=require("async_hooks"),hr="cls@contexts",vr="error@context",L=process.env.DEBUG_CLS_HOOKED,x=-1;Ou.exports={getNamespace:Pu,createNamespace:Jh,destroyNamespace:qu,reset:Zh,ERROR_SYMBOL:vr};function fe(e){this.name=e,this.active=null,this._set=[],this.id=null,this._contexts=new Map,this._indent=0}fe.prototype.set=function(t,r){if(!this.active)throw new Error("No context available. ns.run() or ns.bind() must be called first.");if(this.active[t]=r,L){let n=" ".repeat(this._indent<0?0:this._indent);O(n+"CONTEXT-SET KEY:"+t+"="+r+" in ns:"+this.name+" currentUid:"+x+" active:"+S.inspect(this.active,{showHidden:!0,depth:2,colors:!0}))}return r};fe.prototype.get=function(t){if(!this.active){if(L){let r=P.currentId(),n=P.triggerAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);O(`${i}CONTEXT-GETTING KEY NO ACTIVE NS: (${this.name}) ${t}=undefined currentUid:${x} asyncHooksCurrentId:${r} triggerId:${n} len:${this._set.length}`)}return}if(L){let r=P.executionAsyncId(),n=P.triggerAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);O(i+"CONTEXT-GETTING KEY:"+t+"="+this.active[t]+" ("+this.name+") currentUid:"+x+" active:"+S.inspect(this.active,{showHidden:!0,depth:2,colors:!0})),O(`${i}CONTEXT-GETTING KEY: (${this.name}) ${t}=${this.active[t]} currentUid:${x} asyncHooksCurrentId:${r} triggerId:${n} len:${this._set.length} active:${S.inspect(this.active)}`)}return this.active[t]};fe.prototype.createContext=function(){let t=Object.create(this.active?this.active:Object.prototype);if(t._ns_name=this.name,t.id=x,L){let r=P.executionAsyncId(),n=P.triggerAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);O(`${i}CONTEXT-CREATED Context: (${this.name}) currentUid:${x} asyncHooksCurrentId:${r} triggerId:${n} len:${this._set.length} context:${S.inspect(t,{showHidden:!0,depth:2,colors:!0})}`)}return t};fe.prototype.run=function(t){let r=this.createContext();this.enter(r);try{if(L){let n=P.triggerAsyncId(),i=P.executionAsyncId(),a=" ".repeat(this._indent<0?0:this._indent);O(`${a}CONTEXT-RUN BEGIN: (${this.name}) currentUid:${x} triggerId:${n} asyncHooksCurrentId:${i} len:${this._set.length} context:${S.inspect(r)}`)}return t(r),r}catch(n){throw n&&(n[vr]=r),n}finally{if(L){let n=P.triggerAsyncId(),i=P.executionAsyncId(),a=" ".repeat(this._indent<0?0:this._indent);O(`${a}CONTEXT-RUN END: (${this.name}) currentUid:${x} triggerId:${n} asyncHooksCurrentId:${i} len:${this._set.length} ${S.inspect(r)}`)}this.exit(r)}};fe.prototype.runAndReturn=function(t){let r;return this.run(function(n){r=t(n)}),r};fe.prototype.runPromise=function(t){let r=this.createContext();this.enter(r);let n=t(r);if(!n||!n.then||!n.catch)throw new Error("fn must return a promise.");return L&&O("CONTEXT-runPromise BEFORE: ("+this.name+") currentUid:"+x+" len:"+this._set.length+" "+S.inspect(r)),n.then(i=>(L&&O("CONTEXT-runPromise AFTER then: ("+this.name+") currentUid:"+x+" len:"+this._set.length+" "+S.inspect(r)),this.exit(r),i)).catch(i=>{throw i[vr]=r,L&&O("CONTEXT-runPromise AFTER catch: ("+this.name+") currentUid:"+x+" len:"+this._set.length+" "+S.inspect(r)),this.exit(r),i})};fe.prototype.bind=function(t,r){r||(this.active?r=this.active:r=this.createContext());let n=this;return function(){n.enter(r);try{return t.apply(this,arguments)}catch(a){throw a&&(a[vr]=r),a}finally{n.exit(r)}}};fe.prototype.enter=function(t){if(Re.ok(t,"context must be provided for entering"),L){let r=P.executionAsyncId(),n=P.triggerAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);O(`${i}CONTEXT-ENTER: (${this.name}) currentUid:${x} triggerId:${n} asyncHooksCurrentId:${r} len:${this._set.length} ${S.inspect(t)}`)}this._set.push(this.active),this.active=t};fe.prototype.exit=function(t){if(Re.ok(t,"context must be provided for exiting"),L){let n=P.executionAsyncId(),i=P.triggerAsyncId(),a=" ".repeat(this._indent<0?0:this._indent);O(`${a}CONTEXT-EXIT: (${this.name}) currentUid:${x} triggerId:${i} asyncHooksCurrentId:${n} len:${this._set.length} ${S.inspect(t)}`)}if(this.active===t){Re.ok(this._set.length,"can't remove top context"),this.active=this._set.pop();return}let r=this._set.lastIndexOf(t);r<0?(L&&O("??ERROR?? context exiting but not entered - ignoring: "+S.inspect(t)),Re.ok(r>=0,`context not currently entered; can't exit. 
`+S.inspect(this)+`
`+S.inspect(t))):(Re.ok(r,"can't remove top context"),this._set.splice(r,1))};fe.prototype.bindEmitter=function(t){Re.ok(t.on&&t.addListener&&t.emit,"can only bind real EEs");let r=this,n="context@"+this.name;function i(s){!s||(s[hr]||(s[hr]=Object.create(null)),s[hr][n]={namespace:r,context:r.active})}function a(s){if(!(s&&s[hr]))return s;let o=s,u=s[hr];return Object.keys(u).forEach(function(c){let l=u[c];o=l.namespace.bind(o,l.context)}),o}Yh(t,i,a)};fe.prototype.fromException=function(t){return t[vr]};function Pu(e){return process.namespaces[e]}function Jh(e){Re.ok(e,"namespace must be given a name."),L&&O(`NS-CREATING NAMESPACE (${e})`);let t=new fe(e);return t.id=x,P.createHook({init(n,i,a,s){if(x=P.executionAsyncId(),t.active){if(t._contexts.set(n,t.active),L){let o=" ".repeat(t._indent<0?0:t._indent);O(`${o}INIT [${i}] (${e}) asyncId:${n} currentUid:${x} triggerId:${a} active:${S.inspect(t.active,{showHidden:!0,depth:2,colors:!0})} resource:${s}`)}}else if(x===0){let o=P.triggerAsyncId(),u=t._contexts.get(o);if(u){if(t._contexts.set(n,u),L){let c=" ".repeat(t._indent<0?0:t._indent);O(`${c}INIT USING CONTEXT FROM TRIGGERID [${i}] (${e}) asyncId:${n} currentUid:${x} triggerId:${o} active:${S.inspect(t.active,{showHidden:!0,depth:2,colors:!0})} resource:${s}`)}}else if(L){let c=" ".repeat(t._indent<0?0:t._indent);O(`${c}INIT MISSING CONTEXT [${i}] (${e}) asyncId:${n} currentUid:${x} triggerId:${o} active:${S.inspect(t.active,{showHidden:!0,depth:2,colors:!0})} resource:${s}`)}}if(L&&i==="PROMISE"){O(S.inspect(s,{showHidden:!0}));let o=s.parentId,u=" ".repeat(t._indent<0?0:t._indent);O(`${u}INIT RESOURCE-PROMISE [${i}] (${e}) parentId:${o} asyncId:${n} currentUid:${x} triggerId:${a} active:${S.inspect(t.active,{showHidden:!0,depth:2,colors:!0})} resource:${s}`)}},before(n){x=P.executionAsyncId();let i;if(i=t._contexts.get(n)||t._contexts.get(x),i){if(L){let a=P.triggerAsyncId(),s=" ".repeat(t._indent<0?0:t._indent);O(`${s}BEFORE (${e}) asyncId:${n} currentUid:${x} triggerId:${a} active:${S.inspect(t.active,{showHidden:!0,depth:2,colors:!0})} context:${S.inspect(i)}`),t._indent+=2}t.enter(i)}else if(L){let a=P.triggerAsyncId(),s=" ".repeat(t._indent<0?0:t._indent);O(`${s}BEFORE MISSING CONTEXT (${e}) asyncId:${n} currentUid:${x} triggerId:${a} active:${S.inspect(t.active,{showHidden:!0,depth:2,colors:!0})} namespace._contexts:${S.inspect(t._contexts,{showHidden:!0,depth:2,colors:!0})}`),t._indent+=2}},after(n){x=P.executionAsyncId();let i;if(i=t._contexts.get(n)||t._contexts.get(x),i){if(L){let a=P.triggerAsyncId();t._indent-=2;let s=" ".repeat(t._indent<0?0:t._indent);O(`${s}AFTER (${e}) asyncId:${n} currentUid:${x} triggerId:${a} active:${S.inspect(t.active,{showHidden:!0,depth:2,colors:!0})} context:${S.inspect(i)}`)}t.exit(i)}else if(L){let a=P.triggerAsyncId();t._indent-=2;let s=" ".repeat(t._indent<0?0:t._indent);O(`${s}AFTER MISSING CONTEXT (${e}) asyncId:${n} currentUid:${x} triggerId:${a} active:${S.inspect(t.active,{showHidden:!0,depth:2,colors:!0})} context:${S.inspect(i)}`)}},destroy(n){if(x=P.executionAsyncId(),L){let i=P.triggerAsyncId(),a=" ".repeat(t._indent<0?0:t._indent);O(`${a}DESTROY (${e}) currentUid:${x} asyncId:${n} triggerId:${i} active:${S.inspect(t.active,{showHidden:!0,depth:2,colors:!0})} context:${S.inspect(t._contexts.get(x))}`)}t._contexts.delete(n)}}).enable(),process.namespaces[e]=t,t}function qu(e){let t=Pu(e);Re.ok(t,`can't delete nonexistent namespace! "`+e+'"'),Re.ok(t.id,"don't assign to process.namespaces directly! "+S.inspect(t)),process.namespaces[e]=null}function Zh(){process.namespaces&&Object.keys(process.namespaces).forEach(function(e){qu(e)}),process.namespaces=Object.create(null)}process.namespaces={};function O(...e){L&&process._rawDebug(`${S.format(...e)}`)}});var Lu=p((Vy,Nu)=>{"use strict";function ev(){}Nu.exports=function(){let t=this._hooks,r=this._state,n=process.nextTick;process.nextTick=function(){if(!r.enabled)return n.apply(process,arguments);let i=new Array(arguments.length);for(let u=0;u<arguments.length;u++)i[u]=arguments[u];let a=i[0];if(typeof a!="function")throw new TypeError("callback is not a function");let s=new ev,o=--r.counter;return t.init.call(s,o,0,null,null),i[0]=function(){t.pre.call(s,o);let u=!0;try{a.apply(this,arguments),u=!1}finally{u&&process.listenerCount("uncaughtException")>0&&process.once("uncaughtException",function(){t.post.call(s,o,!0),t.destroy.call(null,o)})}t.post.call(s,o,!1),t.destroy.call(null,o)},n.apply(process,i)}}});var Hu=p((By,Mu)=>{"use strict";function tv(){}Mu.exports=function(){let t=this._hooks,r=this._state,n=global.Promise,i=n.prototype.then;n.prototype.then=u;function a(c,l,f,d){return typeof c!="function"?d?s(f):o(f):function(){t.pre.call(l,f);try{return c.apply(this,arguments)}finally{t.post.call(l,f,!1),t.destroy.call(null,f)}}}function s(c){return function(f){return t.destroy.call(null,c),f}}function o(c){return function(f){throw t.destroy.call(null,c),f}}function u(c,l){if(!r.enabled)return i.call(this,c,l);let f=new tv,d=--r.counter;return t.init.call(f,d,0,null,null),i.call(this,a(c,f,d,!0),a(l,f,d,!1))}}});var Fu=p((Gy,ju)=>{"use strict";var ce=require("timers");function rv(){}function nv(){}function iv(){}var av=new Map,sv=new Map,ov=new Map,na=null,ia=!1;ju.exports=function(){aa(this._hooks,this._state,"setTimeout","clearTimeout",rv,av,!0),aa(this._hooks,this._state,"setInterval","clearInterval",nv,sv,!1),aa(this._hooks,this._state,"setImmediate","clearImmediate",iv,ov,!0),global.setTimeout=ce.setTimeout,global.setInterval=ce.setInterval,global.setImmediate=ce.setImmediate,global.clearTimeout=ce.clearTimeout,global.clearInterval=ce.clearInterval,global.clearImmediate=ce.clearImmediate};function aa(e,t,r,n,i,a,s){let o=ce[r],u=ce[n];ce[r]=function(){if(!t.enabled)return o.apply(ce,arguments);let c=new Array(arguments.length);for(let _=0;_<arguments.length;_++)c[_]=arguments[_];let l=c[0];if(typeof l!="function")throw new TypeError('"callback" argument must be a function');let f=new i,d=--t.counter,g;return e.init.call(f,d,0,null,null),c[0]=function(){na=g,e.pre.call(f,d);let _=!0;try{l.apply(this,arguments),_=!1}finally{_&&process.listenerCount("uncaughtException")>0&&process.once("uncaughtException",function(){e.post.call(f,d,!0),a.delete(g),e.destroy.call(null,d)})}e.post.call(f,d,!1),na=null,(s||ia)&&(ia=!1,a.delete(g),e.destroy.call(null,d))},g=o.apply(ce,c),a.set(g,d),g},ce[n]=function(c){if(na===c&&c!==null)ia=!0;else if(a.has(c)){let l=a.get(c);a.delete(c),e.destroy.call(null,l)}u.apply(ce,arguments)}}});var sa=p((zy,uv)=>{uv.exports={name:"async-hook-jl",description:"Inspect the life of handle objects in node",version:"1.7.6",author:"Andreas Madsen <amwebdk@gmail.com>",main:"./index.js",scripts:{test:"node ./test/runner.js && eslint ."},repository:{type:"git",url:"git://github.com/jeff-lewis/async-hook-jl.git"},keywords:["async","async hooks","inspect","async wrap"],license:"MIT",dependencies:{"stack-chain":"^1.3.7"},devDependencies:{async:"1.5.x","cli-color":"1.1.x",eslint:"^3.4.0",endpoint:"0.4.x"},engines:{node:"^4.7 || >=6.9 || >=7.3"}}});var Vu=p((Qy,$u)=>{"use strict";var _r=process.binding("async_wrap"),cv=_r.Providers.TIMERWRAP,Uu={nextTick:Lu(),promise:Hu(),timers:Fu()},gr=new Set;function lv(){this.enabled=!1,this.counter=0}function oa(){let e=this.initFns=[],t=this.preFns=[],r=this.postFns=[],n=this.destroyFns=[];this.init=function(i,a,s,o){if(a===cv){gr.add(i);return}for(let u of e)u(i,this,a,s,o)},this.pre=function(i){if(!gr.has(i))for(let a of t)a(i,this)},this.post=function(i,a){if(!gr.has(i))for(let s of r)s(i,this,a)},this.destroy=function(i){if(gr.has(i)){gr.delete(i);return}for(let a of n)a(i)}}oa.prototype.add=function(e){e.init&&this.initFns.push(e.init),e.pre&&this.preFns.push(e.pre),e.post&&this.postFns.push(e.post),e.destroy&&this.destroyFns.push(e.destroy)};function Tn(e,t){let r=e.indexOf(t);r!==-1&&e.splice(r,1)}oa.prototype.remove=function(e){e.init&&Tn(this.initFns,e.init),e.pre&&Tn(this.preFns,e.pre),e.post&&Tn(this.postFns,e.post),e.destroy&&Tn(this.destroyFns,e.destroy)};function mr(){this._state=new lv,this._hooks=new oa,this.version=sa().version,this.providers=_r.Providers;for(let e of Object.keys(Uu))Uu[e].call(this);process.env.hasOwnProperty("NODE_ASYNC_HOOK_WARNING")&&console.warn("warning: you are using async-hook-jl which is unstable."),_r.setupHooks({init:this._hooks.init,pre:this._hooks.pre,post:this._hooks.post,destroy:this._hooks.destroy})}$u.exports=mr;mr.prototype.addHooks=function(e){this._hooks.add(e)};mr.prototype.removeHooks=function(e){this._hooks.remove(e)};mr.prototype.enable=function(){this._state.enabled=!0,_r.enable()};mr.prototype.disable=function(){this._state.enabled=!1,_r.disable()}});var ua=p((Xy,fv)=>{fv.exports={name:"stack-chain",description:"API for combining call site modifiers",version:"1.3.7",author:"Andreas Madsen <amwebdk@gmail.com>",scripts:{test:"tap ./test/simple"},repository:{type:"git",url:"git://github.com/AndreasMadsen/stack-chain.git"},keywords:["stack","chain","trace","call site","concat","format"],devDependencies:{tap:"2.x.x","uglify-js":"2.5.x"},license:"MIT"}});var Gu=p((Ky,Bu)=>{function pv(e){try{return Error.prototype.toString.call(e)}catch(t){try{return"<error: "+t+">"}catch{return"<error>"}}}Bu.exports=function(t,r){var n=[];n.push(pv(t));for(var i=0;i<r.length;i++){var a=r[i],s;try{s=a.toString()}catch(o){try{s="<error: "+o+">"}catch{s="<error>"}}n.push("    at "+s)}return n.join(`
`)}});var Ku=p((Wy,Xu)=>{var In=Gu();function Qu(){this.extend=new yr,this.filter=new yr,this.format=new Er,this.version=ua().version}var la=!1;Qu.prototype.callSite=function e(t){t||(t={}),la=!0;var r={};Error.captureStackTrace(r,e);var n=r.stack;return la=!1,n=n.slice(t.slice||0),t.extend&&(n=this.extend._modify(r,n)),t.filter&&(n=this.filter._modify(r,n)),n};var Fe=new Qu;function yr(){this._modifiers=[]}yr.prototype._modify=function(e,t){for(var r=0,n=this._modifiers.length;r<n;r++)t=this._modifiers[r](e,t);return t};yr.prototype.attach=function(e){this._modifiers.push(e)};yr.prototype.deattach=function(e){var t=this._modifiers.indexOf(e);return t===-1?!1:(this._modifiers.splice(t,1),!0)};function Er(){this._formater=In,this._previous=void 0}Er.prototype.replace=function(e){e?this._formater=e:this.restore()};Er.prototype.restore=function(){this._formater=In,this._previous=void 0};Er.prototype._backup=function(){this._previous=this._formater};Er.prototype._roolback=function(){this._previous===In?this.replace(void 0):this.replace(this._previous),this._previous=void 0};Error.prepareStackTrace&&Fe.format.replace(Error.prepareStackTrace);var ca=!1;function zu(e,t){if(la)return t;if(ca)return In(e,t);var r=t.concat();r=Fe.extend._modify(e,r),r=Fe.filter._modify(e,r),r=r.slice(0,Error.stackTraceLimit),Object.isExtensible(e)&&Object.getOwnPropertyDescriptor(e,"callSite")===void 0&&(e.callSite={original:t,mutated:r}),ca=!0;var n=Fe.format._formater(e,r);return ca=!1,n}Object.defineProperty(Error,"prepareStackTrace",{get:function(){return zu},set:function(e){e===zu?Fe.format._roolback():(Fe.format._backup(),Fe.format.replace(e))}});function dv(){return this.stack,this.callSite}Object.defineProperty(Error.prototype,"callSite",{get:dv,set:function(e){Object.defineProperty(this,"callSite",{value:e,writable:!0,configurable:!0})},configurable:!0});Xu.exports=Fe});var pa=p((Yy,fa)=>{if(global._stackChain)if(global._stackChain.version===ua().version)fa.exports=global._stackChain;else throw new Error("Conflicting version of stack-chain found");else fa.exports=global._stackChain=Ku()});var Wu=p((Jy,da)=>{"use strict";var hv=Vu();if(global._asyncHook)if(global._asyncHook.version===sa().version)da.exports=global._asyncHook;else throw new Error("Conflicting version of async-hook-jl found");else pa().filter.attach(function(t,r){return r.filter(function(n){let i=n.getFileName();return!(i&&i.slice(0,__dirname.length)===__dirname)})}),da.exports=global._asyncHook=new hv});var rc=p((Zy,tc)=>{"use strict";var U=require("util"),Pe=require("assert"),vv=Cn(),wt=Wu(),Cr="cls@contexts",Tr="error@context",Ju=[];for(let e in wt.providers)Ju[wt.providers[e]]=e;var H=process.env.DEBUG_CLS_HOOKED,V=-1;tc.exports={getNamespace:Zu,createNamespace:gv,destroyNamespace:ec,reset:_v,ERROR_SYMBOL:Tr};function pe(e){this.name=e,this.active=null,this._set=[],this.id=null,this._contexts=new Map}pe.prototype.set=function(t,r){if(!this.active)throw new Error("No context available. ns.run() or ns.bind() must be called first.");return H&&F("    SETTING KEY:"+t+"="+r+" in ns:"+this.name+" uid:"+V+" active:"+U.inspect(this.active,!0)),this.active[t]=r,r};pe.prototype.get=function(t){if(!this.active){H&&F("    GETTING KEY:"+t+"=undefined "+this.name+" uid:"+V+" active:"+U.inspect(this.active,!0));return}return H&&F("    GETTING KEY:"+t+"="+this.active[t]+" "+this.name+" uid:"+V+" active:"+U.inspect(this.active,!0)),this.active[t]};pe.prototype.createContext=function(){H&&F("   CREATING Context: "+this.name+" uid:"+V+" len:"+this._set.length+"  active:"+U.inspect(this.active,!0,2,!0));let t=Object.create(this.active?this.active:Object.prototype);return t._ns_name=this.name,t.id=V,H&&F("   CREATED Context: "+this.name+" uid:"+V+" len:"+this._set.length+"  context:"+U.inspect(t,!0,2,!0)),t};pe.prototype.run=function(t){let r=this.createContext();this.enter(r);try{return H&&F(" BEFORE RUN: "+this.name+" uid:"+V+" len:"+this._set.length+" "+U.inspect(r)),t(r),r}catch(n){throw n&&(n[Tr]=r),n}finally{H&&F(" AFTER RUN: "+this.name+" uid:"+V+" len:"+this._set.length+" "+U.inspect(r)),this.exit(r)}};pe.prototype.runAndReturn=function(t){var r;return this.run(function(n){r=t(n)}),r};pe.prototype.runPromise=function(t){let r=this.createContext();this.enter(r);let n=t(r);if(!n||!n.then||!n.catch)throw new Error("fn must return a promise.");return H&&F(" BEFORE runPromise: "+this.name+" uid:"+V+" len:"+this._set.length+" "+U.inspect(r)),n.then(i=>(H&&F(" AFTER runPromise: "+this.name+" uid:"+V+" len:"+this._set.length+" "+U.inspect(r)),this.exit(r),i)).catch(i=>{throw i[Tr]=r,H&&F(" AFTER runPromise: "+this.name+" uid:"+V+" len:"+this._set.length+" "+U.inspect(r)),this.exit(r),i})};pe.prototype.bind=function(t,r){r||(this.active?r=this.active:r=this.createContext());let n=this;return function(){n.enter(r);try{return t.apply(this,arguments)}catch(a){throw a&&(a[Tr]=r),a}finally{n.exit(r)}}};pe.prototype.enter=function(t){Pe.ok(t,"context must be provided for entering"),H&&F("  ENTER "+this.name+" uid:"+V+" len:"+this._set.length+" context: "+U.inspect(t)),this._set.push(this.active),this.active=t};pe.prototype.exit=function(t){if(Pe.ok(t,"context must be provided for exiting"),H&&F("  EXIT "+this.name+" uid:"+V+" len:"+this._set.length+" context: "+U.inspect(t)),this.active===t){Pe.ok(this._set.length,"can't remove top context"),this.active=this._set.pop();return}let r=this._set.lastIndexOf(t);r<0?(H&&F("??ERROR?? context exiting but not entered - ignoring: "+U.inspect(t)),Pe.ok(r>=0,`context not currently entered; can't exit. 
`+U.inspect(this)+`
`+U.inspect(t))):(Pe.ok(r,"can't remove top context"),this._set.splice(r,1))};pe.prototype.bindEmitter=function(t){Pe.ok(t.on&&t.addListener&&t.emit,"can only bind real EEs");let r=this,n="context@"+this.name;function i(s){!s||(s[Cr]||(s[Cr]=Object.create(null)),s[Cr][n]={namespace:r,context:r.active})}function a(s){if(!(s&&s[Cr]))return s;let o=s,u=s[Cr];return Object.keys(u).forEach(function(c){let l=u[c];o=l.namespace.bind(o,l.context)}),o}vv(t,i,a)};pe.prototype.fromException=function(t){return t[Tr]};function Zu(e){return process.namespaces[e]}function gv(e){Pe.ok(e,"namespace must be given a name."),H&&F("CREATING NAMESPACE "+e);let t=new pe(e);return t.id=V,wt.addHooks({init(r,n,i,a,s){V=r,a?(t._contexts.set(r,t._contexts.get(a)),H&&F("PARENTID: "+e+" uid:"+r+" parent:"+a+" provider:"+i)):t._contexts.set(V,t.active),H&&F("INIT "+e+" uid:"+r+" parent:"+a+" provider:"+Ju[i]+" active:"+U.inspect(t.active,!0))},pre(r,n){V=r;let i=t._contexts.get(r);i?(H&&F(" PRE "+e+" uid:"+r+" handle:"+bn(n)+" context:"+U.inspect(i)),t.enter(i)):H&&F(" PRE MISSING CONTEXT "+e+" uid:"+r+" handle:"+bn(n))},post(r,n){V=r;let i=t._contexts.get(r);i?(H&&F(" POST "+e+" uid:"+r+" handle:"+bn(n)+" context:"+U.inspect(i)),t.exit(i)):H&&F(" POST MISSING CONTEXT "+e+" uid:"+r+" handle:"+bn(n))},destroy(r){V=r,H&&F("DESTROY "+e+" uid:"+r+" context:"+U.inspect(t._contexts.get(V))+" active:"+U.inspect(t.active,!0)),t._contexts.delete(r)}}),process.namespaces[e]=t,t}function ec(e){let t=Zu(e);Pe.ok(t,`can't delete nonexistent namespace! "`+e+'"'),Pe.ok(t.id,"don't assign to process.namespaces directly! "+U.inspect(t)),process.namespaces[e]=null}function _v(){process.namespaces&&Object.keys(process.namespaces).forEach(function(e){ec(e)}),process.namespaces=Object.create(null)}process.namespaces={};wt._state&&!wt._state.enabled&&wt.enable();function F(e){process.env.DEBUG&&process._rawDebug(e)}function bn(e){if(!e)return e;if(typeof e=="function")return e.name?e.name:(e.toString().trim().match(/^function\s*([^\s(]+)/)||[])[1];if(e.constructor&&e.constructor.name)return e.constructor.name}if(H){ha=pa();for(Yu in ha.filter._modifiers)ha.filter.deattach(Yu)}var ha,Yu});var nc=p((eE,va)=>{"use strict";var mv=nn();process&&mv.gte(process.versions.node,"8.0.0")?va.exports=ku():va.exports=rc()});var sc=p((tE,ac)=>{var yv=mn().wrap,_a=1<<0,ma=1<<1,ya=1<<2,Sn=1<<3,D=[],Ev=0,Y=!1,Ue=[],At,Ea;function Ca(e,t){var r=e.length,n=t.length,i=[];if(r===0&&n===0)return i;for(var a=0;a<r;a++)i[a]=e[a];if(n===0)return i;for(var s=0;s<n;s++){var o=!0;for(a=0;a<r;a++)if(e[a].uid===t[s].uid){o=!1;break}o&&i.push(t[s])}return i}process._fatalException?(xn=!1,At=function(t){var r=D.length;if(xn||r===0)return!1;var n=!1;xn=!0;for(var i=0;i<r;++i){var a=D[i];if((a.flags&Sn)!==0){var s=Dt&&Dt[a.uid];n=a.error(s,t)||n}}return xn=!1,Ue.length>0&&(D=Ue.pop()),Dt=void 0,n&&!Y},Ea=function(t,r,n){var i=[];Y=!0;for(var a=0;a<n;++a){var s=r[a];if(i[s.uid]=s.data,(s.flags&_a)!==0){var o=s.create(s.data);o!==void 0&&(i[s.uid]=o)}}return Y=!1,function(){Dt=i,Ue.push(D),D=Ca(r,D),Y=!0;for(var u=0;u<n;++u)(r[u].flags&ma)>0&&r[u].before(this,i[r[u].uid]);Y=!1;var c=t.apply(this,arguments);for(Y=!0,u=0;u<n;++u)(r[u].flags&ya)>0&&r[u].after(this,i[r[u].uid]);return Y=!1,D=Ue.pop(),Dt=void 0,c}},yv(process,"_fatalException",function(e){return function(r){return At(r)||e(r)}})):(ga=!1,At=function(t){if(ga)throw t;for(var r=!1,n=D.length,i=0;i<n;++i){var a=D[i];(a.flags&Sn)!==0&&(r=a.error(null,t)||r)}if(!r&&Y)throw t},Ea=function(t,r,n){var i=[];Y=!0;for(var a=0;a<n;++a){var s=r[a];if(i[s.uid]=s.data,(s.flags&_a)!==0){var o=s.create(s.data);o!==void 0&&(i[s.uid]=o)}}return Y=!1,function(){var u=!1,c=!1;Ue.push(D),D=Ca(r,D),Y=!0;for(var l=0;l<n;++l)(r[l].flags&ma)>0&&r[l].before(this,i[r[l].uid]);Y=!1;var f;try{f=t.apply(this,arguments)}catch(d){u=!0;for(var l=0;l<n;++l)if((D[l].flags&Sn)!=0)try{c=D[l].error(i[r[l].uid],d)||c}catch(_){throw ga=!0,_}if(!c)throw process.removeListener("uncaughtException",At),process._originalNextTick(function(){process.addListener("uncaughtException",At)}),d}finally{if(!u||c){for(Y=!0,l=0;l<n;++l)(r[l].flags&ya)>0&&r[l].after(this,i[r[l].uid]);Y=!1}D=Ue.pop()}return f}},process.addListener("uncaughtException",At));var xn,Dt,ga;function Cv(e,t,r){Y=!0;for(var n=0;n<r;++n){var i=t[n];i.create&&i.create(i.data)}return Y=!1,function(){Ue.push(D),D=Ca(t,D);var a=e.apply(this,arguments);return D=Ue.pop(),a}}function Tv(e){var t=D.length;if(t===0)return e;for(var r=D.slice(),n=0;n<t;++n)if(r[n].flags>0)return Ea(e,r,t);return Cv(e,r,t)}function Te(e,t){typeof e.create=="function"&&(this.create=e.create,this.flags|=_a),typeof e.before=="function"&&(this.before=e.before,this.flags|=ma),typeof e.after=="function"&&(this.after=e.after,this.flags|=ya),typeof e.error=="function"&&(this.error=e.error,this.flags|=Sn),this.uid=++Ev,this.data=t===void 0?null:t}Te.prototype.create=void 0;Te.prototype.before=void 0;Te.prototype.after=void 0;Te.prototype.error=void 0;Te.prototype.data=void 0;Te.prototype.uid=0;Te.prototype.flags=0;function ic(e,t){if(typeof e!="object"||!e)throw new TypeError("callbacks argument must be an object");return e instanceof Te?e:new Te(e,t)}function Iv(e,t){var r;e instanceof Te?r=e:r=ic(e,t);for(var n=!1,i=0;i<D.length;i++)if(r===D[i]){n=!0;break}return n||D.push(r),r}function bv(e){for(var t=0;t<D.length;t++)if(e===D[t]){D.splice(t,1);break}}process.createAsyncListener=ic;process.addAsyncListener=Iv;process.removeAsyncListener=bv;ac.exports=Tv});var uc=p((nE,oc)=>{"use strict";oc.exports=(e,t)=>class extends e{constructor(n){var i,a;super(o);var s=this;try{n.apply(i,a)}catch(u){a[1](u)}return s;function o(u,c){i=this,a=[l,f];function l(d){return t(s,!1),u(d)}function f(d){return t(s,!1),c(d)}}}}});var vc=p(()=>{"use strict";if(process.addAsyncListener)throw new Error("Don't require polyfill unless needed");var pc=mn(),An=nn(),se=pc.wrap,$e=pc.massWrap,M=sc(),xv=require("util"),Sv=An.gte(process.version,"6.0.0"),ba=An.gte(process.version,"7.0.0"),wv=An.gte(process.version,"8.0.0"),Av=An.gte(process.version,"11.0.0"),Ie=require("net");ba&&!Ie._normalizeArgs?Ie._normalizeArgs=function(e){if(e.length===0)return[{},null];var t=e[0],r={};typeof t=="object"&&t!==null?r=t:Ov(t)?r.path=t:(r.port=t,e.length>1&&typeof e[1]=="string"&&(r.host=e[1]));var n=e[e.length-1];return typeof n!="function"?[r,null]:[r,n]}:!ba&&!Ie._normalizeConnectArgs&&(Ie._normalizeConnectArgs=function(e){var t={};function r(i){return(i=Number(i))>=0?i:!1}typeof e[0]=="object"&&e[0]!==null?t=e[0]:typeof e[0]=="string"&&r(e[0])===!1?t.path=e[0]:(t.port=e[0],typeof e[1]=="string"&&(t.host=e[1]));var n=e[e.length-1];return typeof n=="function"?[t,n]:[t]});"_setUpListenHandle"in Ie.Server.prototype?se(Ie.Server.prototype,"_setUpListenHandle",cc):se(Ie.Server.prototype,"_listen2",cc);function cc(e){return function(){this.on("connection",function(t){t._handle&&(t._handle.onread=M(t._handle.onread))});try{return e.apply(this,arguments)}finally{this._handle&&this._handle.onconnection&&(this._handle.onconnection=M(this._handle.onconnection))}}}function dc(e){if(e&&e._handle){var t=e._handle;t._originalOnread||(t._originalOnread=t.onread),t.onread=M(t._originalOnread)}}se(Ie.Socket.prototype,"connect",function(e){return function(){var t;wv&&Array.isArray(arguments[0])&&Object.getOwnPropertySymbols(arguments[0]).length>0?t=arguments[0]:t=ba?Ie._normalizeArgs(arguments):Ie._normalizeConnectArgs(arguments),t[1]&&(t[1]=M(t[1]));var r=e.apply(this,t);return dc(this),r}});var Dv=require("http");se(Dv.Agent.prototype,"addRequest",function(e){return function(t){var r=t.onSocket;return t.onSocket=M(function(n){return dc(n),r.apply(this,arguments)}),e.apply(this,arguments)}});var Ta=require("child_process");function lc(e){Array.isArray(e.stdio)&&e.stdio.forEach(function(t){t&&t._handle&&(t._handle.onread=M(t._handle.onread),se(t._handle,"close",Dn))}),e._handle&&(e._handle.onexit=M(e._handle.onexit))}Ta.ChildProcess?se(Ta.ChildProcess.prototype,"spawn",function(e){return function(){var t=e.apply(this,arguments);return lc(this),t}}):$e(Ta,["execFile","fork","spawn"],function(e){return function(){var t=e.apply(this,arguments);return lc(t),t}});process._fatalException||(process._originalNextTick=process.nextTick);var wa=[];process._nextDomainTick&&wa.push("_nextDomainTick");process._tickDomainCallback&&wa.push("_tickDomainCallback");$e(process,wa,be);se(process,"nextTick",Dn);var Aa=["setTimeout","setInterval"];global.setImmediate&&Aa.push("setImmediate");var hc=require("timers"),Rv=global.setTimeout===hc.setTimeout;$e(hc,Aa,Dn);Rv&&$e(global,Aa,Dn);var xa=require("dns");$e(xa,["lookup","resolve","resolve4","resolve6","resolveCname","resolveMx","resolveNs","resolveTxt","resolveSrv","reverse"],be);xa.resolveNaptr&&se(xa,"resolveNaptr",be);var at=require("fs");$e(at,["watch","rename","truncate","chown","fchown","chmod","fchmod","stat","lstat","fstat","link","symlink","readlink","realpath","unlink","rmdir","mkdir","readdir","close","open","utimes","futimes","fsync","write","read","readFile","writeFile","appendFile","watchFile","unwatchFile","exists"],be);at.lchown&&se(at,"lchown",be);at.lchmod&&se(at,"lchmod",be);at.ftruncate&&se(at,"ftruncate",be);var Ir;try{Ir=require("zlib")}catch{}Ir&&Ir.Deflate&&Ir.Deflate.prototype&&(it=Object.getPrototypeOf(Ir.Deflate.prototype),it._transform?se(it,"_transform",be):it.write&&it.flush&&it.end&&$e(it,["write","flush","end"],be));var it,Sa;try{Sa=require("crypto")}catch{}Sa&&(Ia=["pbkdf2","randomBytes"],Av||Ia.push("pseudoRandomBytes"),$e(Sa,Ia,be));var Ia,wn=!!global.Promise&&Promise.toString()==="function Promise() { [native code] }"&&Promise.toString.toString()==="function toString() { [native code] }";wn&&(fc=process.addAsyncListener({create:function(){wn=!1}}),global.Promise.resolve(!0).then(function(){wn=!1}),process.removeAsyncListener(fc));var fc;wn&&Pv();function Pv(){var e=global.Promise;function t(s){if(!(this instanceof t))return e(s);if(typeof s!="function")return new e(s);var o,u,c=new e(l);c.__proto__=t.prototype;try{s.apply(o,u)}catch(f){u[1](f)}return c;function l(f,d){o=this,u=[g,_];function g(T){return n(c,!1),f(T)}function _(T){return n(c,!1),d(T)}}}if(xv.inherits(t,e),se(e.prototype,"then",a),e.prototype.chain&&se(e.prototype,"chain",a),Sv)global.Promise=uc()(e,n);else{var r=["all","race","reject","resolve","accept","defer"];r.forEach(function(s){typeof e[s]=="function"&&(t[s]=e[s])}),global.Promise=t}function n(s,o){(!s.__asl_wrapper||o)&&(s.__asl_wrapper=M(i))}function i(s,o,u,c){var l;try{return l=o.call(s,u),{returnVal:l,error:!1}}catch(f){return{errorVal:f,error:!0}}finally{l instanceof e?c.__asl_wrapper=function(){var d=l.__asl_wrapper||i;return d.apply(this,arguments)}:n(c,!0)}}function a(s){return function(){var u=this,c=s.apply(u,Array.prototype.map.call(arguments,l));return c.__asl_wrapper=function(d,g,_,T){return u.__asl_wrapper?(u.__asl_wrapper(d,function(){},null,c),c.__asl_wrapper(d,g,_,T)):i(d,g,_,T)},c;function l(f){return typeof f!="function"?f:M(function(d){var g=(u.__asl_wrapper||i)(this,f,d,c);if(g.error)throw g.errorVal;return g.returnVal})}}}}function be(e){var t=function(){var r,n=arguments.length-1;if(typeof arguments[n]=="function"){r=Array(arguments.length);for(var i=0;i<arguments.length-1;i++)r[i]=arguments[i];r[n]=M(arguments[n])}return e.apply(this,r||arguments)};switch(e.length){case 1:return function(r){return arguments.length!==1?t.apply(this,arguments):(typeof r=="function"&&(r=M(r)),e.call(this,r))};case 2:return function(r,n){return arguments.length!==2?t.apply(this,arguments):(typeof n=="function"&&(n=M(n)),e.call(this,r,n))};case 3:return function(r,n,i){return arguments.length!==3?t.apply(this,arguments):(typeof i=="function"&&(i=M(i)),e.call(this,r,n,i))};case 4:return function(r,n,i,a){return arguments.length!==4?t.apply(this,arguments):(typeof a=="function"&&(a=M(a)),e.call(this,r,n,i,a))};case 5:return function(r,n,i,a,s){return arguments.length!==5?t.apply(this,arguments):(typeof s=="function"&&(s=M(s)),e.call(this,r,n,i,a,s))};case 6:return function(r,n,i,a,s,o){return arguments.length!==6?t.apply(this,arguments):(typeof o=="function"&&(o=M(o)),e.call(this,r,n,i,a,s,o))};default:return t}}function Dn(e){var t=function(){var r;if(typeof arguments[0]=="function"){r=Array(arguments.length),r[0]=M(arguments[0]);for(var n=1;n<arguments.length;n++)r[n]=arguments[n]}return e.apply(this,r||arguments)};switch(e.length){case 1:return function(r){return arguments.length!==1?t.apply(this,arguments):(typeof r=="function"&&(r=M(r)),e.call(this,r))};case 2:return function(r,n){return arguments.length!==2?t.apply(this,arguments):(typeof r=="function"&&(r=M(r)),e.call(this,r,n))};case 3:return function(r,n,i){return arguments.length!==3?t.apply(this,arguments):(typeof r=="function"&&(r=M(r)),e.call(this,r,n,i))};case 4:return function(r,n,i,a){return arguments.length!==4?t.apply(this,arguments):(typeof r=="function"&&(r=M(r)),e.call(this,r,n,i,a))};case 5:return function(r,n,i,a,s){return arguments.length!==5?t.apply(this,arguments):(typeof r=="function"&&(r=M(r)),e.call(this,r,n,i,a,s))};case 6:return function(r,n,i,a,s,o){return arguments.length!==6?t.apply(this,arguments):(typeof r=="function"&&(r=M(r)),e.call(this,r,n,i,a,s,o))};default:return t}}function qv(e){return(e=Number(e))>=0?e:!1}function Ov(e){return typeof e=="string"&&qv(e)===!1}});var Ec=p((sE,yc)=>{"use strict";var qe=require("assert"),kv=Cn(),br="cls@contexts",Da="error@context";process.addAsyncListener||vc();function me(e){this.name=e,this.active=null,this._set=[],this.id=null}me.prototype.set=function(e,t){if(!this.active)throw new Error("No context available. ns.run() or ns.bind() must be called first.");return this.active[e]=t,t};me.prototype.get=function(e){if(!!this.active)return this.active[e]};me.prototype.createContext=function(){return Object.create(this.active)};me.prototype.run=function(e){var t=this.createContext();this.enter(t);try{return e(t),t}catch(r){throw r&&(r[Da]=t),r}finally{this.exit(t)}};me.prototype.runAndReturn=function(e){var t;return this.run(function(r){t=e(r)}),t};me.prototype.bind=function(e,t){t||(this.active?t=this.active:t=this.createContext());var r=this;return function(){r.enter(t);try{return e.apply(this,arguments)}catch(n){throw n&&(n[Da]=t),n}finally{r.exit(t)}}};me.prototype.enter=function(e){qe.ok(e,"context must be provided for entering"),this._set.push(this.active),this.active=e};me.prototype.exit=function(e){if(qe.ok(e,"context must be provided for exiting"),this.active===e){qe.ok(this._set.length,"can't remove top context"),this.active=this._set.pop();return}var t=this._set.lastIndexOf(e);qe.ok(t>=0,"context not currently entered; can't exit"),qe.ok(t,"can't remove top context"),this._set.splice(t,1)};me.prototype.bindEmitter=function(e){qe.ok(e.on&&e.addListener&&e.emit,"can only bind real EEs");var t=this,r="context@"+this.name;function n(a){!a||(a[br]||(a[br]=Object.create(null)),a[br][r]={namespace:t,context:t.active})}function i(a){if(!(a&&a[br]))return a;var s=a,o=a[br];return Object.keys(o).forEach(function(u){var c=o[u];s=c.namespace.bind(s,c.context)}),s}kv(e,n,i)};me.prototype.fromException=function(e){return e[Da]};function gc(e){return process.namespaces[e]}function Nv(e){qe.ok(e,"namespace must be given a name!");var t=new me(e);return t.id=process.addAsyncListener({create:function(){return t.active},before:function(r,n){n&&t.enter(n)},after:function(r,n){n&&t.exit(n)},error:function(r){r&&t.exit(r)}}),process.namespaces[e]=t,t}function _c(e){var t=gc(e);qe.ok(t,"can't delete nonexistent namespace!"),qe.ok(t.id,"don't assign to process.namespaces directly!"),process.removeAsyncListener(t.id),process.namespaces[e]=null}function mc(){process.namespaces&&Object.keys(process.namespaces).forEach(function(e){_c(e)}),process.namespaces=Object.create(null)}process.namespaces||mc();yc.exports={getNamespace:gc,createNamespace:Nv,destroyNamespace:_c,reset:mc}});var Xe=p(Pa=>{"use strict";Object.defineProperty(Pa,"__esModule",{value:!0});var Tc=B(),Lv=fn(),xr=fr(),Ra=Ni(),Cc=ta(),Mv=function(){function e(){}return e.getCurrentContext=function(){if(!e.enabled)return null;var t=e.session.get(e.CONTEXT_NAME);return t===void 0?null:t},e.generateContextObject=function(t,r,n,i,a,s){return r=r||t,this.enabled?{operation:{name:n,id:t,parentId:r,traceparent:a,tracestate:s},customProperties:new Hv(i)}:null},e.spanToContextObject=function(t,r,n){var i=new xr;return i.traceId=t.traceId,i.spanId=t.spanId,i.traceFlag=t.traceFlags||xr.DEFAULT_TRACE_FLAG,i.parentId=r,e.generateContextObject(i.traceId,i.parentId,n,null,i)},e.runWithContext=function(t,r){if(e.enabled)return e.session.bind(r,(n={},n[e.CONTEXT_NAME]=t,n))();return r();var n},e.wrapEmitter=function(t){e.enabled&&e.session.bindEmitter(t)},e.wrapCallback=function(t,r){if(e.enabled)return e.session.bind(t,r?(n={},n[e.CONTEXT_NAME]=r,n):void 0);return t;var n},e.enable=function(t){if(!this.enabled){if(!this.isNodeVersionCompatible()){this.enabled=!1;return}e.hasEverEnabled||(this.forceClsHooked=t,this.hasEverEnabled=!0,typeof this.cls>"u"&&(e.forceClsHooked===!0||e.forceClsHooked===void 0&&e.shouldUseClsHooked()?this.cls=nc():this.cls=Ec()),e.session=this.cls.createNamespace("AI-CLS-Session"),Lv.registerContextPreservation(function(r){return e.session.bind(r)})),this.enabled=!0}},e.startOperation=function(t,r){var n=t&&t.traceContext||null,i=t&&t.traceId?t:null,a=t&&t.headers;if(i){var s=new xr("00-"+i.traceId+"-"+i.spanId+"-01"),o=new Ra(i.tracestate),u=e.generateContextObject(i.traceId,"|"+i.traceId+"."+i.spanId+".",typeof r=="string"?r:"",void 0,s,o);return u}if(n){var s=new xr(n.traceparent),o=new Ra(n.tracestate),c=typeof r=="object"?new Cc(r):null,u=e.generateContextObject(s.traceId,s.parentId,typeof r=="string"?r:c.getOperationName({}),c&&c.getCorrelationContextHeader()||void 0,s,o);return u}if(a){var s=new xr(a.traceparent),o=new Ra(a.tracestate),c=new Cc(t),u=e.generateContextObject(s.traceId,s.parentId,c.getOperationName({}),c.getCorrelationContextHeader(),s,o);return u}return Tc.warn("startOperation was called with invalid arguments",arguments),null},e.disable=function(){this.enabled=!1},e.reset=function(){e.hasEverEnabled&&(e.session=null,e.session=this.cls.createNamespace("AI-CLS-Session"))},e.isNodeVersionCompatible=function(){var t=process.versions.node.split(".");return parseInt(t[0])>3||parseInt(t[0])>2&&parseInt(t[1])>2},e.shouldUseClsHooked=function(){var t=process.versions.node.split(".");return parseInt(t[0])>8||parseInt(t[0])>=8&&parseInt(t[1])>=2},e.canUseClsHooked=function(){var t=process.versions.node.split("."),r=parseInt(t[0])>8||parseInt(t[0])>=8&&parseInt(t[1])>=0,n=parseInt(t[0])<8||parseInt(t[0])<=8&&parseInt(t[1])<2,i=parseInt(t[0])>4||parseInt(t[0])>=4&&parseInt(t[1])>=7;return!(r&&n)&&i},e.enabled=!1,e.hasEverEnabled=!1,e.forceClsHooked=void 0,e.CONTEXT_NAME="ApplicationInsights-Context",e}();Pa.CorrelationContextManager=Mv;var Hv=function(){function e(t){this.props=[],this.addHeaderData(t)}return e.prototype.addHeaderData=function(t){var r=t?t.split(", "):[];this.props=r.map(function(n){var i=n.split("=");return{key:i[0],value:i[1]}}).concat(this.props)},e.prototype.serializeToHeader=function(){return this.props.map(function(t){return t.key+"="+t.value}).join(", ")},e.prototype.getProperty=function(t){for(var r=0;r<this.props.length;++r){var n=this.props[r];if(n.key===t)return n.value}},e.prototype.setProperty=function(t,r){if(e.bannedCharacters.test(t)||e.bannedCharacters.test(r)){Tc.warn("Correlation context property keys and values must not contain ',' or '='. setProperty was called with key: "+t+" and value: "+r);return}for(var n=0;n<this.props.length;++n){var i=this.props[n];if(i.key===t){i.value=r;return}}this.props.push({key:t,value:r})},e.bannedCharacters=/[,=]/,e}()});var bc=p(Rn=>{"use strict";Object.defineProperty(Rn,"__esModule",{value:!0});var Ic=ae(),qa=j(),st=[],Oa=function(e){var t=e.data.message;st.forEach(function(r){t instanceof Error?r.trackException({exception:t}):(t.lastIndexOf(`
`)==t.length-1&&(t=t.substring(0,t.length-1)),r.trackTrace({message:t,severity:e.data.stderr?Ic.SeverityLevel.Warning:Ic.SeverityLevel.Information}))})};function jv(e,t){e?(st.length===0&&qa.channel.subscribe("console",Oa),st.push(t)):(st=st.filter(function(r){return r!=t}),st.length===0&&qa.channel.unsubscribe("console",Oa))}Rn.enable=jv;function Fv(){qa.channel.unsubscribe("console",Oa),st=[]}Rn.dispose=Fv});var xc=p(Pn=>{"use strict";Object.defineProperty(Pn,"__esModule",{value:!0});var Rt=ae(),ka=j(),ot=[],Uv={10:Rt.SeverityLevel.Verbose,20:Rt.SeverityLevel.Verbose,30:Rt.SeverityLevel.Information,40:Rt.SeverityLevel.Warning,50:Rt.SeverityLevel.Error,60:Rt.SeverityLevel.Critical},Na=function(e){var t=e.data.result;ot.forEach(function(r){var n=Uv[e.data.level];t instanceof Error?r.trackException({exception:t}):r.trackTrace({message:t,severity:n})})};function $v(e,t){e?(ot.length===0&&ka.channel.subscribe("bunyan",Na),ot.push(t)):(ot=ot.filter(function(r){return r!=t}),ot.length===0&&ka.channel.unsubscribe("bunyan",Na))}Pn.enable=$v;function Vv(){ka.channel.unsubscribe("bunyan",Na),ot=[]}Pn.dispose=Vv});var Sc=p(qn=>{"use strict";Object.defineProperty(qn,"__esModule",{value:!0});var X=ae(),La=j(),ut=[],Bv={syslog:function(e){var t={emerg:X.SeverityLevel.Critical,alert:X.SeverityLevel.Critical,crit:X.SeverityLevel.Critical,error:X.SeverityLevel.Error,warning:X.SeverityLevel.Warning,notice:X.SeverityLevel.Information,info:X.SeverityLevel.Information,debug:X.SeverityLevel.Verbose};return t[e]===void 0?X.SeverityLevel.Information:t[e]},npm:function(e){var t={error:X.SeverityLevel.Error,warn:X.SeverityLevel.Warning,info:X.SeverityLevel.Information,verbose:X.SeverityLevel.Verbose,debug:X.SeverityLevel.Verbose,silly:X.SeverityLevel.Verbose};return t[e]===void 0?X.SeverityLevel.Information:t[e]},unknown:function(e){return X.SeverityLevel.Information}},Ma=function(e){var t=e.data.message;ut.forEach(function(r){if(t instanceof Error)r.trackException({exception:t,properties:e.data.meta});else{var n=Bv[e.data.levelKind](e.data.level);r.trackTrace({message:t,severity:n,properties:e.data.meta})}})};function Gv(e,t){e?(ut.length===0&&La.channel.subscribe("winston",Ma),ut.push(t)):(ut=ut.filter(function(r){return r!=t}),ut.length===0&&La.channel.unsubscribe("winston",Ma))}qn.enable=Gv;function zv(){La.channel.unsubscribe("winston",Ma),ut=[]}qn.dispose=zv});var Ac=p((fE,wc)=>{"use strict";var Qv=fn(),Xv=function(){function e(t){if(e.INSTANCE)throw new Error("Console logging adapter tracking should be configured from the applicationInsights object");this._client=t,e.INSTANCE=this}return e.prototype.enable=function(t,r){Qv.IsInitialized&&(bc().enable(t&&r,this._client),xc().enable(t,this._client),Sc().enable(t,this._client))},e.prototype.isInitialized=function(){return this._isInitialized},e.prototype.dispose=function(){e.INSTANCE=null,this.enable(!1,!1)},e._methodNames=["debug","info","log","warn","error"],e}();wc.exports=Xv});var Rc=p((pE,Dc)=>{"use strict";var Kv=function(){function e(t){if(e.INSTANCE)throw new Error("Exception tracking should be configured from the applicationInsights object");e.INSTANCE=this,this._client=t;var r=process.versions.node.split(".");e._canUseUncaughtExceptionMonitor=parseInt(r[0])>13||parseInt(r[0])===13&&parseInt(r[1])>=7}return e.prototype.isInitialized=function(){return this._isInitialized},e.prototype.enable=function(t){var r=this;if(t){this._isInitialized=!0;var n=this;if(!this._exceptionListenerHandle){var i=function(a,s,o){o===void 0&&(o=new Error(e._FALLBACK_ERROR_MESSAGE)),r._client.trackException({exception:o}),r._client.flush({isAppCrashing:!0}),a&&s&&process.listeners(s).length===1&&(console.error(o),process.exit(1))};e._canUseUncaughtExceptionMonitor?(this._exceptionListenerHandle=i.bind(this,!1,void 0),process.on(e.UNCAUGHT_EXCEPTION_MONITOR_HANDLER_NAME,this._exceptionListenerHandle)):(this._exceptionListenerHandle=i.bind(this,!0,e.UNCAUGHT_EXCEPTION_HANDLER_NAME),this._rejectionListenerHandle=i.bind(this,!1,void 0),process.on(e.UNCAUGHT_EXCEPTION_HANDLER_NAME,this._exceptionListenerHandle),process.on(e.UNHANDLED_REJECTION_HANDLER_NAME,this._rejectionListenerHandle))}}else this._exceptionListenerHandle&&(e._canUseUncaughtExceptionMonitor?process.removeListener(e.UNCAUGHT_EXCEPTION_MONITOR_HANDLER_NAME,this._exceptionListenerHandle):(process.removeListener(e.UNCAUGHT_EXCEPTION_HANDLER_NAME,this._exceptionListenerHandle),process.removeListener(e.UNHANDLED_REJECTION_HANDLER_NAME,this._rejectionListenerHandle)),this._exceptionListenerHandle=void 0,this._rejectionListenerHandle=void 0,delete this._exceptionListenerHandle,delete this._rejectionListenerHandle)},e.prototype.dispose=function(){e.INSTANCE=null,this.enable(!1),this._isInitialized=!1},e.INSTANCE=null,e.UNCAUGHT_EXCEPTION_MONITOR_HANDLER_NAME="uncaughtExceptionMonitor",e.UNCAUGHT_EXCEPTION_HANDLER_NAME="uncaughtException",e.UNHANDLED_REJECTION_HANDLER_NAME="unhandledRejection",e._RETHROW_EXIT_MESSAGE="Application Insights Rethrow Exception Handler",e._FALLBACK_ERROR_MESSAGE="A promise was rejected without providing an error. Application Insights generated this error stack for you.",e._canUseUncaughtExceptionMonitor=!1,e}();Dc.exports=Kv});var Ve=p(b=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0});b.DEFAULT_BREEZE_ENDPOINT="https://dc.services.visualstudio.com";b.DEFAULT_LIVEMETRICS_ENDPOINT="https://rt.services.visualstudio.com";b.DEFAULT_LIVEMETRICS_HOST="rt.services.visualstudio.com";var J;(function(e){e.COMMITTED_BYTES="\\Memory\\Committed Bytes",e.PROCESSOR_TIME="\\Processor(_Total)\\% Processor Time",e.REQUEST_RATE="\\ApplicationInsights\\Requests/Sec",e.REQUEST_FAILURE_RATE="\\ApplicationInsights\\Requests Failed/Sec",e.REQUEST_DURATION="\\ApplicationInsights\\Request Duration",e.DEPENDENCY_RATE="\\ApplicationInsights\\Dependency Calls/Sec",e.DEPENDENCY_FAILURE_RATE="\\ApplicationInsights\\Dependency Calls Failed/Sec",e.DEPENDENCY_DURATION="\\ApplicationInsights\\Dependency Call Duration",e.EXCEPTION_RATE="\\ApplicationInsights\\Exceptions/Sec"})(J=b.QuickPulseCounter||(b.QuickPulseCounter={}));var On;(function(e){e.PRIVATE_BYTES="\\Process(??APP_WIN32_PROC??)\\Private Bytes",e.AVAILABLE_BYTES="\\Memory\\Available Bytes",e.PROCESSOR_TIME="\\Processor(_Total)\\% Processor Time",e.PROCESS_TIME="\\Process(??APP_WIN32_PROC??)\\% Processor Time",e.REQUEST_RATE="\\ASP.NET Applications(??APP_W3SVC_PROC??)\\Requests/Sec",e.REQUEST_DURATION="\\ASP.NET Applications(??APP_W3SVC_PROC??)\\Request Execution Time"})(On=b.PerformanceCounter||(b.PerformanceCounter={}));b.PerformanceToQuickPulseCounter=(ye={},ye[On.PROCESSOR_TIME]=J.PROCESSOR_TIME,ye[On.REQUEST_RATE]=J.REQUEST_RATE,ye[On.REQUEST_DURATION]=J.REQUEST_DURATION,ye[J.COMMITTED_BYTES]=J.COMMITTED_BYTES,ye[J.REQUEST_FAILURE_RATE]=J.REQUEST_FAILURE_RATE,ye[J.DEPENDENCY_RATE]=J.DEPENDENCY_RATE,ye[J.DEPENDENCY_FAILURE_RATE]=J.DEPENDENCY_FAILURE_RATE,ye[J.DEPENDENCY_DURATION]=J.DEPENDENCY_DURATION,ye[J.EXCEPTION_RATE]=J.EXCEPTION_RATE,ye);b.QuickPulseDocumentType={Event:"Event",Exception:"Exception",Trace:"Trace",Metric:"Metric",Request:"Request",Dependency:"RemoteDependency",Availability:"Availability",PageView:"PageView"};b.QuickPulseType={Event:"EventTelemetryDocument",Exception:"ExceptionTelemetryDocument",Trace:"TraceTelemetryDocument",Metric:"MetricTelemetryDocument",Request:"RequestTelemetryDocument",Dependency:"DependencyTelemetryDocument",Availability:"AvailabilityTelemetryDocument",PageView:"PageViewTelemetryDocument"};b.TelemetryTypeStringToQuickPulseType={EventData:b.QuickPulseType.Event,ExceptionData:b.QuickPulseType.Exception,MessageData:b.QuickPulseType.Trace,MetricData:b.QuickPulseType.Metric,RequestData:b.QuickPulseType.Request,RemoteDependencyData:b.QuickPulseType.Dependency,AvailabilityData:b.QuickPulseType.Availability,PageViewData:b.QuickPulseType.PageView};b.TelemetryTypeStringToQuickPulseDocumentType={EventData:b.QuickPulseDocumentType.Event,ExceptionData:b.QuickPulseDocumentType.Exception,MessageData:b.QuickPulseDocumentType.Trace,MetricData:b.QuickPulseDocumentType.Metric,RequestData:b.QuickPulseDocumentType.Request,RemoteDependencyData:b.QuickPulseDocumentType.Dependency,AvailabilityData:b.QuickPulseDocumentType.Availability,PageViewData:b.QuickPulseDocumentType.PageView};b.SpanAttribute={HttpHost:"http.host",HttpMethod:"http.method",HttpPort:"http.port",HttpStatusCode:"http.status_code",HttpUrl:"http.url",HttpUserAgent:"http.user_agent",GrpcMethod:"grpc.method",GrpcService:"rpc.service"};b.DependencyTypeName={Grpc:"GRPC",Http:"HTTP",InProc:"InProc"};b.HeartBeatMetricName="HeartBeat";var ye});var Nn=p((hE,Pc)=>{"use strict";var kn=require("os"),de=Ve(),Wv=function(){function e(t,r,n){r===void 0&&(r=6e4),n===void 0&&(n=!1),this._lastIntervalRequestExecutionTime=0,this._lastIntervalDependencyExecutionTime=0,e.INSTANCE||(e.INSTANCE=this),this._isInitialized=!1,this._client=t,this._collectionInterval=r,this._enableLiveMetricsCounters=n}return e.prototype.enable=function(t,r){var n=this;this._isEnabled=t,this._isEnabled&&!this._isInitialized&&(this._isInitialized=!0),t?this._handle||(this._lastCpus=kn.cpus(),this._lastRequests={totalRequestCount:e._totalRequestCount,totalFailedRequestCount:e._totalFailedRequestCount,time:+new Date},this._lastDependencies={totalDependencyCount:e._totalDependencyCount,totalFailedDependencyCount:e._totalFailedDependencyCount,time:+new Date},this._lastExceptions={totalExceptionCount:e._totalExceptionCount,time:+new Date},typeof process.cpuUsage=="function"&&(this._lastAppCpuUsage=process.cpuUsage()),this._lastHrtime=process.hrtime(),this._collectionInterval=r||this._collectionInterval,this._handle=setInterval(function(){return n.trackPerformance()},this._collectionInterval),this._handle.unref()):this._handle&&(clearInterval(this._handle),this._handle=void 0)},e.countRequest=function(t,r){var n;if(!!e.isEnabled()){if(typeof t=="string")n=+new Date("1970-01-01T"+t+"Z");else if(typeof t=="number")n=t;else return;e._intervalRequestExecutionTime+=n,r===!1&&e._totalFailedRequestCount++,e._totalRequestCount++}},e.countException=function(){e._totalExceptionCount++},e.countDependency=function(t,r){var n;if(!!e.isEnabled()){if(typeof t=="string")n=+new Date("1970-01-01T"+t+"Z");else if(typeof t=="number")n=t;else return;e._intervalDependencyExecutionTime+=n,r===!1&&e._totalFailedDependencyCount++,e._totalDependencyCount++}},e.prototype.isInitialized=function(){return this._isInitialized},e.isEnabled=function(){return e.INSTANCE&&e.INSTANCE._isEnabled},e.prototype.trackPerformance=function(){this._trackCpu(),this._trackMemory(),this._trackNetwork(),this._trackDependencyRate(),this._trackExceptionRate()},e.prototype._trackCpu=function(){var t=kn.cpus();if(t&&t.length&&this._lastCpus&&t.length===this._lastCpus.length){for(var r=0,n=0,i=0,a=0,s=0,o=0;!!t&&o<t.length;o++){var u=t[o],c=this._lastCpus[o],l="% cpu("+o+") ",f=u.model,d=u.speed,g=u.times,_=c.times,T=g.user-_.user||0;r+=T;var k=g.sys-_.sys||0;n+=k;var q=g.nice-_.nice||0;i+=q;var v=g.idle-_.idle||0;a+=v;var w=g.irq-_.irq||0;s+=w}var K=void 0;if(typeof process.cpuUsage=="function"){var G=process.cpuUsage(),ne=process.hrtime(),Xt=G.user-this._lastAppCpuUsage.user+(G.system-this._lastAppCpuUsage.system)||0;if(typeof this._lastHrtime<"u"&&this._lastHrtime.length===2){var ei=(ne[0]-this._lastHrtime[0])*1e6+(ne[1]-this._lastHrtime[1])/1e3||0;K=100*Xt/(ei*t.length)}this._lastAppCpuUsage=G,this._lastHrtime=ne}var Ge=r+n+i+a+s||1;this._client.trackMetric({name:de.PerformanceCounter.PROCESSOR_TIME,value:(Ge-a)/Ge*100}),this._client.trackMetric({name:de.PerformanceCounter.PROCESS_TIME,value:K||r/Ge*100})}this._lastCpus=t},e.prototype._trackMemory=function(){var t=kn.freemem(),r=process.memoryUsage().rss,n=kn.totalmem()-t;this._client.trackMetric({name:de.PerformanceCounter.PRIVATE_BYTES,value:r}),this._client.trackMetric({name:de.PerformanceCounter.AVAILABLE_BYTES,value:t}),this._enableLiveMetricsCounters&&this._client.trackMetric({name:de.QuickPulseCounter.COMMITTED_BYTES,value:n})},e.prototype._trackNetwork=function(){var t=this._lastRequests,r={totalRequestCount:e._totalRequestCount,totalFailedRequestCount:e._totalFailedRequestCount,time:+new Date},n=r.totalRequestCount-t.totalRequestCount||0,i=r.totalFailedRequestCount-t.totalFailedRequestCount||0,a=r.time-t.time,s=a/1e3,o=(e._intervalRequestExecutionTime-this._lastIntervalRequestExecutionTime)/n||0;if(this._lastIntervalRequestExecutionTime=e._intervalRequestExecutionTime,a>0){var u=n/s,c=i/s;this._client.trackMetric({name:de.PerformanceCounter.REQUEST_RATE,value:u}),(!this._enableLiveMetricsCounters||n>0)&&this._client.trackMetric({name:de.PerformanceCounter.REQUEST_DURATION,value:o}),this._enableLiveMetricsCounters&&this._client.trackMetric({name:de.QuickPulseCounter.REQUEST_FAILURE_RATE,value:c})}this._lastRequests=r},e.prototype._trackDependencyRate=function(){if(this._enableLiveMetricsCounters){var t=this._lastDependencies,r={totalDependencyCount:e._totalDependencyCount,totalFailedDependencyCount:e._totalFailedDependencyCount,time:+new Date},n=r.totalDependencyCount-t.totalDependencyCount||0,i=r.totalFailedDependencyCount-t.totalFailedDependencyCount||0,a=r.time-t.time,s=a/1e3,o=(e._intervalDependencyExecutionTime-this._lastIntervalDependencyExecutionTime)/n||0;if(this._lastIntervalDependencyExecutionTime=e._intervalDependencyExecutionTime,a>0){var u=n/s,c=i/s;this._client.trackMetric({name:de.QuickPulseCounter.DEPENDENCY_RATE,value:u}),this._client.trackMetric({name:de.QuickPulseCounter.DEPENDENCY_FAILURE_RATE,value:c}),(!this._enableLiveMetricsCounters||n>0)&&this._client.trackMetric({name:de.QuickPulseCounter.DEPENDENCY_DURATION,value:o})}this._lastDependencies=r}},e.prototype._trackExceptionRate=function(){if(this._enableLiveMetricsCounters){var t=this._lastExceptions,r={totalExceptionCount:e._totalExceptionCount,time:+new Date},n=r.totalExceptionCount-t.totalExceptionCount||0,i=r.time-t.time,a=i/1e3;if(i>0){var s=n/a;this._client.trackMetric({name:de.QuickPulseCounter.EXCEPTION_RATE,value:s})}this._lastExceptions=r}},e.prototype.dispose=function(){e.INSTANCE=null,this.enable(!1),this._isInitialized=!1},e._totalRequestCount=0,e._totalFailedRequestCount=0,e._lastRequestExecutionTime=0,e._totalDependencyCount=0,e._totalFailedDependencyCount=0,e._lastDependencyExecutionTime=0,e._totalExceptionCount=0,e._intervalDependencyExecutionTime=0,e._intervalRequestExecutionTime=0,e}();Pc.exports=Wv});var Sr=p((vE,Nc)=>{"use strict";var Oe=require("os"),qc=require("fs"),Oc=require("path"),Yv=ae(),kc=B(),Jv=function(){function e(t){this.keys=new Yv.ContextTagKeys,this.tags={},this._loadApplicationContext(t),this._loadDeviceContext(),this._loadInternalContext()}return e.prototype._loadApplicationContext=function(t){if(t=t||Oc.resolve(__dirname,"../../../../package.json"),!e.appVersion[t]){e.appVersion[t]="unknown";try{var r=JSON.parse(qc.readFileSync(t,"utf8"));r&&typeof r.version=="string"&&(e.appVersion[t]=r.version)}catch(n){kc.info("unable to read app version: ",n)}}this.tags[this.keys.applicationVersion]=e.appVersion[t]},e.prototype._loadDeviceContext=function(){this.tags[this.keys.deviceId]="",this.tags[this.keys.cloudRoleInstance]=Oe&&Oe.hostname(),this.tags[this.keys.deviceOSVersion]=Oe&&Oe.type()+" "+Oe.release(),this.tags[this.keys.cloudRole]=e.DefaultRoleName,this.tags["ai.device.osArchitecture"]=Oe&&Oe.arch(),this.tags["ai.device.osPlatform"]=Oe&&Oe.platform()},e.prototype._loadInternalContext=function(){var t=Oc.resolve(__dirname,"../../package.json");if(!e.sdkVersion){e.sdkVersion="unknown";try{var r=JSON.parse(qc.readFileSync(t,"utf8"));r&&typeof r.version=="string"&&(e.sdkVersion=r.version)}catch(n){kc.info("unable to read app version: ",n)}}this.tags[this.keys.internalSdkVersion]="node:"+e.sdkVersion},e.DefaultRoleName="Web",e.appVersion={},e.sdkVersion=null,e}();Nc.exports=Jv});var Mc=p((ja,Lc)=>{"use strict";var Zv=ja&&ja.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])};return function(t,r){e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ee=require("url"),Ha=ae(),eg=ue(),tg=bt(),rg=Ji(),ng=et(),ig=function(e){Zv(t,e);function t(r,n){var i=e.call(this)||this;return n&&n.method&&r&&(i.method=n.method,i.url=t._getUrlFromRequestOptions(r,n),i.startTime=+new Date),i}return t.prototype.onError=function(r){this._setStatus(void 0,r)},t.prototype.onResponse=function(r){this._setStatus(r.statusCode,void 0),this.correlationId=eg.getCorrelationContextTarget(r,tg.requestContextTargetKey)},t.prototype.getDependencyTelemetry=function(r,n){var i=Ee.parse(this.url);i.search=void 0,i.hash=void 0;var a=this.method.toUpperCase()+" "+i.pathname,s=Ha.RemoteDependencyDataConstants.TYPE_HTTP,o=i.hostname;i.port&&(o+=":"+i.port),this.correlationId?(s=Ha.RemoteDependencyDataConstants.TYPE_AI,this.correlationId!==ng.correlationIdPrefix&&(o+=" | "+this.correlationId)):s=Ha.RemoteDependencyDataConstants.TYPE_HTTP;var u={id:n,name:a,data:this.url,duration:this.duration,success:this._isSuccess(),resultCode:this.statusCode?this.statusCode.toString():null,properties:this.properties||{},dependencyTypeName:s,target:o};if(r&&r.time?u.time=r.time:this.startTime&&(u.time=new Date(this.startTime)),r){for(var c in r)u[c]||(u[c]=r[c]);if(r.properties)for(var c in r.properties)u.properties[c]=r.properties[c]}return u},t._getUrlFromRequestOptions=function(r,n){if(typeof r=="string")if(r.indexOf("http://")===0||r.indexOf("https://")===0)r=Ee.parse(r);else{var i=Ee.parse(r);i.host==="443"?r=Ee.parse("https://"+r):r=Ee.parse("http://"+r)}else{if(r&&typeof Ee.URL=="function"&&r instanceof Ee.URL)return Ee.format(r);var a=r;r={},a&&Object.keys(a).forEach(function(u){r[u]=a[u]})}if(r.path){var s=Ee.parse(r.path);r.pathname=s.pathname,r.search=s.search}if(r.host&&r.port){var o=Ee.parse("http://"+r.host);!o.port&&r.port&&(r.hostname=r.host,delete r.host)}return r.protocol=r.protocol||n.agent&&n.agent.protocol||n.protocol||void 0,r.hostname=r.hostname||"localhost",Ee.format(r)},t}(rg);Lc.exports=ig});var jc=p(wr=>{"use strict";var Hc=wr&&wr.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e};Object.defineProperty(wr,"__esModule",{value:!0});var ag=Qr(),oe=Ve();function Fa(e){var t=Hc({},e);return Object.keys(oe.SpanAttribute).forEach(function(r){delete t[r]}),t}function sg(e){var t="|"+e.context().traceId+"."+e.context().spanId+".",r=Math.round(e._duration[0]*1e3+e._duration[1]/1e6),n=e.attributes["peer.address"]?e.attributes["peer.address"].toString():"",i=e.attributes.component?e.attributes.component.toString():"",a=i.toUpperCase()===oe.DependencyTypeName.Http||!!e.attributes[oe.SpanAttribute.HttpUrl],s=i.toLowerCase()===oe.DependencyTypeName.Grpc;if(a){var o=e.attributes[oe.SpanAttribute.HttpMethod]||"GET",u=new URL(e.attributes[oe.SpanAttribute.HttpUrl].toString()),c=e.attributes[oe.SpanAttribute.HttpHost]||u.host,l=e.attributes[oe.SpanAttribute.HttpPort]||u.port||null,f=u.pathname||"/",d=o+" "+f,g=oe.DependencyTypeName.Http,_=l?(c+":"+l).toString():c.toString(),T=u.toString(),k=e.attributes[oe.SpanAttribute.HttpStatusCode]||e.status.code||0,q=k<400;return{id:t,name:d,dependencyTypeName:g,target:_,data:T,success:q,duration:r,url:T,resultCode:String(k),properties:Fa(e.attributes)}}else if(s){var o=e.attributes[oe.SpanAttribute.GrpcMethod]||"rpc",v=e.attributes[oe.SpanAttribute.GrpcService],w=v?o+" "+v:e.name;return{id:t,duration:r,name:w,target:v.toString(),data:v.toString()||w,url:v.toString()||w,dependencyTypeName:oe.DependencyTypeName.Grpc,resultCode:String(e.status.code||0),success:e.status.code===0,properties:Fa(e.attributes)}}else{var K=e.name,G=e.links&&e.links.map(function(ne){return{operation_Id:ne.context.traceId,id:ne.context.spanId}});return{id:t,duration:r,name:K,target:n,data:n||K,url:n||K,dependencyTypeName:e.kind===ag.SpanKind.INTERNAL?oe.DependencyTypeName.InProc:i||e.name,resultCode:String(e.status.code||0),success:e.status.code===0,properties:Hc({},Fa(e.attributes),{"_MS.links":G||void 0})}}}wr.spanToTelemetryContract=sg});var Uc=p(qt=>{"use strict";Object.defineProperty(qt,"__esModule",{value:!0});var Fc=j(),og=fr(),ug=jc(),Ln=Qr(),Pt=[];qt.subscriber=function(e){var t=e.data,r=ug.spanToTelemetryContract(t),n=t.context(),i=new og;i.traceId=n.traceId,i.spanId=n.spanId,i.traceFlag=n.traceFlags.toString(),i.parentId=t.parentSpanId?"|"+n.traceId+"."+t.parentSpanId+".":null,Ln.AsyncScopeManager.with(t,function(){Pt.forEach(function(a){t.kind===Ln.SpanKind.SERVER?a.trackRequest(r):(t.kind===Ln.SpanKind.CLIENT||t.kind===Ln.SpanKind.INTERNAL)&&a.trackDependency(r)})})};function cg(e,t){e?(Pt.length===0&&Fc.channel.subscribe("azure-coretracing",qt.subscriber),Pt.push(t)):(Pt=Pt.filter(function(r){return r!=t}),Pt.length===0&&Fc.channel.unsubscribe("azure-coretracing",qt.subscriber))}qt.enable=cg});var Vc=p(kt=>{"use strict";Object.defineProperty(kt,"__esModule",{value:!0});var $c=j(),Ot=[];kt.subscriber=function(e){e.data.event.commandName!=="ismaster"&&Ot.forEach(function(t){var r=e.data.startedData&&e.data.startedData.databaseName||"Unknown database";t.trackDependency({target:r,data:e.data.event.commandName,name:e.data.event.commandName,duration:e.data.event.duration,success:e.data.succeeded,resultCode:e.data.succeeded?"0":"1",time:e.data.startedData.time,dependencyTypeName:"mongodb"})})};function lg(e,t){e?(Ot.length===0&&$c.channel.subscribe("mongodb",kt.subscriber),Ot.push(t)):(Ot=Ot.filter(function(r){return r!=t}),Ot.length===0&&$c.channel.unsubscribe("mongodb",kt.subscriber))}kt.enable=lg});var Gc=p(Lt=>{"use strict";Object.defineProperty(Lt,"__esModule",{value:!0});var Bc=j(),Nt=[];Lt.subscriber=function(e){Nt.forEach(function(t){var r=e.data.query||{},n=r.sql||"Unknown query",i=!e.data.err,a=r._connection||{},s=a.config||{},o=s.socketPath?s.socketPath:(s.host||"localhost")+":"+s.port;t.trackDependency({target:o,data:n,name:n,duration:e.data.duration,success:i,resultCode:i?"0":"1",time:e.data.time,dependencyTypeName:"mysql"})})};function fg(e,t){e?(Nt.length===0&&Bc.channel.subscribe("mysql",Lt.subscriber),Nt.push(t)):(Nt=Nt.filter(function(r){return r!=t}),Nt.length===0&&Bc.channel.unsubscribe("mysql",Lt.subscriber))}Lt.enable=fg});var Qc=p(Ht=>{"use strict";Object.defineProperty(Ht,"__esModule",{value:!0});var zc=j(),Mt=[];Ht.subscriber=function(e){Mt.forEach(function(t){e.data.commandObj.command!=="info"&&t.trackDependency({target:e.data.address,name:e.data.commandObj.command,data:e.data.commandObj.command,duration:e.data.duration,success:!e.data.err,resultCode:e.data.err?"1":"0",time:e.data.time,dependencyTypeName:"redis"})})};function pg(e,t){e?(Mt.length===0&&zc.channel.subscribe("redis",Ht.subscriber),Mt.push(t)):(Mt=Mt.filter(function(r){return r!=t}),Mt.length===0&&zc.channel.unsubscribe("redis",Ht.subscriber))}Ht.enable=pg});var Kc=p(Ft=>{"use strict";Object.defineProperty(Ft,"__esModule",{value:!0});var Xc=j(),jt=[];Ft.subscriber=function(e){jt.forEach(function(t){var r=e.data.query,n=r.preparable&&r.preparable.text||r.plan||r.text||"unknown query",i=!e.data.error,a=e.data.database.host+":"+e.data.database.port;t.trackDependency({target:a,data:n,name:n,duration:e.data.duration,success:i,resultCode:i?"0":"1",time:e.data.time,dependencyTypeName:"postgres"})})};function dg(e,t){e?(jt.length===0&&Xc.channel.subscribe("postgres",Ft.subscriber),jt.push(t)):(jt=jt.filter(function(r){return r!=t}),jt.length===0&&Xc.channel.unsubscribe("postgres",Ft.subscriber))}Ft.enable=dg});var $t=p((TE,Zc)=>{"use strict";var ct=require("http"),Ut=require("https"),Ua=B(),Wc=ue(),Be=bt(),hg=Mc(),Yc=Xe(),Jc=et(),$a=fr(),vg=fn(),gg=function(){function e(t){if(e.INSTANCE)throw new Error("Client request tracking should be configured from the applicationInsights object");e.INSTANCE=this,this._client=t}return e.prototype.enable=function(t){this._isEnabled=t,this._isEnabled&&!this._isInitialized&&this._initialize(),vg.IsInitialized&&(Uc().enable(!0,this._client),Vc().enable(t,this._client),Gc().enable(t,this._client),Qc().enable(t,this._client),Kc().enable(t,this._client))},e.prototype.isInitialized=function(){return this._isInitialized},e.prototype._initialize=function(){var t=this;this._isInitialized=!0;var r=ct.get,n=ct.request,i=Ut.request,a=function(s,o){var u=!o[e.disableCollectionRequestOption]&&!s[e.alreadyAutoCollectedFlag];o.headers&&o.headers["user-agent"]&&o.headers["user-agent"].toString().indexOf("azsdk-js")!==-1&&(u=!1),s[e.alreadyAutoCollectedFlag]=!0,s&&o&&u&&(Yc.CorrelationContextManager.wrapEmitter(s),e.trackRequest(t._client,{options:o,request:s}))};ct.request=function(s){for(var o=[],u=1;u<arguments.length;u++)o[u-1]=arguments[u];var c=n.call.apply(n,[ct,s].concat(o));return a(c,s),c},Ut.request=function(s){for(var o=[],u=1;u<arguments.length;u++)o[u-1]=arguments[u];var c=i.call.apply(i,[Ut,s].concat(o));return a(c,s),c},ct.get=function(s){for(var o=[],u=1;u<arguments.length;u++)o[u-1]=arguments[u];var c=(l=ct.request).call.apply(l,[ct,s].concat(o));return c.end(),c;var l},Ut.get=function(s){for(var o=[],u=1;u<arguments.length;u++)o[u-1]=arguments[u];var c=(l=Ut.request).call.apply(l,[Ut,s].concat(o));return c.end(),c;var l}},e.trackRequest=function(t,r){if(!r.options||!r.request||!t){Ua.info("AutoCollectHttpDependencies.trackRequest was called with invalid parameters: ",!r.options,!r.request,!t);return}var n=new hg(r.options,r.request),i=Yc.CorrelationContextManager.getCurrentContext(),a,s;if(i&&i.operation&&i.operation.traceparent&&$a.isValidTraceId(i.operation.traceparent.traceId))i.operation.traceparent.updateSpanId(),a=i.operation.traceparent.getBackCompatRequestId();else if(Jc.w3cEnabled){var o=new $a;s=o.toString(),a=o.getBackCompatRequestId()}else a=i&&i.operation&&i.operation.parentId+e.requestNumber+++".";if(Wc.canIncludeCorrelationHeader(t,n.getUrl())&&r.request.getHeader&&r.request.setHeader&&t.config&&t.config.correlationId){var u=r.request.getHeader(Be.requestContextHeader);try{Wc.safeIncludeCorrelationHeader(t,r.request,u)}catch(f){Ua.warn("Request-Context header could not be set. Correlation of requests may be lost",f)}if(i&&i.operation)try{if(r.request.setHeader(Be.requestIdHeader,a),t.config.ignoreLegacyHeaders||(r.request.setHeader(Be.parentIdHeader,i.operation.id),r.request.setHeader(Be.rootIdHeader,a)),s||i.operation.traceparent)r.request.setHeader(Be.traceparentHeader,s||i.operation.traceparent.toString());else if(Jc.w3cEnabled){var o=new $a().toString();r.request.setHeader(Be.traceparentHeader,o)}if(i.operation.tracestate){var c=i.operation.tracestate.toString();c&&r.request.setHeader(Be.traceStateHeader,c)}var l=i.customProperties.serializeToHeader();l&&r.request.setHeader(Be.correlationContextHeader,l)}catch(f){Ua.warn("Correlation headers could not be set. Correlation of requests may be lost.",f)}}r.request.on&&(r.request.on("response",function(f){n.onResponse(f);var d=n.getDependencyTelemetry(r,a);d.contextObjects=d.contextObjects||{},d.contextObjects["http.RequestOptions"]=r.options,d.contextObjects["http.ClientRequest"]=r.request,d.contextObjects["http.ClientResponse"]=f,t.trackDependency(d)}),r.request.on("error",function(f){n.onError(f);var d=n.getDependencyTelemetry(r,a);d.contextObjects=d.contextObjects||{},d.contextObjects["http.RequestOptions"]=r.options,d.contextObjects["http.ClientRequest"]=r.request,d.contextObjects.Error=f,t.trackDependency(d)}))},e.prototype.dispose=function(){e.INSTANCE=null,this.enable(!1),this._isInitialized=!1},e.disableCollectionRequestOption="disableAppInsightsAutoCollection",e.requestNumber=1,e.alreadyAutoCollectedFlag="_appInsightsAutoCollected",e}();Zc.exports=gg});var rl=p((IE,tl)=>{"use strict";var _g=require("os"),el=Ve(),mg=ue(),yg=Sr(),Eg=$t(),Cg="http://169.254.169.254/metadata/instance/compute",Tg="api-version=2017-12-01",Ig="format=json",bg="ENETUNREACH",xg=function(){function e(t){this._collectionInterval=9e5,this._vmData={},this._azInst_vmId="",this._azInst_subscriptionId="",this._azInst_osType="",e.INSTANCE||(e.INSTANCE=this),this._isInitialized=!1,this._client=t}return e.prototype.enable=function(t,r){var n=this;this._isEnabled=t,this._isEnabled&&!this._isInitialized&&(this._isInitialized=!0),t?this._handle||(this._handle=setInterval(function(){return n.trackHeartBeat(r,function(){})},this._collectionInterval),this._handle.unref()):this._handle&&(clearInterval(this._handle),this._handle=null)},e.prototype.isInitialized=function(){return this._isInitialized},e.isEnabled=function(){return e.INSTANCE&&e.INSTANCE._isEnabled},e.prototype.trackHeartBeat=function(t,r){var n=this,i=!1,a={},s=yg.sdkVersion;a.sdk=s,a.osType=_g.type(),process.env.WEBSITE_SITE_NAME?(a.appSrv_SiteName=process.env.WEBSITE_SITE_NAME||"",a.appSrv_wsStamp=process.env.WEBSITE_HOME_STAMPNAME||"",a.appSrv_wsHost=process.env.WEBSITE_HOSTNAME||""):process.env.FUNCTIONS_WORKER_RUNTIME?a.azfunction_appId=process.env.WEBSITE_HOSTNAME:t&&(this._isVM===void 0?(i=!0,this._getAzureComputeMetadata(t,function(){n._isVM&&Object.keys(n._vmData).length>0&&(a.azInst_vmId=n._vmData.vmId||"",a.azInst_subscriptionId=n._vmData.subscriptionId||"",a.azInst_osType=n._vmData.osType||"",n._azInst_vmId=n._vmData.vmId||"",n._azInst_subscriptionId=n._vmData.subscriptionId||"",n._azInst_osType=n._vmData.osType||""),n._client.trackMetric({name:el.HeartBeatMetricName,value:0,properties:a}),r()})):this._isVM&&(a.azInst_vmId=this._azInst_vmId,a.azInst_subscriptionId=this._azInst_subscriptionId,a.azInst_osType=this._azInst_osType)),i||(this._client.trackMetric({name:el.HeartBeatMetricName,value:0,properties:a}),r())},e.prototype.dispose=function(){e.INSTANCE=null,this.enable(!1),this._isInitialized=!1},e.prototype._getAzureComputeMetadata=function(t,r){var n=this,i=Cg+"?"+Tg+"&"+Ig,a=(o={method:"GET"},o[Eg.disableCollectionRequestOption]=!0,o.headers={Metadata:"True"},o),s=mg.makeRequest(t,i,a,function(u){if(u.statusCode===200){n._isVM=!0;var c="";u.on("data",function(l){c+=l}),u.on("end",function(){n._vmData=n._isJSON(c)?JSON.parse(c):{},r()})}else r()});s&&(s.on("error",function(u){u&&u.message&&u.message.indexOf(bg)>-1&&(n._isVM=!1),r()}),s.end());var o},e.prototype._isJSON=function(t){try{return JSON.parse(t)&&!!t}catch{return!1}},e}();tl.exports=xg});var Ba=p((bE,ol)=>{"use strict";var nl=require("http"),il=require("https"),al=B(),sl=ue(),Sg=bt(),Va=ta(),ke=Xe(),wg=Nn(),Ag=function(){function e(t){if(e.INSTANCE)throw new Error("Server request tracking should be configured from the applicationInsights object");e.INSTANCE=this,this._client=t}return e.prototype.enable=function(t){this._isEnabled=t,(this._isAutoCorrelating||this._isEnabled||wg.isEnabled())&&!this._isInitialized&&(this.useAutoCorrelation(this._isAutoCorrelating),this._initialize())},e.prototype.useAutoCorrelation=function(t,r){t&&!this._isAutoCorrelating?ke.CorrelationContextManager.enable(r):!t&&this._isAutoCorrelating&&ke.CorrelationContextManager.disable(),this._isAutoCorrelating=t},e.prototype.isInitialized=function(){return this._isInitialized},e.prototype.isAutoCorrelating=function(){return this._isAutoCorrelating},e.prototype._generateCorrelationContext=function(t){if(!!this._isAutoCorrelating)return ke.CorrelationContextManager.generateContextObject(t.getOperationId(this._client.context.tags),t.getRequestId(),t.getOperationName(this._client.context.tags),t.getCorrelationContextHeader(),t.getTraceparent(),t.getTracestate())},e.prototype._initialize=function(){var t=this;this._isInitialized=!0;var r=function(s){if(!!s){if(typeof s!="function")throw new Error("onRequest handler must be a function");return function(o,u){ke.CorrelationContextManager.wrapEmitter(o),ke.CorrelationContextManager.wrapEmitter(u);var c=o&&!o[e.alreadyAutoCollectedFlag];if(o&&c){var l=new Va(o),f=t._generateCorrelationContext(l);ke.CorrelationContextManager.runWithContext(f,function(){t._isEnabled&&(o[e.alreadyAutoCollectedFlag]=!0,e.trackRequest(t._client,{request:o,response:u},l)),typeof s=="function"&&s(o,u)})}else typeof s=="function"&&s(o,u)}}},n=function(s){var o=s.addListener.bind(s);s.addListener=function(u,c){switch(u){case"request":case"checkContinue":return o(u,r(c));default:return o(u,c)}},s.on=s.addListener},i=nl.createServer;nl.createServer=function(s,o){if(o&&typeof o=="function"){var u=i(s,r(o));return n(u),u}else{var u=i(r(s));return n(u),u}};var a=il.createServer;il.createServer=function(s,o){var u=a(s,r(o));return n(u),u}},e.trackRequestSync=function(t,r){if(!r.request||!r.response||!t){al.info("AutoCollectHttpRequests.trackRequestSync was called with invalid parameters: ",!r.request,!r.response,!t);return}e.addResponseCorrelationIdHeader(t,r.response);var n=ke.CorrelationContextManager.getCurrentContext(),i=new Va(r.request,n&&n.operation.parentId);n&&(n.operation.id=i.getOperationId(t.context.tags)||n.operation.id,n.operation.name=i.getOperationName(t.context.tags)||n.operation.name,n.operation.parentId=i.getRequestId()||n.operation.parentId,n.customProperties.addHeaderData(i.getCorrelationContextHeader())),e.endRequest(t,i,r,r.duration,r.error)},e.trackRequest=function(t,r,n){if(!r.request||!r.response||!t){al.info("AutoCollectHttpRequests.trackRequest was called with invalid parameters: ",!r.request,!r.response,!t);return}var i=ke.CorrelationContextManager.getCurrentContext(),a=n||new Va(r.request,i&&i.operation.parentId);sl.canIncludeCorrelationHeader(t,a.getUrl())&&e.addResponseCorrelationIdHeader(t,r.response),i&&!n&&(i.operation.id=a.getOperationId(t.context.tags)||i.operation.id,i.operation.name=a.getOperationName(t.context.tags)||i.operation.name,i.operation.parentId=a.getOperationParentId(t.context.tags)||i.operation.parentId,i.customProperties.addHeaderData(a.getCorrelationContextHeader())),r.response.once&&r.response.once("finish",function(){e.endRequest(t,a,r,null,null)}),r.request.on&&r.request.on("error",function(s){e.endRequest(t,a,r,null,s)})},e.addResponseCorrelationIdHeader=function(t,r){if(t.config&&t.config.correlationId&&r.getHeader&&r.setHeader&&!r.headersSent){var n=r.getHeader(Sg.requestContextHeader);sl.safeIncludeCorrelationHeader(t,r,n)}},e.endRequest=function(t,r,n,i,a){a?r.onError(a,i):r.onResponse(n.response,i);var s=r.getRequestTelemetry(n);if(s.tagOverrides=r.getRequestTags(t.context.tags),n.tagOverrides)for(var o in n.tagOverrides)s.tagOverrides[o]=n.tagOverrides[o];var u=r.getLegacyRootId();u&&(s.properties.ai_legacyRootId=u),s.contextObjects=s.contextObjects||{},s.contextObjects["http.ServerRequest"]=n.request,s.contextObjects["http.ServerResponse"]=n.response,t.trackRequest(s)},e.prototype.dispose=function(){e.INSTANCE=null,this.enable(!1),this._isInitialized=!1,ke.CorrelationContextManager.disable(),this._isAutoCorrelating=!1},e.alreadyAutoCollectedFlag="_appInsightsAutoCollected",e}();ol.exports=Ag});var ll=p((xE,cl)=>{"use strict";var ul=Ve(),Dg=function(){function e(){}return e.parse=function(t){if(!t)return{};var r=t.split(e._FIELDS_SEPARATOR),n=r.reduce(function(a,s){var o=s.split(e._FIELD_KEY_VALUE_SEPARATOR);if(o.length===2){var u=o[0].toLowerCase(),c=o[1];a[u]=c}return a},{});if(Object.keys(n).length>0){if(n.endpointsuffix){var i=n.location?n.location+".":"";n.ingestionendpoint=n.ingestionendpoint||"https://"+i+"dc."+n.endpointsuffix,n.liveendpoint=n.liveendpoint||"https://"+i+"live."+n.endpointsuffix}n.ingestionendpoint=n.ingestionendpoint||ul.DEFAULT_BREEZE_ENDPOINT,n.liveendpoint=n.liveendpoint||ul.DEFAULT_LIVEMETRICS_ENDPOINT}return n},e._FIELDS_SEPARATOR=";",e._FIELD_KEY_VALUE_SEPARATOR="=",e}();cl.exports=Dg});var Mn=p((SE,dl)=>{"use strict";var Ga=et(),fl=ll(),Rg=B(),pl=Ve(),Pg=require("url"),qg=function(){function e(t){var r=this;this.endpointBase=pl.DEFAULT_BREEZE_ENDPOINT;var n=process.env[e.ENV_connectionString],i=fl.parse(t),a=fl.parse(n),s=!i.instrumentationkey&&Object.keys(i).length>0?null:t;this.instrumentationKey=i.instrumentationkey||s||a.instrumentationkey||e._getInstrumentationKey(),e._validateInstrumentationKey(this.instrumentationKey)||Rg.warn("An invalid instrumentation key was provided. There may be resulting telemetry loss",this.instrumentationKey),this.endpointUrl=(i.ingestionendpoint||a.ingestionendpoint||this.endpointBase)+"/v2/track",this.maxBatchSize=250,this.maxBatchIntervalMs=15e3,this.disableAppInsights=!1,this.samplingPercentage=100,this.correlationIdRetryIntervalMs=30*1e3,this.correlationHeaderExcludedDomains=["*.core.windows.net","*.core.chinacloudapi.cn","*.core.cloudapi.de","*.core.usgovcloudapi.net","*.core.microsoft.scloud","*.core.eaglex.ic.gov"],this.setCorrelationId=function(o){return r.correlationId=o},this.proxyHttpUrl=process.env[e.ENV_http_proxy]||void 0,this.proxyHttpsUrl=process.env[e.ENV_https_proxy]||void 0,this.httpAgent=void 0,this.httpsAgent=void 0,this.profileQueryEndpoint=i.ingestionendpoint||a.ingestionendpoint||process.env[e.ENV_profileQueryEndpoint]||this.endpointBase,this._quickPulseHost=i.liveendpoint||a.liveendpoint||process.env[e.ENV_quickPulseHost]||pl.DEFAULT_LIVEMETRICS_HOST,this._quickPulseHost.match(/^https?:\/\//)&&(this._quickPulseHost=Pg.parse(this._quickPulseHost).host)}return Object.defineProperty(e.prototype,"profileQueryEndpoint",{get:function(){return this._profileQueryEndpoint},set:function(t){Ga.cancelCorrelationIdQuery(this,this.setCorrelationId),this._profileQueryEndpoint=t,this.correlationId=Ga.correlationIdPrefix,Ga.queryCorrelationId(this,this.setCorrelationId)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"quickPulseHost",{get:function(){return this._quickPulseHost},set:function(t){this._quickPulseHost=t},enumerable:!0,configurable:!0}),e._getInstrumentationKey=function(){var t=process.env[e.ENV_iKey]||process.env[e.ENV_azurePrefix+e.ENV_iKey]||process.env[e.legacy_ENV_iKey]||process.env[e.ENV_azurePrefix+e.legacy_ENV_iKey];if(!t||t=="")throw new Error("Instrumentation key not found, pass the key in the config to this method or set the key in the environment variable APPINSIGHTS_INSTRUMENTATIONKEY before starting the server");return t},e._validateInstrumentationKey=function(t){var r="^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$",n=new RegExp(r);return n.test(t)},e.ENV_azurePrefix="APPSETTING_",e.ENV_iKey="APPINSIGHTS_INSTRUMENTATIONKEY",e.legacy_ENV_iKey="APPINSIGHTS_INSTRUMENTATION_KEY",e.ENV_profileQueryEndpoint="APPINSIGHTS_PROFILE_QUERY_ENDPOINT",e.ENV_quickPulseHost="APPINSIGHTS_QUICKPULSE_HOST",e.ENV_connectionString="APPLICATIONINSIGHTS_CONNECTION_STRING",e.ENV_nativeMetricsDisablers="APPLICATION_INSIGHTS_DISABLE_EXTENDED_METRIC",e.ENV_nativeMetricsDisableAll="APPLICATION_INSIGHTS_DISABLE_ALL_EXTENDED_METRICS",e.ENV_http_proxy="http_proxy",e.ENV_https_proxy="https_proxy",e}();dl.exports=qg});var gl=p((Qa,vl)=>{"use strict";var Ar=Qa&&Qa.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},za=require("os"),lt=ae(),hl=Ve(),Og=ue(),kg=B(),Ng=Og.w3cTraceId(),Lg=function(){function e(){}return e.createQuickPulseEnvelope=function(t,r,n,i){var a=za&&typeof za.hostname=="function"&&za.hostname()||"Unknown",s=i.tags&&i.keys&&i.keys.cloudRoleInstance&&i.tags[i.keys.cloudRoleInstance]||a,o={Documents:r.length>0?r:null,InstrumentationKey:n.instrumentationKey||"",Metrics:t.length>0?t:null,InvariantVersion:1,Timestamp:"/Date("+Date.now()+")/",Version:i.tags[i.keys.internalSdkVersion],StreamId:Ng,MachineName:a,Instance:s};return o},e.createQuickPulseMetric=function(t){var r;return r={Name:t.name,Value:t.value,Weight:t.count||1},r},e.telemetryEnvelopeToQuickPulseDocument=function(t){switch(t.data.baseType){case lt.TelemetryTypeString.Event:return e.createQuickPulseEventDocument(t);case lt.TelemetryTypeString.Exception:return e.createQuickPulseExceptionDocument(t);case lt.TelemetryTypeString.Trace:return e.createQuickPulseTraceDocument(t);case lt.TelemetryTypeString.Dependency:return e.createQuickPulseDependencyDocument(t);case lt.TelemetryTypeString.Request:return e.createQuickPulseRequestDocument(t)}return null},e.createQuickPulseEventDocument=function(t){var r=e.createQuickPulseDocument(t),n=t.data.baseData.name,i=Ar({},r,{Name:n});return i},e.createQuickPulseTraceDocument=function(t){var r=e.createQuickPulseDocument(t),n=t.data.baseData.severityLevel||0,i=Ar({},r,{Message:t.data.baseData.message,SeverityLevel:lt.SeverityLevel[n]});return i},e.createQuickPulseExceptionDocument=function(t){var r=e.createQuickPulseDocument(t),n=t.data.baseData.exceptions,i="",a="",s="";n&&n.length>0&&(n[0].parsedStack&&n[0].parsedStack.length>0?n[0].parsedStack.forEach(function(u){i+=u.assembly+`
`}):n[0].stack&&n[0].stack.length>0&&(i=n[0].stack),a=n[0].message,s=n[0].typeName);var o=Ar({},r,{Exception:i,ExceptionMessage:a,ExceptionType:s});return o},e.createQuickPulseRequestDocument=function(t){var r=e.createQuickPulseDocument(t),n=t.data.baseData,i=Ar({},r,{Name:n.name,Success:n.success,Duration:n.duration,ResponseCode:n.responseCode,OperationName:n.name});return i},e.createQuickPulseDependencyDocument=function(t){var r=e.createQuickPulseDocument(t),n=t.data.baseData,i=Ar({},r,{Name:n.name,Target:n.target,Success:n.success,Duration:n.duration,ResultCode:n.resultCode,CommandName:n.data,OperationName:r.OperationId,DependencyTypeName:n.type});return i},e.createQuickPulseDocument=function(t){var r,n,i,a;t.data.baseType?(n=hl.TelemetryTypeStringToQuickPulseType[t.data.baseType],r=hl.TelemetryTypeStringToQuickPulseDocumentType[t.data.baseType]):kg.warn("Document type invalid; not sending live metric document",t.data.baseType),i=t.tags[e.keys.operationId],a=e.aggregateProperties(t);var s={DocumentType:r,__type:n,OperationId:i,Version:"1.0",Properties:a};return s},e.aggregateProperties=function(t){var r=[],n=t.data.baseData.measurements||{};for(var i in n)if(n.hasOwnProperty(i)){var a=n[i],s={key:i,value:a};r.push(s)}var o=t.data.baseData.properties||{};for(var i in o)if(o.hasOwnProperty(i)){var a=o[i],s={key:i,value:a};r.push(s)}return r},e.keys=new lt.ContextTagKeys,e}();vl.exports=Lg});var ml=p((wE,_l)=>{"use strict";var Mg=function(){return(Date.now()+621355968e5)*1e4};_l.exports={getTransmissionTime:Mg}});var Cl=p((AE,El)=>{"use strict";var Hg=require("https"),jg=$t(),yl=B(),Fg=ml(),Ug=ue(),Xa={method:"POST",time:"x-ms-qps-transmission-time",subscribed:"x-ms-qps-subscribed"},$g=function(){function e(t){this._config=t,this._consecutiveErrors=0}return e.prototype.ping=function(t,r){this._submitData(t,r,"ping")},e.prototype.post=function(t,r){this._submitData([t],r,"post")},e.prototype._submitData=function(t,r,n){var i=this,a=JSON.stringify(t),s=(u={},u[jg.disableCollectionRequestOption]=!0,u.host=this._config.quickPulseHost,u.method=Xa.method,u.path="/QuickPulseService.svc/"+n+"?ikey="+this._config.instrumentationKey,u.headers=(c={Expect:"100-continue"},c[Xa.time]=Fg.getTransmissionTime(),c["Content-Type"]="application/json",c["Content-Length"]=Buffer.byteLength(a),c),u);this._config.httpsAgent?s.agent=this._config.httpsAgent:s.agent=Ug.tlsRestrictedAgent;var o=Hg.request(s,function(l){var f=l.headers[Xa.subscribed]==="true";i._consecutiveErrors=0,r(f,l)});o.on("error",function(l){i._consecutiveErrors++;var f="Transient error connecting to the Live Metrics endpoint. This packet will not appear in your Live Metrics Stream. Error:";i._consecutiveErrors%e.MAX_QPS_FAILURES_BEFORE_WARN===0?(f="Live Metrics endpoint could not be reached "+i._consecutiveErrors+" consecutive times. Most recent error:",yl.warn(e.TAG,f,l)):yl.info(e.TAG,f,l),r()}),o.write(a),o.end();var u,c},e.TAG="QuickPulseSender",e.MAX_QPS_FAILURES_BEFORE_WARN=25,e}();El.exports=$g});var Il=p((DE,Tl)=>{"use strict";var Vg=B(),Bg=Mn(),Ka=gl(),Gg=Cl(),zg=Ve(),Qg=Sr(),Xg=function(){function e(t,r){this._isCollectingData=!1,this._lastSuccessTime=Date.now(),this._lastSendSucceeded=!0,this._metrics={},this._documents=[],this._collectors=[],this.config=new Bg(t),this.context=r||new Qg,this._sender=new Gg(this.config),this._isEnabled=!1}return e.prototype.addCollector=function(t){this._collectors.push(t)},e.prototype.trackMetric=function(t){this._addMetric(t)},e.prototype.addDocument=function(t){var r=Ka.telemetryEnvelopeToQuickPulseDocument(t);r&&this._documents.push(r)},e.prototype.enable=function(t){t&&!this._isEnabled?(this._isEnabled=!0,this._goQuickPulse()):!t&&this._isEnabled&&(this._isEnabled=!1,clearTimeout(this._handle),this._handle=void 0)},e.prototype.enableCollectors=function(t){this._collectors.forEach(function(r){r.enable(t)})},e.prototype._addMetric=function(t){var r=t.value,n=t.count||1,i=zg.PerformanceToQuickPulseCounter[t.name];i&&(this._metrics[i]?(this._metrics[i].Value=(this._metrics[i].Value*this._metrics[i].Weight+r*n)/(this._metrics[i].Weight+n),this._metrics[i].Weight+=n):(this._metrics[i]=Ka.createQuickPulseMetric(t),this._metrics[i].Name=i,this._metrics[i].Weight=1))},e.prototype._resetQuickPulseBuffer=function(){delete this._metrics,this._metrics={},this._documents.length=0},e.prototype._goQuickPulse=function(){var t=this,r=Object.keys(this._metrics).map(function(a){return t._metrics[a]}),n=Ka.createQuickPulseEnvelope(r,this._documents.slice(),this.config,this.context);this._resetQuickPulseBuffer(),this._isCollectingData?this._post(n):this._ping(n);var i=this._isCollectingData?e.POST_INTERVAL:e.PING_INTERVAL;this._isCollectingData&&Date.now()-this._lastSuccessTime>=e.MAX_POST_WAIT_TIME&&!this._lastSendSucceeded?(this._isCollectingData=!1,i=e.FALLBACK_INTERVAL):!this._isCollectingData&&Date.now()-this._lastSuccessTime>=e.MAX_PING_WAIT_TIME&&!this._lastSendSucceeded&&(i=e.FALLBACK_INTERVAL),this._lastSendSucceeded=null,this._handle=setTimeout(this._goQuickPulse.bind(this),i),this._handle.unref()},e.prototype._ping=function(t){this._sender.ping(t,this._quickPulseDone.bind(this))},e.prototype._post=function(t){this._sender.post(t,this._quickPulseDone.bind(this))},e.prototype._quickPulseDone=function(t,r){t!=null?(this._isCollectingData!==t&&(Vg.info("Live Metrics sending data",t),this.enableCollectors(t)),this._isCollectingData=t,r&&r.statusCode<300&&r.statusCode>=200?(this._lastSuccessTime=Date.now(),this._lastSendSucceeded=!0):this._lastSendSucceeded=!1):this._lastSendSucceeded=!1},e.MAX_POST_WAIT_TIME=2e4,e.MAX_PING_WAIT_TIME=6e4,e.FALLBACK_INTERVAL=6e4,e.PING_INTERVAL=5e3,e.POST_INTERVAL=1e3,e}();Tl.exports=Xg});var xl=p(Rr=>{"use strict";var Kg=Rr&&Rr.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e};Object.defineProperty(Rr,"__esModule",{value:!0});var bl=Mn(),Dr=Sr(),Wg=B(),Yg=function(){function e(t){this._disabledMetrics={},e.INSTANCE&&e.INSTANCE.dispose(),e.INSTANCE=this,this._client=t}return e.isNodeVersionCompatible=function(){var t=process.versions.node.split(".");return parseInt(t[0])>=6},e.prototype.enable=function(t,r,n){var i=this;if(r===void 0&&(r={}),n===void 0&&(n=6e4),!!e.isNodeVersionCompatible()){if(e._metricsAvailable==null&&t&&!this._isInitialized)try{var a=require("applicationinsights-native-metrics");e._emitter=new a,e._metricsAvailable=!0,Wg.info("Native metrics module successfully loaded!")}catch{e._metricsAvailable=!1;return}this._isEnabled=t,this._disabledMetrics=r,this._isEnabled&&!this._isInitialized&&(this._isInitialized=!0),this._isEnabled&&e._emitter?(e._emitter.enable(!0,n),this._handle=setInterval(function(){return i._trackNativeMetrics()},n),this._handle.unref()):e._emitter&&(e._emitter.enable(!1),this._handle&&(clearInterval(this._handle),this._handle=void 0))}},e.prototype.dispose=function(){this.enable(!1)},e.parseEnabled=function(t){var r=process.env[bl.ENV_nativeMetricsDisableAll],n=process.env[bl.ENV_nativeMetricsDisablers];if(r)return{isEnabled:!1,disabledMetrics:{}};if(n){var i=n.split(","),a={};if(i.length>0)for(var s=0,o=i;s<o.length;s++){var u=o[s];a[u]=!0}return typeof t=="object"?{isEnabled:!0,disabledMetrics:Kg({},t,a)}:{isEnabled:t,disabledMetrics:a}}return typeof t=="boolean"?{isEnabled:t,disabledMetrics:{}}:{isEnabled:!0,disabledMetrics:t}},e.prototype._trackNativeMetrics=function(){var t=!0;typeof this._isEnabled!="object"&&(t=this._isEnabled),t&&(this._trackGarbageCollection(),this._trackEventLoop(),this._trackHeapUsage())},e.prototype._trackGarbageCollection=function(){if(!this._disabledMetrics.gc){var t=e._emitter.getGCData();for(var r in t){var n=t[r].metrics,i=r+" Garbage Collection Duration",a=Math.sqrt(n.sumSquares/n.count-Math.pow(n.total/n.count,2))||0;this._client.trackMetric({name:i,value:n.total,count:n.count,max:n.max,min:n.min,stdDev:a,tagOverrides:(s={},s[this._client.context.keys.internalSdkVersion]="node-nativeperf:"+Dr.sdkVersion,s)})}var s}},e.prototype._trackEventLoop=function(){if(!this._disabledMetrics.loop){var t=e._emitter.getLoopData(),r=t.loopUsage;if(r.count!=0){var n="Event Loop CPU Time",i=Math.sqrt(r.sumSquares/r.count-Math.pow(r.total/r.count,2))||0;this._client.trackMetric({name:n,value:r.total,count:r.count,min:r.min,max:r.max,stdDev:i,tagOverrides:(a={},a[this._client.context.keys.internalSdkVersion]="node-nativeperf:"+Dr.sdkVersion,a)});var a}}},e.prototype._trackHeapUsage=function(){if(!this._disabledMetrics.heap){var t=process.memoryUsage(),r=t.heapUsed,n=t.heapTotal,i=t.rss;this._client.trackMetric({name:"Memory Usage (Heap)",value:r,count:1,tagOverrides:(a={},a[this._client.context.keys.internalSdkVersion]="node-nativeperf:"+Dr.sdkVersion,a)}),this._client.trackMetric({name:"Memory Total (Heap)",value:n,count:1,tagOverrides:(s={},s[this._client.context.keys.internalSdkVersion]="node-nativeperf:"+Dr.sdkVersion,s)}),this._client.trackMetric({name:"Memory Usage (Non-Heap)",value:i-n,count:1,tagOverrides:(o={},o[this._client.context.keys.internalSdkVersion]="node-nativeperf:"+Dr.sdkVersion,o)});var a,s,o}},e}();Rr.AutoCollectNativePerformance=Yg});var Al=p((PE,wl)=>{"use strict";var Sl=B(),Jg=function(){function e(t,r,n,i){this._buffer=[],this._lastSend=0,this._isDisabled=t,this._getBatchSize=r,this._getBatchIntervalMs=n,this._sender=i}return e.prototype.setUseDiskRetryCaching=function(t,r,n){this._sender.setDiskRetryMode(t,r,n)},e.prototype.send=function(t){var r=this;if(!this._isDisabled()){if(!t){Sl.warn("Cannot send null/undefined telemetry");return}var n=this._stringify(t);if(typeof n=="string"){if(this._buffer.push(n),this._buffer.length>=this._getBatchSize()){this.triggerSend(!1);return}!this._timeoutHandle&&this._buffer.length>0&&(this._timeoutHandle=setTimeout(function(){r._timeoutHandle=null,r.triggerSend(!1)},this._getBatchIntervalMs()))}}},e.prototype.triggerSend=function(t,r){var n=this._buffer.length<1;if(!n){var i=this._buffer.join(`
`);t?(this._sender.saveOnCrash(i),typeof r=="function"&&r("data saved on crash")):this._sender.send(Buffer.from?Buffer.from(i):new Buffer(i),r)}this._lastSend=+new Date,this._buffer.length=0,clearTimeout(this._timeoutHandle),this._timeoutHandle=null,n&&typeof r=="function"&&r("no data to send")},e.prototype._stringify=function(t){try{return JSON.stringify(t)}catch(r){Sl.warn("Failed to serialize payload",r,t)}},e}();wl.exports=Jg});var Dl=p(Wa=>{"use strict";Object.defineProperty(Wa,"__esModule",{value:!0});function Zg(e,t){process.env.WEBSITE_SITE_NAME&&(e.tags[t.keys.cloudRole]=process.env.WEBSITE_SITE_NAME)}Wa.azureRoleEnvironmentTelemetryProcessor=Zg});var ql=p(Hn=>{"use strict";Object.defineProperty(Hn,"__esModule",{value:!0});var Rl=ae();function e_(e,t){var r=e.sampleRate,n=!1;return r==null||r>=100||e.data&&Rl.TelemetryType.Metric===Rl.baseTypeToTelemetryType(e.data.baseType)?!0:(t.correlationContext&&t.correlationContext.operation?n=Pl(t.correlationContext.operation.id)<r:n=Math.random()*100<r,n)}Hn.samplingTelemetryProcessor=e_;function Pl(e){var t=-2147483648,r=2147483647,n=5381;if(!e)return 0;for(;e.length<8;)e=e+e;for(var i=0;i<e.length;i++)n=((n<<5)+n|0)+e.charCodeAt(i)|0;return n=n<=t?r:Math.abs(n),n/r*100}Hn.getSamplingHashCode=Pl});var Ol=p(Za=>{"use strict";Object.defineProperty(Za,"__esModule",{value:!0});var Ya=Nn(),Ja=ae();function t_(e,t){switch(t&&t.addDocument(e),e.data.baseType){case Ja.TelemetryTypeString.Exception:Ya.countException();break;case Ja.TelemetryTypeString.Request:var r=e.data.baseData;Ya.countRequest(r.duration,r.success);break;case Ja.TelemetryTypeString.Dependency:var n=e.data.baseData;Ya.countDependency(n.duration,n.success);break}return!0}Za.performanceMetricsTelemetryProcessor=t_});var kl=p(jn=>{"use strict";function es(e){for(var t in e)jn.hasOwnProperty(t)||(jn[t]=e[t])}Object.defineProperty(jn,"__esModule",{value:!0});es(Dl());es(ql());es(Ol())});var Ll=p((LE,Nl)=>{"use strict";var re=require("fs"),Fn=require("os"),Ne=require("path"),r_=require("zlib"),Vt=require("child_process"),Z=B(),n_=$t(),i_=ue(),a_=function(){function e(t,r,n){if(this._config=t,this._onSuccess=r,this._onError=n,this._enableDiskRetryMode=!1,this._resendInterval=e.WAIT_BETWEEN_RESEND,this._maxBytesOnDisk=e.MAX_BYTES_ON_DISK,this._numConsecutiveFailures=0,this._resendTimer=null,!e.OS_PROVIDES_FILE_PROTECTION)if(e.USE_ICACLS){try{e.OS_PROVIDES_FILE_PROTECTION=re.existsSync(e.ICACLS_PATH)}catch{}e.OS_PROVIDES_FILE_PROTECTION||Z.warn(e.TAG,"Could not find ICACLS in expected location! This is necessary to use disk retry mode on Windows.")}else e.OS_PROVIDES_FILE_PROTECTION=!0}return e.prototype.setDiskRetryMode=function(t,r,n){this._enableDiskRetryMode=e.OS_PROVIDES_FILE_PROTECTION&&t,typeof r=="number"&&r>=0&&(this._resendInterval=Math.floor(r)),typeof n=="number"&&n>=0&&(this._maxBytesOnDisk=Math.floor(n)),t&&!e.OS_PROVIDES_FILE_PROTECTION&&(this._enableDiskRetryMode=!1,Z.warn(e.TAG,"Ignoring request to enable disk retry mode. Sufficient file protection capabilities were not detected."))},e.prototype.send=function(t,r){var n=this,i=this._config.endpointUrl,a={method:"POST",withCredentials:!1,headers:{"Content-Type":"application/x-json-stream"}};r_.gzip(t,function(s,o){var u=o;s?(Z.warn(s),u=t,a.headers["Content-Length"]=t.length.toString()):(a.headers["Content-Encoding"]="gzip",a.headers["Content-Length"]=o.length),Z.info(e.TAG,a),a[n_.disableCollectionRequestOption]=!0;var c=function(f){f.setEncoding("utf-8");var d="";f.on("data",function(g){d+=g}),f.on("end",function(){n._numConsecutiveFailures=0,Z.info(e.TAG,d),typeof n._onSuccess=="function"&&n._onSuccess(d),typeof r=="function"&&r(d),n._enableDiskRetryMode&&(f.statusCode===200?n._resendTimer||(n._resendTimer=setTimeout(function(){n._resendTimer=null,n._sendFirstFileOnDisk()},n._resendInterval),n._resendTimer.unref()):(f.statusCode===408||f.statusCode===429||f.statusCode===439||f.statusCode===500||f.statusCode===503)&&n._storeToDisk(t))})},l=i_.makeRequest(n._config,i,a,c);l.on("error",function(f){if(n._numConsecutiveFailures++,!n._enableDiskRetryMode||n._numConsecutiveFailures>0&&n._numConsecutiveFailures%e.MAX_CONNECTION_FAILURES_BEFORE_WARN===0){var d="Ingestion endpoint could not be reached. This batch of telemetry items has been lost. Use Disk Retry Caching to enable resending of failed telemetry. Error:";n._enableDiskRetryMode&&(d="Ingestion endpoint could not be reached "+n._numConsecutiveFailures+" consecutive times. There may be resulting telemetry loss. Most recent error:"),Z.warn(e.TAG,d,f)}else{var d="Transient failure to reach ingestion endpoint. This batch of telemetry items will be retried. Error:";Z.info(e.TAG,d,f)}if(n._onErrorHelper(f),typeof r=="function"){var g="error sending telemetry";f&&typeof f.toString=="function"&&(g=f.toString()),r(g)}n._enableDiskRetryMode&&n._storeToDisk(t)}),l.write(u),l.end()})},e.prototype.saveOnCrash=function(t){this._enableDiskRetryMode&&this._storeToDiskSync(t)},e.prototype._runICACLS=function(t,r){var n=Vt.spawn(e.ICACLS_PATH,t,{windowsHide:!0});n.on("error",function(i){return r(i)}),n.on("close",function(i,a){return r(i===0?null:new Error("Setting ACL restrictions did not succeed (ICACLS returned code "+i+")"))})},e.prototype._runICACLSSync=function(t){if(Vt.spawnSync){var r=Vt.spawnSync(e.ICACLS_PATH,t,{windowsHide:!0});if(r.error)throw r.error;if(r.status!==0)throw new Error("Setting ACL restrictions did not succeed (ICACLS returned code "+r.status+")")}else throw new Error("Could not synchronously call ICACLS under current version of Node.js")},e.prototype._getACLIdentity=function(t){if(e.ACL_IDENTITY)return t(null,e.ACL_IDENTITY);var r=Vt.spawn(e.POWERSHELL_PATH,["-Command","[System.Security.Principal.WindowsIdentity]::GetCurrent().Name"],{windowsHide:!0,stdio:["ignore","pipe","pipe"]}),n="";r.stdout.on("data",function(i){return n+=i}),r.on("error",function(i){return t(i,null)}),r.on("close",function(i,a){return e.ACL_IDENTITY=n&&n.trim(),t(i===0?null:new Error("Getting ACL identity did not succeed (PS returned code "+i+")"),e.ACL_IDENTITY)})},e.prototype._getACLIdentitySync=function(){if(e.ACL_IDENTITY)return e.ACL_IDENTITY;if(Vt.spawnSync){var t=Vt.spawnSync(e.POWERSHELL_PATH,["-Command","[System.Security.Principal.WindowsIdentity]::GetCurrent().Name"],{windowsHide:!0,stdio:["ignore","pipe","pipe"]});if(t.error)throw t.error;if(t.status!==0)throw new Error("Getting ACL identity did not succeed (PS returned code "+t.status+")");return e.ACL_IDENTITY=t.stdout&&t.stdout.toString().trim(),e.ACL_IDENTITY}else throw new Error("Could not synchronously get ACL identity under current version of Node.js")},e.prototype._getACLArguments=function(t,r){return[t,"/grant","*S-1-5-32-544:(OI)(CI)F","/grant",r+":(OI)(CI)F","/inheritance:r"]},e.prototype._applyACLRules=function(t,r){var n=this;if(!e.USE_ICACLS)return r(null);if(e.ACLED_DIRECTORIES[t]===void 0)e.ACLED_DIRECTORIES[t]=!1,this._getACLIdentity(function(i,a){if(i)return e.ACLED_DIRECTORIES[t]=!1,r(i);n._runICACLS(n._getACLArguments(t,a),function(s){return e.ACLED_DIRECTORIES[t]=!s,r(s)})});else return r(e.ACLED_DIRECTORIES[t]?null:new Error("Setting ACL restrictions did not succeed (cached result)"))},e.prototype._applyACLRulesSync=function(t){if(e.USE_ICACLS){if(e.ACLED_DIRECTORIES[t]===void 0){this._runICACLSSync(this._getACLArguments(t,this._getACLIdentitySync())),e.ACLED_DIRECTORIES[t]=!0;return}else if(!e.ACLED_DIRECTORIES[t])throw new Error("Setting ACL restrictions did not succeed (cached result)")}},e.prototype._confirmDirExists=function(t,r){var n=this;re.lstat(t,function(i,a){i&&i.code==="ENOENT"?re.mkdir(t,function(s){s&&s.code!=="EEXIST"?r(s):n._applyACLRules(t,r)}):!i&&a.isDirectory()?n._applyACLRules(t,r):r(i||new Error("Path existed but was not a directory"))})},e.prototype._getShallowDirectorySize=function(t,r){re.readdir(t,function(n,i){if(n)return r(n,-1);var a=null,s=0,o=0;if(i.length===0){r(null,0);return}for(var u=0;u<i.length;u++)re.stat(Ne.join(t,i[u]),function(c,l){o++,c?a=c:l.isFile()&&(s+=l.size),o===i.length&&(a?r(a,-1):r(a,s))})})},e.prototype._getShallowDirectorySizeSync=function(t){for(var r=re.readdirSync(t),n=0,i=0;i<r.length;i++)n+=re.statSync(Ne.join(t,r[i])).size;return n},e.prototype._storeToDisk=function(t){var r=this,n=Ne.join(Fn.tmpdir(),e.TEMPDIR_PREFIX+this._config.instrumentationKey);Z.info(e.TAG,"Checking existence of data storage directory: "+n),this._confirmDirExists(n,function(i){if(i){Z.warn(e.TAG,"Error while checking/creating directory: "+(i&&i.message)),r._onErrorHelper(i);return}r._getShallowDirectorySize(n,function(a,s){if(a||s<0){Z.warn(e.TAG,"Error while checking directory size: "+(a&&a.message)),r._onErrorHelper(a);return}else if(s>r._maxBytesOnDisk){Z.warn(e.TAG,"Not saving data due to max size limit being met. Directory size in bytes is: "+s);return}var o=new Date().getTime()+".ai.json",u=Ne.join(n,o);Z.info(e.TAG,"saving data to disk at: "+u),re.writeFile(u,t,{mode:384},function(c){return r._onErrorHelper(c)})})})},e.prototype._storeToDiskSync=function(t){var r=Ne.join(Fn.tmpdir(),e.TEMPDIR_PREFIX+this._config.instrumentationKey);try{Z.info(e.TAG,"Checking existence of data storage directory: "+r),re.existsSync(r)||re.mkdirSync(r),this._applyACLRulesSync(r);var n=this._getShallowDirectorySizeSync(r);if(n>this._maxBytesOnDisk){Z.info(e.TAG,"Not saving data due to max size limit being met. Directory size in bytes is: "+n);return}var i=new Date().getTime()+".ai.json",a=Ne.join(r,i);Z.info(e.TAG,"saving data before crash to disk at: "+a),re.writeFileSync(a,t,{mode:384})}catch(s){Z.warn(e.TAG,"Error while saving data to disk: "+(s&&s.message)),this._onErrorHelper(s)}},e.prototype._sendFirstFileOnDisk=function(){var t=this,r=Ne.join(Fn.tmpdir(),e.TEMPDIR_PREFIX+this._config.instrumentationKey);re.exists(r,function(n){n&&re.readdir(r,function(i,a){if(i)t._onErrorHelper(i);else if(a=a.filter(function(u){return Ne.basename(u).indexOf(".ai.json")>-1}),a.length>0){var s=a[0],o=Ne.join(r,s);re.readFile(o,function(u,c){u?t._onErrorHelper(u):re.unlink(o,function(l){l?t._onErrorHelper(l):t.send(c)})})}})})},e.prototype._onErrorHelper=function(t){typeof this._onError=="function"&&this._onError(t)},e.TAG="Sender",e.ICACLS_PATH=process.env.systemdrive+"/windows/system32/icacls.exe",e.POWERSHELL_PATH=process.env.systemdrive+"/windows/system32/windowspowershell/v1.0/powershell.exe",e.ACLED_DIRECTORIES={},e.ACL_IDENTITY=null,e.WAIT_BETWEEN_RESEND=60*1e3,e.MAX_BYTES_ON_DISK=50*1e3*1e3,e.MAX_CONNECTION_FAILURES_BEFORE_WARN=5,e.TEMPDIR_PREFIX="appInsights-node",e.OS_PROVIDES_FILE_PROTECTION=!1,e.USE_ICACLS=Fn.type()==="Windows_NT",e}();Nl.exports=a_});var jl=p((ME,Hl)=>{"use strict";var y=ae(),he=ue(),s_=Xe(),o_=function(){function e(){}return e.createEnvelope=function(t,r,n,i,a){var s=null;switch(r){case y.TelemetryType.Trace:s=e.createTraceData(t);break;case y.TelemetryType.Dependency:s=e.createDependencyData(t);break;case y.TelemetryType.Event:s=e.createEventData(t);break;case y.TelemetryType.Exception:s=e.createExceptionData(t);break;case y.TelemetryType.Request:s=e.createRequestData(t);break;case y.TelemetryType.Metric:s=e.createMetricData(t);break;case y.TelemetryType.Availability:s=e.createAvailabilityData(t);break;case y.TelemetryType.PageView:s=e.createPageViewData(t);break}if(n&&y.domainSupportsProperties(s.baseData)){if(s&&s.baseData)if(!s.baseData.properties)s.baseData.properties=n;else for(var o in n)s.baseData.properties[o]||(s.baseData.properties[o]=n[o]);s.baseData.properties=he.validateStringMap(s.baseData.properties)}var u=a&&a.instrumentationKey||"",c=new y.Envelope;return c.data=s,c.iKey=u,c.name="Microsoft.ApplicationInsights."+u.replace(/-/g,"")+"."+s.baseType.substr(0,s.baseType.length-4),c.tags=this.getTags(i,t.tagOverrides),c.time=new Date().toISOString(),c.ver=1,c.sampleRate=a?a.samplingPercentage:100,r===y.TelemetryType.Metric&&(c.sampleRate=100),c},e.createTraceData=function(t){var r=new y.MessageData;r.message=t.message,r.properties=t.properties,isNaN(t.severity)?r.severityLevel=y.SeverityLevel.Information:r.severityLevel=t.severity;var n=new y.Data;return n.baseType=y.telemetryTypeToBaseType(y.TelemetryType.Trace),n.baseData=r,n},e.createDependencyData=function(t){var r=new y.RemoteDependencyData;typeof t.name=="string"&&(r.name=t.name.length>1024?t.name.slice(0,1021)+"...":t.name),r.data=t.data,r.target=t.target,r.duration=he.msToTimeSpan(t.duration),r.success=t.success,r.type=t.dependencyTypeName,r.properties=t.properties,r.resultCode=t.resultCode?t.resultCode+"":"",t.id?r.id=t.id:r.id=he.w3cTraceId();var n=new y.Data;return n.baseType=y.telemetryTypeToBaseType(y.TelemetryType.Dependency),n.baseData=r,n},e.createEventData=function(t){var r=new y.EventData;r.name=t.name,r.properties=t.properties,r.measurements=t.measurements;var n=new y.Data;return n.baseType=y.telemetryTypeToBaseType(y.TelemetryType.Event),n.baseData=r,n},e.createExceptionData=function(t){var r=new y.ExceptionData;r.properties=t.properties,isNaN(t.severity)?r.severityLevel=y.SeverityLevel.Error:r.severityLevel=t.severity,r.measurements=t.measurements,r.exceptions=[];var n=t.exception.stack,i=new y.ExceptionDetails;i.message=t.exception.message,i.typeName=t.exception.name,i.parsedStack=this.parseStack(n),i.hasFullStack=he.isArray(i.parsedStack)&&i.parsedStack.length>0,r.exceptions.push(i);var a=new y.Data;return a.baseType=y.telemetryTypeToBaseType(y.TelemetryType.Exception),a.baseData=r,a},e.createRequestData=function(t){var r=new y.RequestData;t.id?r.id=t.id:r.id=he.w3cTraceId(),r.name=t.name,r.url=t.url,r.source=t.source,r.duration=he.msToTimeSpan(t.duration),r.responseCode=t.resultCode?t.resultCode+"":"",r.success=t.success,r.properties=t.properties;var n=new y.Data;return n.baseType=y.telemetryTypeToBaseType(y.TelemetryType.Request),n.baseData=r,n},e.createMetricData=function(t){var r=new y.MetricData;r.metrics=[];var n=new y.DataPoint;n.count=isNaN(t.count)?1:t.count,n.kind=y.DataPointType.Aggregation,n.max=isNaN(t.max)?t.value:t.max,n.min=isNaN(t.min)?t.value:t.min,n.name=t.name,n.stdDev=isNaN(t.stdDev)?0:t.stdDev,n.value=t.value,r.metrics.push(n),r.properties=t.properties;var i=new y.Data;return i.baseType=y.telemetryTypeToBaseType(y.TelemetryType.Metric),i.baseData=r,i},e.createAvailabilityData=function(t){var r=new y.AvailabilityData;t.id?r.id=t.id:r.id=he.w3cTraceId(),r.name=t.name,r.duration=he.msToTimeSpan(t.duration),r.success=t.success,r.runLocation=t.runLocation,r.message=t.message,r.measurements=t.measurements,r.properties=t.properties;var n=new y.Data;return n.baseType=y.telemetryTypeToBaseType(y.TelemetryType.Availability),n.baseData=r,n},e.createPageViewData=function(t){var r=new y.PageViewData;r.name=t.name,r.duration=he.msToTimeSpan(t.duration),r.url=t.url,r.measurements=t.measurements,r.properties=t.properties;var n=new y.Data;return n.baseType=y.telemetryTypeToBaseType(y.TelemetryType.PageView),n.baseData=r,n},e.getTags=function(t,r){var n=s_.CorrelationContextManager.getCurrentContext(),i={};if(t&&t.tags)for(var a in t.tags)i[a]=t.tags[a];if(r)for(var a in r)i[a]=r[a];return n&&(i[t.keys.operationId]=i[t.keys.operationId]||n.operation.id,i[t.keys.operationName]=i[t.keys.operationName]||n.operation.name,i[t.keys.operationParentId]=i[t.keys.operationParentId]||n.operation.parentId),i},e.parseStack=function(t){var r=void 0;if(typeof t=="string"){var n=t.split(`
`);r=[];for(var i=0,a=0,s=0;s<=n.length;s++){var o=n[s];if(Ml.regex.test(o)){var u=new Ml(n[s],i++);a+=u.sizeInBytes,r.push(u)}}var c=32*1024;if(a>c)for(var l=0,f=r.length-1,d=0,g=l,_=f;l<f;){var T=r[l].sizeInBytes,k=r[f].sizeInBytes;if(d+=T+k,d>c){var q=_-g+1;r.splice(g,q);break}g=l,_=f,l++,f--}}return r},e}(),Ml=function(){function e(t,r){this.sizeInBytes=0,this.level=r,this.method="<no_method>",this.assembly=he.trim(t);var n=t.match(e.regex);n&&n.length>=5&&(this.method=he.trim(n[2])||this.method,this.fileName=he.trim(n[4])||"<no_filename>",this.line=parseInt(n[5])||0),this.sizeInBytes+=this.method.length,this.sizeInBytes+=this.fileName.length,this.sizeInBytes+=this.assembly.length,this.sizeInBytes+=e.baseSize,this.sizeInBytes+=this.level.toString().length,this.sizeInBytes+=this.line.toString().length}return e.regex=/^(\s+at)?(.*?)(\@|\s\(|\s)([^\(\n]+):(\d+):(\d+)(\)?)$/,e.baseSize=58,e}();Hl.exports=o_});var Vl=p((HE,$l)=>{"use strict";var u_=require("url"),c_=Mn(),l_=Sr(),Le=ae(),f_=Al(),ts=kl(),Fl=Xe(),p_=Ll(),d_=ue(),Ul=B(),h_=jl(),v_=function(){function e(t){this._telemetryProcessors=[],this._enableAzureProperties=!1;var r=new c_(t);this.config=r,this.context=new l_,this.commonProperties={};var n=new p_(this.config);this.channel=new f_(function(){return r.disableAppInsights},function(){return r.maxBatchSize},function(){return r.maxBatchIntervalMs},n)}return e.prototype.trackAvailability=function(t){this.track(t,Le.TelemetryType.Availability)},e.prototype.trackPageView=function(t){this.track(t,Le.TelemetryType.PageView)},e.prototype.trackTrace=function(t){this.track(t,Le.TelemetryType.Trace)},e.prototype.trackMetric=function(t){this.track(t,Le.TelemetryType.Metric)},e.prototype.trackException=function(t){t&&t.exception&&!d_.isError(t.exception)&&(t.exception=new Error(t.exception.toString())),this.track(t,Le.TelemetryType.Exception)},e.prototype.trackEvent=function(t){this.track(t,Le.TelemetryType.Event)},e.prototype.trackRequest=function(t){this.track(t,Le.TelemetryType.Request)},e.prototype.trackDependency=function(t){t&&!t.target&&t.data&&(t.target=u_.parse(t.data).host),this.track(t,Le.TelemetryType.Dependency)},e.prototype.flush=function(t){this.channel.triggerSend(t?!!t.isAppCrashing:!1,t?t.callback:void 0)},e.prototype.track=function(t,r){if(t&&Le.telemetryTypeToBaseType(r)){var n=h_.createEnvelope(t,r,this.commonProperties,this.context,this.config);t.time&&(n.time=t.time.toISOString()),this._enableAzureProperties&&ts.azureRoleEnvironmentTelemetryProcessor(n,this.context);var i=this.runTelemetryProcessors(n,t.contextObjects);i=i&&ts.samplingTelemetryProcessor(n,{correlationContext:Fl.CorrelationContextManager.getCurrentContext()}),i&&(ts.performanceMetricsTelemetryProcessor(n,this.quickPulseClient),this.channel.send(n))}else Ul.warn("track() requires telemetry object and telemetryType to be specified.")},e.prototype.setAutoPopulateAzureProperties=function(t){this._enableAzureProperties=t},e.prototype.addTelemetryProcessor=function(t){this._telemetryProcessors.push(t)},e.prototype.clearTelemetryProcessors=function(){this._telemetryProcessors=[]},e.prototype.runTelemetryProcessors=function(t,r){var n=!0,i=this._telemetryProcessors.length;if(i===0)return n;r=r||{},r.correlationContext=Fl.CorrelationContextManager.getCurrentContext();for(var a=0;a<i;++a)try{var s=this._telemetryProcessors[a];if(s&&s.apply(null,[t,r])===!1){n=!1;break}}catch(o){n=!0,Ul.warn("One of telemetry processors failed, telemetry item will be sent.",o,t)}return n},e}();$l.exports=v_});var zl=p((rs,Gl)=>{"use strict";var g_=rs&&rs.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])};return function(t,r){e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),__=Vl(),Bl=Ba(),m_=$t(),Un=B(),y_=function(e){g_(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.trackNodeHttpRequestSync=function(r){r&&r.request&&r.response&&r.duration?Bl.trackRequestSync(this,r):Un.warn("trackNodeHttpRequestSync requires NodeHttpRequestTelemetry object with request, response and duration specified.")},t.prototype.trackNodeHttpRequest=function(r){(r.duration||r.error)&&Un.warn("trackNodeHttpRequest will ignore supplied duration and error parameters. These values are collected from the request and response objects."),r&&r.request&&r.response?Bl.trackRequest(this,r):Un.warn("trackNodeHttpRequest requires NodeHttpRequestTelemetry object with request and response specified.")},t.prototype.trackNodeHttpDependency=function(r){r&&r.request?m_.trackRequest(this,r):Un.warn("trackNodeHttpDependency requires NodeHttpDependencyTelemetry object with request specified.")},t}(__);Gl.exports=y_});var Xl=p(Ql=>{"use strict";Object.defineProperty(Ql,"__esModule",{value:!0})});var vf=p(m=>{"use strict";Object.defineProperty(m,"__esModule",{value:!0});var ns=Xe(),E_=Ac(),C_=Rc(),Wl=Nn(),T_=rl(),I_=$t(),b_=Ba(),Yl=et(),Pr=B(),x_=Il(),Jl=xl();m.TelemetryClient=zl();m.Contracts=ae();m.azureFunctionsTypes=Xl();var Zl;(function(e){e[e.AI=0]="AI",e[e.AI_AND_W3C=1]="AI_AND_W3C"})(Zl=m.DistributedTracingModes||(m.DistributedTracingModes={}));var ef=!0,tf=!1,rf=!0,nf=!0,af=!1,sf=!0,of=!0,uf=!0,is=!0,cf,$n=!1,lf=!0,ff,pf=void 0,df=void 0,qr,Or,kr,Nr,Bt,ft,Lr,Me=!1,Kl;function S_(e){return m.defaultClient?Pr.info("The default client is already setup"):(m.defaultClient=new m.TelemetryClient(e),qr=new E_(m.defaultClient),Or=new C_(m.defaultClient),kr=new Wl(m.defaultClient),Nr=new T_(m.defaultClient),ft=new b_(m.defaultClient),Lr=new I_(m.defaultClient),Bt||(Bt=new Jl.AutoCollectNativePerformance(m.defaultClient))),m.defaultClient&&m.defaultClient.channel&&m.defaultClient.channel.setUseDiskRetryCaching(uf,pf,df),as}m.setup=S_;function hf(){return m.defaultClient?(Me=!0,qr.enable(ef,tf),Or.enable(rf),kr.enable(nf),Nr.enable(af,m.defaultClient.config),Bt.enable(lf,ff),ft.useAutoCorrelation(is,cf),ft.enable(sf),Lr.enable(of),m.liveMetricsClient&&$n&&m.liveMetricsClient.enable($n)):Pr.warn("Start cannot be called before setup"),as}m.start=hf;function w_(){return is?ns.CorrelationContextManager.getCurrentContext():null}m.getCorrelationContext=w_;function A_(e,t){return ns.CorrelationContextManager.startOperation(e,t)}m.startOperation=A_;function D_(e,t){return ns.CorrelationContextManager.wrapCallback(e,t)}m.wrapWithCorrelationContext=D_;var as=function(){function e(){}return e.setDistributedTracingMode=function(t){return Yl.w3cEnabled=t===Zl.AI_AND_W3C,e},e.setAutoCollectConsole=function(t,r){return r===void 0&&(r=!1),ef=t,tf=r,Me&&qr.enable(t,r),e},e.setAutoCollectExceptions=function(t){return rf=t,Me&&Or.enable(t),e},e.setAutoCollectPerformance=function(t,r){r===void 0&&(r=!0),nf=t;var n=Jl.AutoCollectNativePerformance.parseEnabled(r);return lf=n.isEnabled,ff=n.disabledMetrics,Me&&(kr.enable(t),Bt.enable(n.isEnabled,n.disabledMetrics)),e},e.setAutoCollectHeartbeat=function(t){return af=t,Me&&Nr.enable(t,m.defaultClient.config),e},e.setAutoCollectRequests=function(t){return sf=t,Me&&ft.enable(t),e},e.setAutoCollectDependencies=function(t){return of=t,Me&&Lr.enable(t),e},e.setAutoDependencyCorrelation=function(t,r){return is=t,cf=r,Me&&ft.useAutoCorrelation(t,r),e},e.setUseDiskRetryCaching=function(t,r,n){return uf=t,pf=r,df=n,m.defaultClient&&m.defaultClient.channel&&m.defaultClient.channel.setUseDiskRetryCaching(t,r,n),e},e.setInternalLogging=function(t,r){return t===void 0&&(t=!1),r===void 0&&(r=!0),Pr.enableDebug=t,Pr.disableWarnings=!r,e},e.setSendLiveMetrics=function(t){return t===void 0&&(t=!1),m.defaultClient?(!m.liveMetricsClient&&t?(m.liveMetricsClient=new x_(m.defaultClient.config.instrumentationKey),Kl=new Wl(m.liveMetricsClient,1e3,!0),m.liveMetricsClient.addCollector(Kl),m.defaultClient.quickPulseClient=m.liveMetricsClient):m.liveMetricsClient&&m.liveMetricsClient.enable(t),$n=t,e):(Pr.warn("Live metrics client cannot be setup without the default client"),e)},e.start=hf,e}();m.Configuration=as;function R_(){Yl.w3cEnabled=!0,m.defaultClient=null,Me=!1,qr&&qr.dispose(),Or&&Or.dispose(),kr&&kr.dispose(),Nr&&Nr.dispose(),Bt&&Bt.dispose(),ft&&ft.dispose(),Lr&&Lr.dispose(),m.liveMetricsClient&&(m.liveMetricsClient.enable(!1),$n=!1,m.liveMetricsClient=void 0)}m.dispose=R_});var ss=p((Vn,gf)=>{"use strict";Object.defineProperty(Vn,"__esModule",{value:!0});Vn.default=O_;var P_=q_(require("crypto"));function q_(e){return e&&e.__esModule?e:{default:e}}function O_(){return P_.default.randomBytes(16)}gf.exports=Vn.default});var Bn=p((Hr,mf)=>{"use strict";Object.defineProperty(Hr,"__esModule",{value:!0});Hr.default=void 0;var _f=[];for(Mr=0;Mr<256;++Mr)_f[Mr]=(Mr+256).toString(16).substr(1);var Mr;function k_(e,t){var r=t||0,n=_f;return[n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]]].join("")}var N_=k_;Hr.default=N_;mf.exports=Hr.default});var Tf=p((jr,Cf)=>{"use strict";Object.defineProperty(jr,"__esModule",{value:!0});jr.default=void 0;var L_=Ef(ss()),M_=Ef(Bn());function Ef(e){return e&&e.__esModule?e:{default:e}}var yf,os,us=0,cs=0;function H_(e,t,r){var n=t&&r||0,i=t||[];e=e||{};var a=e.node||yf,s=e.clockseq!==void 0?e.clockseq:os;if(a==null||s==null){var o=e.random||(e.rng||L_.default)();a==null&&(a=yf=[o[0]|1,o[1],o[2],o[3],o[4],o[5]]),s==null&&(s=os=(o[6]<<8|o[7])&16383)}var u=e.msecs!==void 0?e.msecs:new Date().getTime(),c=e.nsecs!==void 0?e.nsecs:cs+1,l=u-us+(c-cs)/1e4;if(l<0&&e.clockseq===void 0&&(s=s+1&16383),(l<0||u>us)&&e.nsecs===void 0&&(c=0),c>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");us=u,cs=c,os=s,u+=122192928e5;var f=((u&268435455)*1e4+c)%4294967296;i[n++]=f>>>24&255,i[n++]=f>>>16&255,i[n++]=f>>>8&255,i[n++]=f&255;var d=u/4294967296*1e4&268435455;i[n++]=d>>>8&255,i[n++]=d&255,i[n++]=d>>>24&15|16,i[n++]=d>>>16&255,i[n++]=s>>>8|128,i[n++]=s&255;for(var g=0;g<6;++g)i[n+g]=a[g];return t||(0,M_.default)(i)}var j_=H_;jr.default=j_;Cf.exports=jr.default});var ls=p(pt=>{"use strict";Object.defineProperty(pt,"__esModule",{value:!0});pt.default=B_;pt.URL=pt.DNS=void 0;var F_=U_(Bn());function U_(e){return e&&e.__esModule?e:{default:e}}function $_(e){var t=[];return e.replace(/[a-fA-F0-9]{2}/g,function(r){t.push(parseInt(r,16))}),t}function V_(e){e=unescape(encodeURIComponent(e));for(var t=new Array(e.length),r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}var If="6ba7b810-9dad-11d1-80b4-00c04fd430c8";pt.DNS=If;var bf="6ba7b811-9dad-11d1-80b4-00c04fd430c8";pt.URL=bf;function B_(e,t,r){var n=function(i,a,s,o){var u=s&&o||0;if(typeof i=="string"&&(i=V_(i)),typeof a=="string"&&(a=$_(a)),!Array.isArray(i))throw TypeError("value must be an array of bytes");if(!Array.isArray(a)||a.length!==16)throw TypeError("namespace must be uuid string or an Array of 16 byte values");var c=r(a.concat(i));if(c[6]=c[6]&15|t,c[8]=c[8]&63|128,s)for(var l=0;l<16;++l)s[u+l]=c[l];return s||(0,F_.default)(c)};try{n.name=e}catch{}return n.DNS=If,n.URL=bf,n}});var Sf=p((Fr,xf)=>{"use strict";Object.defineProperty(Fr,"__esModule",{value:!0});Fr.default=void 0;var G_=z_(require("crypto"));function z_(e){return e&&e.__esModule?e:{default:e}}function Q_(e){return Array.isArray(e)?e=Buffer.from(e):typeof e=="string"&&(e=Buffer.from(e,"utf8")),G_.default.createHash("md5").update(e).digest()}var X_=Q_;Fr.default=X_;xf.exports=Fr.default});var Df=p((Ur,Af)=>{"use strict";Object.defineProperty(Ur,"__esModule",{value:!0});Ur.default=void 0;var K_=wf(ls()),W_=wf(Sf());function wf(e){return e&&e.__esModule?e:{default:e}}var Y_=(0,K_.default)("v3",48,W_.default),J_=Y_;Ur.default=J_;Af.exports=Ur.default});var qf=p(($r,Pf)=>{"use strict";Object.defineProperty($r,"__esModule",{value:!0});$r.default=void 0;var Z_=Rf(ss()),em=Rf(Bn());function Rf(e){return e&&e.__esModule?e:{default:e}}function tm(e,t,r){var n=t&&r||0;typeof e=="string"&&(t=e==="binary"?new Array(16):null,e=null),e=e||{};var i=e.random||(e.rng||Z_.default)();if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,t)for(var a=0;a<16;++a)t[n+a]=i[a];return t||(0,em.default)(i)}var rm=tm;$r.default=rm;Pf.exports=$r.default});var kf=p((Vr,Of)=>{"use strict";Object.defineProperty(Vr,"__esModule",{value:!0});Vr.default=void 0;var nm=im(require("crypto"));function im(e){return e&&e.__esModule?e:{default:e}}function am(e){return Array.isArray(e)?e=Buffer.from(e):typeof e=="string"&&(e=Buffer.from(e,"utf8")),nm.default.createHash("sha1").update(e).digest()}var sm=am;Vr.default=sm;Of.exports=Vr.default});var Mf=p((Br,Lf)=>{"use strict";Object.defineProperty(Br,"__esModule",{value:!0});Br.default=void 0;var om=Nf(ls()),um=Nf(kf());function Nf(e){return e&&e.__esModule?e:{default:e}}var cm=(0,om.default)("v5",80,um.default),lm=cm;Br.default=lm;Lf.exports=Br.default});var Hf=p(Gt=>{"use strict";Object.defineProperty(Gt,"__esModule",{value:!0});Object.defineProperty(Gt,"v1",{enumerable:!0,get:function(){return fm.default}});Object.defineProperty(Gt,"v3",{enumerable:!0,get:function(){return pm.default}});Object.defineProperty(Gt,"v4",{enumerable:!0,get:function(){return dm.default}});Object.defineProperty(Gt,"v5",{enumerable:!0,get:function(){return hm.default}});var fm=Gn(Tf()),pm=Gn(Df()),dm=Gn(qf()),hm=Gn(Mf());function Gn(e){return e&&e.__esModule?e:{default:e}}});var Ff=p((VE,jf)=>{"use strict";function vm(e){for(var t=5381,r=e.length;r;)t=t*33^e.charCodeAt(--r);return t>>>0}jf.exports=vm});var hs=p((n0,Gf)=>{"use strict";var Bf=require("fs"),ds;function ym(){try{return Bf.statSync("/.dockerenv"),!0}catch{return!1}}function Em(){try{return Bf.readFileSync("/proc/self/cgroup","utf8").includes("docker")}catch{return!1}}Gf.exports=()=>(ds===void 0&&(ds=ym()||Em()),ds)});var Xf=p((i0,vs)=>{"use strict";var Cm=require("os"),Tm=require("fs"),zf=hs(),Qf=()=>{if(process.platform!=="linux")return!1;if(Cm.release().toLowerCase().includes("microsoft"))return!zf();try{return Tm.readFileSync("/proc/version","utf8").toLowerCase().includes("microsoft")?!zf():!1}catch{return!1}};process.env.__IS_WSL_TEST__?vs.exports=Qf:vs.exports=Qf()});var Wf=p((a0,Kf)=>{"use strict";Kf.exports=(e,t,r)=>{let n=i=>Object.defineProperty(e,t,{value:i,enumerable:!0,writable:!0});return Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get(){let i=r();return n(i),i},set(i){n(i)}}),e}});var np=p((s0,rp)=>{var Im=require("path"),bm=require("child_process"),{promises:Wn,constants:tp}=require("fs"),Kn=Xf(),xm=hs(),_s=Wf(),Yf=Im.join(__dirname,"xdg-open"),{platform:zt,arch:Jf}=process,Sm=()=>{try{return Wn.statSync("/run/.containerenv"),!0}catch{return!1}},gs;function wm(){return gs===void 0&&(gs=Sm()||xm()),gs}var Am=(()=>{let e="/mnt/",t;return async function(){if(t)return t;let r="/etc/wsl.conf",n=!1;try{await Wn.access(r,tp.F_OK),n=!0}catch{}if(!n)return e;let i=await Wn.readFile(r,{encoding:"utf8"}),a=/(?<!#.*)root\s*=\s*(?<mountPoint>.*)/g.exec(i);return a?(t=a.groups.mountPoint.trim(),t=t.endsWith("/")?t:`${t}/`,t):e}})(),Zf=async(e,t)=>{let r;for(let n of e)try{return await t(n)}catch(i){r=i}throw r},Yn=async e=>{if(e={wait:!1,background:!1,newInstance:!1,allowNonzeroExitCode:!1,...e},Array.isArray(e.app))return Zf(e.app,o=>Yn({...e,app:o}));let{name:t,arguments:r=[]}=e.app||{};if(r=[...r],Array.isArray(t))return Zf(t,o=>Yn({...e,app:{name:o,arguments:r}}));let n,i=[],a={};if(zt==="darwin")n="open",e.wait&&i.push("--wait-apps"),e.background&&i.push("--background"),e.newInstance&&i.push("--new"),t&&i.push("-a",t);else if(zt==="win32"||Kn&&!wm()&&!t){let o=await Am();n=Kn?`${o}c/Windows/System32/WindowsPowerShell/v1.0/powershell.exe`:`${process.env.SYSTEMROOT}\\System32\\WindowsPowerShell\\v1.0\\powershell`,i.push("-NoProfile","-NonInteractive","\u2013ExecutionPolicy","Bypass","-EncodedCommand"),Kn||(a.windowsVerbatimArguments=!0);let u=["Start"];e.wait&&u.push("-Wait"),t?(u.push(`"\`"${t}\`""`,"-ArgumentList"),e.target&&r.unshift(e.target)):e.target&&u.push(`"${e.target}"`),r.length>0&&(r=r.map(c=>`"\`"${c}\`""`),u.push(r.join(","))),e.target=Buffer.from(u.join(" "),"utf16le").toString("base64")}else{if(t)n=t;else{let o=!__dirname||__dirname==="/",u=!1;try{await Wn.access(Yf,tp.X_OK),u=!0}catch{}n=process.versions.electron||zt==="android"||o||!u?"xdg-open":Yf}r.length>0&&i.push(...r),e.wait||(a.stdio="ignore",a.detached=!0)}e.target&&i.push(e.target),zt==="darwin"&&r.length>0&&i.push("--args",...r);let s=bm.spawn(n,i,a);return e.wait?new Promise((o,u)=>{s.once("error",u),s.once("close",c=>{if(!e.allowNonzeroExitCode&&c>0){u(new Error(`Exited with code ${c}`));return}o(s)})}):(s.unref(),s)},ms=(e,t)=>{if(typeof e!="string")throw new TypeError("Expected a `target`");return Yn({...t,target:e})},Dm=(e,t)=>{if(typeof e!="string")throw new TypeError("Expected a `name`");let{arguments:r=[]}=t||{};if(r!=null&&!Array.isArray(r))throw new TypeError("Expected `appArguments` as Array type");return Yn({...t,app:{name:e,arguments:r}})};function ep(e){if(typeof e=="string"||Array.isArray(e))return e;let{[Jf]:t}=e;if(!t)throw new Error(`${Jf} is not supported`);return t}function ys({[zt]:e},{wsl:t}){if(t&&Kn)return ep(t);if(!e)throw new Error(`${zt} is not supported`);return ep(e)}var Jn={};_s(Jn,"chrome",()=>ys({darwin:"google chrome",win32:"chrome",linux:["google-chrome","google-chrome-stable","chromium"]},{wsl:{ia32:"/mnt/c/Program Files (x86)/Google/Chrome/Application/chrome.exe",x64:["/mnt/c/Program Files/Google/Chrome/Application/chrome.exe","/mnt/c/Program Files (x86)/Google/Chrome/Application/chrome.exe"]}}));_s(Jn,"firefox",()=>ys({darwin:"firefox",win32:"C:\\Program Files\\Mozilla Firefox\\firefox.exe",linux:"firefox"},{wsl:"/mnt/c/Program Files/Mozilla Firefox/firefox.exe"}));_s(Jn,"edge",()=>ys({darwin:"microsoft edge",win32:"msedge",linux:["microsoft-edge","microsoft-edge-dev"]},{wsl:"/mnt/c/Program Files (x86)/Microsoft/Edge/Application/msedge.exe"}));ms.apps=Jn;ms.openApp=Dm;rp.exports=ms});var Zn=dt(require("path"));var yp=require("vscode"),Ep=dt(ti());function ri(e){return e.map(t=>String.fromCharCode(t)).join("")}var Ds=require("vscode"),Cp=dt(ti());var Rs=require("fs");var ni=class{constructor(){this.dictionary={};this.locale="en";try{if(process&&process.env){let t=JSON.parse(process.env.VSCODE_NLS_CONFIG);t&&typeof t.locale=="string"&&(this.locale=t.locale)}}catch(t){}}read_i18n(t){try{let r=Buffer.from((0,Rs.readFileSync)(t)).toString("utf-8");return JSON.parse(r)}catch(r){return{}}}localize(t){let r=this.dictionary[t];if(typeof r=="string")return r}load(t){try{this.dictionary=Object.assign({},this.read_i18n(t.asAbsolutePath("package.nls.json")),this.read_i18n(t.asAbsolutePath("package.nls.en.json")),this.read_i18n(t.asAbsolutePath(`package.nls.${this.locale}.json`)))}catch(r){}}},Fm=new ni;var Ps=require("vscode");var Qn=dt(vf()),Uf=require("os"),xe=require("vscode");var Xn=require("fs");var $f=dt(Hf()),Vf=require("path"),zn=dt(ae());var gm=[101,56,52,97,53,57,53,55,45,100,54,56,48,45,52,99,99,53,45,57,50,54,55,45,53,101,53,101,51,100,48,97,56,100,53,55],ps=class{constructor(t){this.client=t;Qn.Configuration.setAutoCollectExceptions(!0).setUseDiskRetryCaching(!0).setAutoCollectConsole(!0,!0).setInternalLogging(!0,!0)}init(t,r){let n=mm(t),i=(0,Uf.userInfo)().username;this.client.context.tags["ai.device.model"]=`Visual Studio Code ${xe.version}`,this.client.context.tags["ai.user.id"]=i,this.client.context.tags["ai.user.accountId"]=Ff()(i).toString(),this.client.context.tags["ai.session.id"]=$f.v1(),this.client.context.tags["ai.application.ver"]=n.version,this.client.commonProperties=Object.bind(this.client.commonProperties,r,{"process.platform":process.platform,"process.arch":process.arch,"extension.id":t.extension.id});for(let a in n)this.client.commonProperties["server."+a]=n[a];this.track("extension loaded",{"copilot.enabled":fs("github.copilot"),"phptools.enabled":fs("devsense.phptools-vscode"),"intelephense.enabled":fs("bmewburn.vscode-intelephense-client")})}track(t,r,n){if(!xe.env.isTelemetryEnabled||!this.client)return;let i={name:t,properties:Object.bind({},r)};n&&(i.measurements=n),this.client.trackEvent(i)}metric(t,r,n,i,a,s){this.client.trackMetric({name:t,value:r,count:n,min:i,max:a,stdDev:s})}error(t,r,n){if(n=Object.bind({},n),!xe.env.isTelemetryEnabled){var i=xe.workspace.getConfiguration().get("telemetry.telemetryLevel");if(i!="error"&&(i!="crash"||r!="critical"))return}this.client.trackException({exception:t,severity:r=="critical"?zn.SeverityLevel.Critical:r=="error"?zn.SeverityLevel.Error:zn.SeverityLevel.Warning,properties:n})}},WE=new ps(new Qn.TelemetryClient(ri(gm)));function _m(e){let t="out/server/version.json";return e?e.asAbsolutePath(t):(0,Vf.join)(__filename,"../../..",t)}function mm(e){let t=_m(e);try{if((0,Xn.existsSync)(t))return JSON.parse((0,Xn.readFileSync)(t,"utf8"))||{}}catch(n){}let r=e.extension.packageJSON.version;return{target:`${process.platform}-${process.arch}`,version:r}}function fs(e){return xe.extensions.getExtension(e)!==void 0}var sp=require("fs");try{let e=require(`${__filename}/../../server/version.json`);if(e.version){let t=!1;for(Qt=Zn.default.relative(__dirname,".."),Es=0;Qt.length!=0&&Es<3;Qt=Zn.default.relative(Qt,".."),Es++)if(ip=Zn.default.basename(Qt),ip=="extensions"){ap=(0,sp.readdirSync)(Qt,{withFileTypes:!0}).filter(r=>r.isDirectory()&&r.name.startsWith("devsense.phptools-vscode")).map(r=>r.name.substring("devsense.phptools-vscode".length+1)).filter(r=>r.startsWith(e.version)==!1),t=ap.length==0;break}np()(`https://www.devsense.com/uninstall?from=vscode&platform=${e.target}&version=${e.version}`)}}catch(e){}var ip,ap,Qt,Es;
/**
 * Wrapper for built-in http.js to emulate the browser XMLHttpRequest object.
 *
 * This can be used with JS designed for browsers to improve reuse of code and
 * allow the use of existing libraries.
 *
 * Usage: include("XMLHttpRequest.js") and use XMLHttpRequest per W3C specs.
 *
 * @author Dan DeFelippi <dan@driverdan.com>
 * @contributor David Ellis <d.f.ellis@ieee.org>
 * @license MIT
 */
